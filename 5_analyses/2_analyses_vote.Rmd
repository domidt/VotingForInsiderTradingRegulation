
---
title: "Voting for insider trading regulation."
subtitle: "Data analyses script"
author: 
  - Dominik Schmidt
  - Thomas Stöckl
  - Stefan Palan
output:
  pdf_document:
    fig_caption: yes
    toc: true
    
header-includes: 
  - \usepackage{floatrow}
  - \floatsetup[figure]{capposition=top}
  - \floatsetup[table]{capposition=top}
  - \floatplacement{figure}{H}
  - \floatplacement{table}{H}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(eval = T, echo = F, warning=F, message=F)
```

```{r load, echo = FALSE, include=F}
### install.packages ####
library("ggplot2")
library("mgcv")
library("effects")
library("margins")
library("pscl")
library("lme4")
library("car")
library("lmtest")
library("sandwich")
library("texreg")
library("gplots")
library("visreg")
library("dplyr")
library("ggpubr")
library("MASS")
library("ggalluvial")
library("Hmisc")

### setwd ####
setwd(getwd())

### collect data ####
load("Data.RData")
```

**********************************************

The folder '5_analyses' provides the codes for (1) data preparation and (2) the analyses shown in the paper.

The file '1_dataPreparation_vote.R' scripts the steps from loading files from the folder '4_data_excel' to the output of file 'Data.RData'.

'Data.RData' consists of nine data tables: marketsummary, tradersummary, subjects, Votes, observers, transactions, offers, seconds, and avgtraderprofit.

The file '2_analyses_vote.Rmd' scripts the analyses in Rmarkdown format, i.e., calculations are in *.R* format and can be replicated in the *R* console. Moreover, this file compiles the '2_analyses_vote.pdf' as an output.

## Variable description

### marketsummary
The table 'marketsummary' summarizes data for each market, i.e. one observation per period and cohort.

| Variable | Description |
---| ---|
|Group| ID variable, which uniquely identifies each session from '1' to '32'.|
|Period| Period index, ranging from '1' to '12'.|
|Period0| Period index, ranging from '0' to '5', indicating the distance to the phase’s first period, starting with 0 to facilitate the interpretation of the intercept.|
|Phase| Phase index, which is either 'Phases 1 & 2' for periods 1 to 6, 'Phase 3' for periods 7 to 9, or 'Phase 4' or periods 10 to 12.|
|Treatment| Treatment index, which is either 'FIXEDNR', 'FIXEDRN', 'FLUCTNR', 'FLUCTRN'.|
|subTreatment| Treatment index specifying the regulation in Phases 1 and 3, which is either 'FIXED' or 'FLUCT'.|
|regime_order| Treatment index specifying the order of market regulation in Phase 2, which is either 'NR' or 'RN'.| 
|BBV| Buyback Value.|
|BBVCent| Buyback Value centralized by the unconditional expected value of 57.5.|
|IsREG| Regulatory index, which is either 'REG' for regulated markets or 'NOREG'.|
|Referendum1| Binomial variable which is either 'REG' when 'Referendum 1' turned out in favor of regulation or 'NOREG' otherwise.|
|Referendum2| Binomial variable which is either 'REG' when 'Referendum 2' turned out in favor of regulation or 'NOREG' otherwise.|
|transactionVol| Number of assets transacted in a single market.|
|VolumeUni| Number of assets transacted involving uninformed traders in a single market.|
|VolumeInf| Number of assets transacted involving informed traders in a single market.|
|Volume_Informed_Informed| Number of assets offered and accepted by informed traders in a single market.|
|Volume_Uninformed_Informed| Number of assets offered by uninformed and accepted by informed traders in a single market.|
|Volume_Informed_Uninformed| Number of assets offered by informed and accepted by uninformed traders in a single market.|
|Volume_Uninformed_Uninformed| Number of assets offered and accepted by uninformed traders in a single market.|
|NumTransactions| Number of transactions in a single market.|
|LimitVol| Number of assets offered in limit orders in a single market.|
|limitVolumeInf| Number of assets offered  in limit orders by informed traders in a single market.|
|limitVolumeUni| Number of assets offered  in limit orders by uninformed traders in a single market.|
|NumActiveTrader| Number of traders who either placed a limit order or accepted a market order.|
|HHInitialAssets| Herfindahl–Hirschman index for the initial asset endowment with an alpha of 2.|
|HHEndAssets| Herfindahl–Hirschman index for the asset endowment at market closing with an alpha of 2.|
|HHInitialEndowment| Herfindahl–Hirschman index for the initial endowment with an alpha of 2.|
|HHEndEndowment| Herfindahl–Hirschman index for the endowment at market closing with an alpha of 2.|
|HHEndEndowmentPun| Herfindahl–Hirschman index for the endowment at market closing after punishment payments with an alpha of 2.|
|HHVolume| Herfindahl–Hirschman index for the transacted volume with an alpha of 2.|
|HHPDbefore| Herfindahl–Hirschman index for the wealth change before redistributions with an alpha of 2.|
|HHPDPun| Herfindahl–Hirschman index for the wealth change after punishement payments with an alpha of 2.|
|HHI_InitialAssets| Herfindahl–Hirschman index for the initial asset endowment with an alpha of 2 for active traders.|
|HHI_EndAssets| Herfindahl–Hirschman index for the asset endowment at market closing with an alpha of 2 for active traders.|
|HHI_InitialEndowment| Herfindahl–Hirschman index for the initial endowment with an alpha of 2 for active traders.|
|HHI_EndEndowment| Herfindahl–Hirschman index for the endowment at market closing with an alpha of 2 for active traders.|
|HHI_EndEndowmentPun| Herfindahl–Hirschman index for the endowment after punishment payment at market closing with an alpha of 2 for active traders.|
|HHI_Volume| Herfindahl–Hirschman index for the transacted volume with an alpha of 2 for active traders.|
|HHI_PDbefore| Herfindahl–Hirschman index for the wealth change before redistributions with an alpha of 2 for active traders.|
|HHI_PDPun| Herfindahl–Hirschman index for the wealth change after punisment payments with an alpha of 2 for active traders.|
|GiniPDbefore| Gini index for wealth change before redistributions.|
|GiniPDPun| Gini index for wealth change after punishment payment.|
|GiniProfit| Gini index for payoffs at market closing after punishemnt payment.|
|GiniAssets| Gini index for the initial asset endowment.|
|GiniEndowment| Gini index for the initial endowment.|
|BestBid180| Active bid in the order book when market ended which offered the highest bid price.|
|BestAsk180| Active ask in the order book when market ended which offered assets for the lowest ask price.|
|BAspread180| Difference between best bid and best ask price when market ended.
|midpointBA180| Arithmetic average of the best bid and best ask price when market ended.|
|BestBid150| Mean best bids in the order book in the last 30 seconds weighted with the seconds providing the highest bid price.|
|BestAsk150| Mean best asks in the order book in the last 30 seconds weighted with the seconds providing the lowest ask price.|
|BAspread150| Mean difference between best bid and best ask price in the last 30 seconds each second.|
|midpointBA150| Mean midpoint between best bid and best ask price in the last 30 seconds each second.|
|BA_BBV| Difference between the mean midpoints between best bid and best ask prices of the whole time span of one market, and the the buyback value.|
|BA_BBV150| Difference between the mean midpoints between best bid and best ask prices in the last 30 seconds, and the the buyback value.|
|BA_BBV180| Difference between the mean midpoints between best bid and best ask prices when market closes, and the the buyback value.|
|lnBA_BBV| Logarithmic ratio of the mean midpoints between best bid and best ask prices of the whole time span of one market, and the the buyback value.|
|meanBestBid| Mean best bids in the order book in the whole time span of a market weighted with the seconds providing the highest bid price.|
|meanBestAsk| Mean best asks in the order book in the whole time span of a market weighted with the seconds providing the lowest ask price.|
|meanBAspread| Mean difference between best bid and best ask price each second.|
|meanmidpointBA| Mean midpoint between best bid and best ask price in the whole time span of a market.|
|meanBAspreadwins| Mean difference between best bid and best ask price each second after a symmetric 90% winsorization of prices.|
|meanBAspreadwins2| Mean difference between best bid and best ask price each second after a symmetric 90% winsorization.|
|meanreturn| Mean price change between transactions.|
|meanreturnwins| Mean price change between transactions after a symmetric 90% winsorization of prices.|
|meanreturnwins2| Mean price change between transactions after a symmetric 90% winsorization.|
|volatility| Standard deviation of transaction price returns within a market.|
|volatilitywins| Standard deviation of transaction price returns within a market after a symmetric 90% winsorization of prices.|
|volatilitywins2| Standard deviation of transaction price returns within a market after a symmetric 90% winsorization.|
|meanreturnPerSecond| Mean price change between seconds.|
|meanPrice| Mean transaction price within a market.|
|sdreturnPerSecond| Standard deviation of transaction price returns between seconds.|
|sdPrice| Standard deviation of transaction prices within a market.|
|ProfitPotential| Sum absolute difference between the transaction price and the buyback value for each transaction times the transacted volume.|
|unprofittime| Unexectued Profitable Orders per Time - Money on the table times the time on the market, i.e., profitable price difference between an offer and the fundamental value times the remaining volume times the time span the order is on the market.|
|RUPT| Relative Unexecuted Profitable Orders per Time - relative money on the table, i.e., profitable price difference between an offer and the fundamental value times the remaining volume times the time span the order is on the market divided by the fundamental value and divided by the sum of time times volume of all limit orders.|
|GD| Geometric Deviation - Geometric volume-weighted average relative mispricing within a market.|
|GAD| Geometric Absolute Deviation - Absolute geometric volume-weighted average relative mispricing within a market.|
|GADhyp| Hypothetical GAD when prices are set to be the unconditional expected value, 57.5.|
|rGAD| 1 minus the ratio between GAD and the hypothetical GAD.|
|RD| Relative Deviation - Arithmetic volume-weighted average relative mispricing within a market.|
|RAD| Relative Absolute Deviation - Absolute arithmetic volume-weighted average relative mispricing within a market.|
|GD120| Geometric volume-weighted average relative mispricing in the last minute of a market.|
|GAD120| Absolute geometric volume-weighted average relative mispricing in the last minute of a market.|
|RD120| Arithmetic volume-weighted average relative mispricing in the last minute of a market.|
|RAD120| Absolute arithmetic volume-weighted average relative mispricing in the last minute of a market.|
|rGAD120| 1 minus the ratio between GAD120 and the hypothetical GAD120.|
|NumSelected| Number of scrutinized traders by observer.|
|NumDetections| Number of correctly selected informed traders by observer.|
|NumPunished| Number of correctly selected informed traders by observer in REG.|
|NumMissuspected| Number of incorrectly selected uninformed traders by observer.|
|Price| Last transaction price in a market.|
|shortsells| Number of assets sold with negative asset endowment using the short limit capacity.|
|marginbuysTaler| Money spend to buy assets with negative money endowment using the credit limit.|
|marginbuysAsset| Purchases with negative money endowments divided by the transaction price.|
|marginbuys| Purchases with negative money endowments divided by the buyback value.|
|shortsells_Informed| Number of assets sold with negative asset endowment using the short limit capacity involving informed traders.|
|shortsells_Uninformed| Number of assets sold with negative asset endowment using the short limit capacity involving uninformed traders.| 
|marginbuys_Informed| Purchases with negative money endowments divided by the buyback value involving informed traders.|
|marginbuys_Uninformed| Purchases with negative money endowments divided by the buyback value involving uninformed traders.|
|marginbuysAsset_Informed| Purchases with negative money endowments divided by the transaction price involving informed traders.|
|marginbuysAsset_Uninformed| Purchases with negative money endowments divided by the transaction price involving uninformed traders.|

### tradersummary
The table 'tradersummary' summarizes data for each individual trader in each market, i.e. 9 observations for each period and cohort. 

| Variable | Description |
---| ---|
|subjectID| ID variable, which uniquely identifies each participant from '1' to '320' (missing values in the data table were observers).|
|Group| ID variable, which uniquely identifies each session from '1' to '32'.|
|Date| Date and Program Starting Time of the experimental session in format yymmdd_hhmm.|
|Subject| ID variable, which identifies participants within an experimental session from '1' to '10'.|
|Period| Period index, ranging from '1' to '12'.|
|Period0| Period index, ranging from '0' to '5', indicating the distance to the phase’s first period, starting with 0 to facilitate the interpretation of the intercept.|
|Phase| Phase index, which is either 'Phases 1 & 2' for periods 1 to 6, 'Phase 3' for periods 7 to 9, or 'Phase 4' for periods 10 to 12.|
|Treatment| Treatment index, which is either 'FIXEDNR', 'FIXEDRN', 'FLUCTNR', 'FLUCTRN'.|
|subTreatment| Treatment index specifying the regulation in Phases 1 and 3, which is either ''FIXED'' or 'FLUCT'.|
|regime_order| Treatment index specifying the order of market regulation in Phase 2, which is either 'NR' or 'RN'.| 
|BBV| Buyback Value.|
|BBVCent| Buyback Value centralized by the unconditional expected value of 57.5.|
|IsREG| Regulatory index, which is either 'REG' for regulated markets or 'NOREG'.|
|Role| Trader type index which is either 'Informed trader' or 'Uninformed trader'.|
|ExpectedRole| Trader type index which is either 'FLUCT' in treatment FLUCT, or 'Informed trader' or 'Uninformed trader' in treatment FIXED.|
|vote1| Binary variable that is either 'REG' when this trader voted in favor of regulation in Referendum 1, or 'NOREG' otherwise.|
|vote2| Binary variable that is either 'REG' when this trader voted in favor of regulation in Referendum 2, or 'NOREG' otherwise.|
|vote3| Binary variable that is either 'REG' when this trader voted in favor of regulation in Referendum 3, or 'NOREG' otherwise.|
|votesallReferenda| Describes the voting behavior of this trader in the three Referenda and is either 'NOREG.NOREG.NOREG', 'NOREG.NOREG.REG', 'NOREG.REG.NOREG', 'NOREG.REG.REG', 'REG.NOREG.NOREG', 'REG.NOREG.REG', 'REG.REG.NOREG', or 'REG.REG.REG'.|
|votes2Referenda| Describes the voting behavior of this trader in Referenda 1 & 2 and is either 'NOREG.NOREG', 'NOREG.REG', 'REG.NOREG', 'REG.REG'.|
|Referendum1| Binary variable that is either 'REG' when the Referendum outcome is in favor of regulation in Referendum 1, or 'NOREG' otherwise.|
|Referendum2| Binary variable that is either 'REG' when the Referendum outcome is in favor of regulation in Referendum 2, or 'NOREG' otherwise.|
|InitialAssets| Number of assets this participant is endowed at the beginning of this period.|
|Assets| Number of assets this participants holds at market closing of this period.|
|InitialMoney| Monetary units this participant is endowed at the beginning of this period.|
|Money| Monetary units this participants holds at market closing of this period.|
|InitialEndowment| Initial asset endowment time the buyback value plus the initial monetary units.|
|EndEndowment| Asset endowment times the buyback value plus the monetary units at market closing before redistributions and punishment.|
|EndEndowmentPun| Asset endowment times the buyback value plus the monetary units at market closing after redistributions and punishment.|
|InitialEndowmentUnits| Initial asset endowment value plus initial monetary units divided by the buyback value.|
|EndEndowmentUnits| Asset endowment plus the monetary units divided by the buyback value at market closing before redistributions and punishment.|
|EndEndowmentUnitsPun| Asset endowment plus the monetary units divided by the buyback value at market closing after redistributions and punishment.|
|Unmasked| Binary variable which is either '1' when this trader is informed and correctly identified, or '0' otherwise.|
|TradingProfit| Trading profits from market participation in experimental monetary units before redistribution and punishment.|
|CompensationReceived| Sum of redistribution and punishment payments lost or received.|
|TPRedist| Trading profits from market participation in experimental monetary units after redistribution.|
|TPPun| Trading profits from market participation in experimental monetary units after redistribution and punishment.|
|TPUnits| Trading profits from market participation in asset units (experimental monetary units divided by the buyback value) before redistribution and punishment.|
|TPUnitsRedist| Trading profits from market participation in asset units after redistribution.|
|TPUnitsPun| Trading profits from market participation in asset units after redistribution and punishment.|
|ProfitPeriod| Profit from market participation in Euro after redistribution and punishment.|
|PDbefore| Wealth change before redistribution and punishment.|
|PDRedist| Wealth change after redistribution.|
|PDPun| Wealth change after redistribution and punishment.|
|PDbeforeVol| Wealth change per transacted asset before redistribution and punishment.|
|PDRedistVol| Wealth change per transacted asset after redistribution.|
|PDPunVol| Wealth change per transacted asset after redistribution and punishment.|
|AvgPDbeforeInf| Arithmetic mean of wealth changes per transacted asset before redistribution and punishment in periods this trader is informed.|
|AvgPDbeforeUni| Arithmetic mean of wealth changes per transacted asset before redistribution and punishment in periods this trader is uninformed.|
|rankavgPDbeforeInf| Ordered rank of average wealth change before redistribution and punishment throughout the experiment when informed from '1' (lowest) to '9' (highest).|
|rankavgPDbeforeUni| Ordered rank of average wealth change before redistribution and punishment throughout the experiment when uninformed from '1' (lowest) to '9' (highest).|
|rankavgPDbeforeRole| Ordered rank of average wealth changes before redistribution and punishment throughout the experiment compared to traders of the same trader type as this trader in this period.|
|Volume| Number of assets transacted in a single market.|
|LimitVolume| Number of assets offered in limit orders in a single market.|
|CancelledVolume| Number of offered assets withdrawn before market closing.|
|MarketVolume| Number of accepted assets in market orders in a single market.|
|transactedLimitVolume| Number of offered assets accepted by another trader in a single market.|
|PurchasedVol| Number of assets purchased in a single market.|
|SoldVol| Number of assets sold in a single market.|
|Trades| Number of transactions (market and limit) in a single market.|
|MarketOrders| Number of transactions, for which this trader accepted others' offers in a single market.|
|LimitTrades| Number of transactions, for which a limit order has been accepted by others in a single market.|
|LimitOrders| Number of orders placed in a single market.|
|Purchases| Number of transactions, in which assets have been purchased in a single market.|
|Sales| Number of transactions, in which assets have been sold in a single market.|
|active| Binary variable which identifies whether this trader placed any limit order or accepted any market order.|
|TPUnProfitTransaction| Trading losses from unprofitable transactions in a single market.|
|VolUnprofitTransaction| Number of assets transacted in unprofitable transactions in a single market.|
|NumUnprofitTransactions| Number of unprofitable transactions in a single market.|
|shortsells| Number of assets sold with negative asset endowment using the short limit capacity.|
|marginbuysTaler| Money spend to buy assets with negative money endowment using the credit limit.|
|marginbuysAsset| Purchases with negative money endowments divided by the transaction price.|
|marginbuys| Purchases with negative money endowments divided by the buyback value.|
|xScore| EET's x-score from -2.5 to 2.5 (NA for participants with non-monotonic preferences).|
|yScore| EET's y-score from -2.5 to 2.5 (NA for participants with non-monotonic preferences).|
|xScoreAll| EET's x-score from -2.5 to 2.5 (0 for participants with non-monotonic preferences).|
|yScoreAll| EET's y-score from -2.5 to 2.5 (0 for participants with non-monotonic preferences).|
|EET| EET archetypes that are either Selfish, Altruistic, Maximin, Inequality averse, Kiss up, Envious, Spiteful, Kick down, or Non-monotonic.|
|Unmasked| Observers success to identify this trader when informed that is either 'Punished' in REG, 'Unmasked' in NOREG, 'not unmasked', or 'Uninformed trader'.|
|Punished| Observers success to identify this trader in REG when informed that is either 1 when punished in REG, or 0 otherwise.|
|Role.x| Trader type index for period 'x' that is either 'Informed trader' or 'Uninformed trader'.| 
|ProfitPeriod.x| Profit from market participation in Euro after redistribution and punishment in period 'x'.| 
|TradingProfit.x| Trading profits from market participation in experimental monetary units before redistribution and punishment in period 'x'.| 
|CompensationReceived.x| Sum of redistribution and punishment payments lost or received in period 'x'.|
|PDbefore.x| Wealth change in period 'x' before redistribution and punishment.|
|PDRedist.x| Wealth change in period 'x' after redistribution.|
|PDPun.x| Wealth change in period 'x' after redistribution and punishment.|
|PDbeforeVol.x| Wealth change in period 'x' per transacted asset before redistribution and punishment.|
|PDRedistVol.x| Wealth change in period 'x' per transacted asset after redistribution.|
|PDPunVol.x| Wealth change in period 'x' per transacted asset after redistribution and punishment.|
|Unmasked.x| Observers success in period 'x' to identify this trader when informed that is either 'Punished' in REG, 'Unmasked' in NOREG, 'not unmasked', or 'Uninformed trader'.|
|IsREG.x| Regulatory index for period 'x', which is either 'REG' for regulated markets or 'NOREG'.|
|IsInsider.x| Trader type index for period 'x' that is either 1 for informed traders or 0 otherwise.| 
|PunPerceived| Self-description how punishment is perceived on a Likert scale from 1 (top low) to 7 (too high). PostQ1: 'If a trader with information is correctly selected by the observer, she loses her trading profit and must pay an additional penalty equal to the trading profit. Please indicate whether you consider this penalty to be appropriate, too low, or too high.'|
|ReasonVote| Self-description of their reasons to vote. PostQ2: 'Please describe concisely why you voted for or against the impact of the observer decisions on traders' period incomes. If you changed your vote during the experiment, what were the reasons?'|
|ChanceIdentification| Self-description of traders at the end of the experiment how they estimate the probability of a detection of informed traders from 0 to 100. PostQ3: 'How high do you estimate the probability that an observer correctly identifies a trader with information as such.'.|
|StrategyTrader| Self-description of traders at the end of the experiment of their trading strategy. PostQ4: 'What strategies did you use to avoid being recognized by observers as a trader with information?'.|
|RiskGeneral| Self-description of participants' risk tolerance at the end of the experiment on a Likert scale from 1 (not at all willing to take risks) to 11 (very willing to take risks). PostQ6: 'How do you see yourself: are you generally a person who is fully prepared to take risks or do you try to avoid taking risks?'.|
|RiskFinancial| Self-description of participants' financial risk tolerance at the end of the experiment on a Likert scale from 1 (not at all willing to take risks) to 11 (very willing to take risks). PostQ7: 'People can behave differently in different situations. How would you rate your willingness to take risks in financial matters?'.|
|LossAversion| Self-description of participants loss tolerance at the end of the experiment on a Likert scale from 1 (protection against losses) to 11 (participation to high returns). PostQ8: 'In financial decisions, both gains and losses are possible. To what extent do possible losses compared to possible gains influence you?'.|
|Faculty| Self-description of participants' department of studies. PostQ9: 'Which faculty are you studying at?'.|
|FacultyOther| If they specified other at department, they are asked to specify here their faculty.|
|age| Self-description of participants' age. PostQ10a: 'Age in years'.|
|gender| Self-description of participants' gender which can be either 'female', 'male', or 'xdivers'. PostQ10b: 'Gender'|
|notes| Room for further comments concerning the experiment.|

### subjects
The table 'subjects' summarizes data for each individual in each period, i.e. 10 observations for each period and cohort. 

| Variable | Description |
---| ---|
|subjectID| ID variable, which uniquely identifies each participant from '1' to '320' (missing values indicate Experimenterg).|
|Group| ID variable, which uniquely identifies each session from '1' to '32'.|
|Date| Date and Program Starting Time of the experimental session in format yymmdd_hhmm.|
|Subject| ID variable, which identifies participants within an experimental session from '1' to '10'.|
|Period| Period index, ranging from '1' to '12'.|
|Treatment| Treatment index, which is either 'FIXEDNR', 'FIXEDRN', 'FLUCTNR', 'FLUCTRN'.|
|subTreatment| Treatment index specifying the regulation in Phases 1 and 3, which is either ''FIXED'' or 'FLUCT'.|
|regime_order| Treatment index specifying the order of market regulation in Phase 2, which is either 'NR' or 'RN'.| 
|BBV| Buyback Value.|
|BBVCent| Buyback Value centralized by the unconditional expected value of 57.5.|
|IsREG| Regulatory index, which is either 'REG' for regulated markets or 'NOREG'.|
|Role| Role index which is either 'Informed trader', 'Uninformed trader', 'Observer', or 'Experimenter'.|
|ExpectedRole| Trader type index which is either 'FLUCT' in treatment FLUCT, or 'Informed trader' or 'Uninformed trader' in treatment FIXED.|
|vote1| Binary variable that is either 'REG' when this trader voted in favor of regulation in Referendum 1, 'NOREG' when this trader voted against regulation in Referendum 1, or 'NA' for observers and experimenter|
|vote2| Binary variable that is either 'REG' when this trader voted in favor of regulation in Referendum 2, 'NOREG' when this trader voted against regulation in Referendum 1, or 'NA' for observers and experimenter.|
|vote3| Binary variable that is either 'REG' when this trader voted in favor of regulation in Referendum 3, 'NOREG' when this trader voted against regulation in Referendum 1, or 'NA' for observers and experimenter.|
|votesallReferenda| Describes the voting behavior of this trader in the three Referenda and is either 'NOREG.NOREG.NOREG', 'NOREG.NOREG.REG', 'NOREG.REG.NOREG', 'NOREG.REG.REG', 'REG.NOREG.NOREG', 'REG.NOREG.REG', 'REG.REG.NOREG', 'REG.REG.REG', or 'NA' for observers and experimenter.|
|votes2Referenda| Describes the voting behavior of this trader in Referenda 1 & 2 and is either 'NOREG.NOREG', 'NOREG.REG', 'REG.NOREG', 'REG.REG', or 'NA' for observers and experimenter.|
|Referendum1| Binary variable that is either 'REG' when the Referendum outcome is in favor of regulation in Referendum 1, or 'NOREG' otherwise.|
|Referendum2| Binary variable that is either 'REG' when the Referendum outcome is in favor of regulation in Referendum 2, or 'NOREG' otherwise.|
|IsInsider| Participant role index which is either '1' for informed traders or '0' otherwise.|
|IsExperimenter| Participant role index which is either '1' for the experimenter or '0' otherwise.|
|TotalProfit| Profit from participation in Euro at the end of an experimental session.|
|ProfitPeriod| Profit from market participation in Euro after redistribution and punishment.|
|xScore| EET's x-score from -2.5 to 2.5 (NA for participants with non-monotonic preferences).|
|yScore| EET's y-score from -2.5 to 2.5 (NA for participants with non-monotonic preferences).|
|xScoreAll| EET's x-score from -2.5 to 2.5 (0 for participants with non-monotonic preferences).|
|yScoreAll| EET's y-score from -2.5 to 2.5 (0 for participants with non-monotonic preferences).|
|EET| EET archetypes that are either Selfish, Altruistic, Maximin, Inequality averse, Kiss up, Envious, Spiteful, Kick down, or Non-monotonic.|
|PunPerceived| Self-description how punishment is perceived on a Likert scale from 1 (top low) to 7 (too high). PostQ1: 'If a trader with information is correctly selected by the observer, she loses her trading profit and must pay an additional penalty equal to the trading profit. Please indicate whether you consider this penalty to be appropriate, too low, or too high.'|
|ReasonVote| Self-description of their reasons to vote. PostQ2: 'Please describe concisely why you voted for or against the impact of the observer decisions on traders' period incomes. If you changed your vote during the experiment, what were the reasons?'|
|ChanceIdentification| Self-description of traders at the end of the experiment how they estimate the probability of a detection of informed traders from 0 to 100. PostQ3: 'How high do you estimate the probability that an observer correctly identifies a trader with information as such.'.|
|StrategyTrader| Self-description of traders at the end of the experiment of their trading strategy. PostQ4: 'What strategies did you use to avoid being recognized by observers as a trader with information?'.|
|ObserverStrategy| Self-description of observers at the end of the experiment how they use information: PostQ5: 'Please describe how you think the available information (1. volume limit; 2. volume limit deleted; 3. trading volume limit; 4. trading volume market; 5. volume purchased; 6. volume sold; 7. volume purchased - sold; 8. average price; 9. average volume) can be used to identify informed traders!'.|
|RiskGeneral| Self-description of participants' risk tolerance at the end of the experiment on a Likert scale from 1 (not at all willing to take risks) to 11 (very willing to take risks). PostQ6: 'How do you see yourself: are you generally a person who is fully prepared to take risks or do you try to avoid taking risks?'.|
|RiskFinancial| Self-description of participants' financial risk tolerance at the end of the experiment on a Likert scale from 1 (not at all willing to take risks) to 11 (very willing to take risks). PostQ7: 'People can behave differently in different situations. How would you rate your willingness to take risks in financial matters?'.|
|LossAversion| Self-description of participants loss tolerance at the end of the experiment on a Likert scale from 1 (protection against losses) to 11 (participation to high returns). PostQ8: 'In financial decisions, both gains and losses are possible. To what extent do possible losses compared to possible gains influence you?'.|
|Faculty| Self-description of participants' department of studies. PostQ9: 'Which faculty are you studying at?'.|
|FacultyOther| If they specified other at department, they are asked to specify here their faculty.|
|age| Self-description of participants' age. PostQ10a: 'Age in years'.|
|gender| Self-description of participants' gender which can be either 'female', 'male', or 'xdivers'. PostQ10b: 'Gender'|
|notes| Room for further comments concerning the experiment.|

### Votes
The table 'Votes' summarizes data for each trader in each referendum, i.e. three observations for each cohort and trader constitute 864 observations.

| Variable | Description |
---| ---|
|subjectID| ID variable, which uniquely identifies each participant from '1' to '320' (missing values in the data table were observers).|
|Group| ID variable, which uniquely identifies each session from '1' to '32'.|
|Date| Date and Program Starting Time of the experimental session in format yymmdd_hhmm.|
|Subject| ID variable, which identifies participants within an experimental session from '1' to '10'.|
|Phase| Phase index, which is either 'Phases 1 & 2' for Referendum 1, 'Phase 3' for Referendum 2, or 'Phase 4' for Referendum 3.|
|Referendum| Referendum index, which is either 'Referendum 1', 'Referendum 2', or 'Referendum 3'.|
|Treatment| Treatment index, which is either 'FIXEDNR', 'FIXEDRN', 'FLUCTNR', 'FLUCTRN'.|
|subTreatment| Treatment index specifying the regulation in Phases 1 and 3, which is either ''FIXED'' or 'FLUCT'.|
|regime_order| Treatment index specifying the order of market regulation in Phase 2, which is either 'NR' or 'RN'.| 
|BBV| Buyback Value.|
|BBVCent| Buyback Value centralized by the unconditional expected value of 57.5.|
|ExpectedRole| Trader type index which is either 'FLUCT' in treatment FLUCT, or 'Informed trader' or 'Uninformed trader' in treatment FIXED.|
|vote| Binary variable that is either 'REG' when this trader voted in favor of regulation in this Referendum, or 'NOREG' otherwise.|
|vote1| Binary variable that is either 'REG' when this trader voted in favor of regulation in Referendum 1, or 'NOREG' otherwise.|
|vote2| Binary variable that is either 'REG' when this trader voted in favor of regulation in Referendum 2, or 'NOREG' otherwise.|
|vote3| Binary variable that is either 'REG' when this trader voted in favor of regulation in Referendum 3, or 'NOREG' otherwise.|
|votesallReferenda| Describes the voting behavior of this trader in the three Referenda and is either 'NOREG.NOREG.NOREG', 'NOREG.NOREG.REG', 'NOREG.REG.NOREG', 'NOREG.REG.REG', 'REG.NOREG.NOREG', 'REG.NOREG.REG', 'REG.REG.NOREG', or 'REG.REG.REG'.|
|votes2Referenda| Describes the voting behavior of this trader in Referenda 1 & 2 and is either 'NOREG.NOREG', 'NOREG.REG', 'REG.NOREG', 'REG.REG'.|
|Referendum1| Binary variable that is either 'REG' when the Referendum outcome is in favor of regulation in Referendum 1, or 'NOREG' otherwise.|
|Referendum2| Binary variable that is either 'REG' when the Referendum outcome is in favor of regulation in Referendum 2, or 'NOREG' otherwise.|
|AvgPRREG1| Perticipation rate of this trader in REG periods in Phases 1 & 2.|
|AvgPDbeforeREG1| Arithmetic mean of wealth changes per transacted asset before redistribution and punishment in REG periods in Phases 1 & 2.|
|AvgPDRedistREG1| Arithmetic mean of wealth change after redistribution in REG periods in Phases 1 & 2.|
|AvgPDPunREG1| Arithmetic mean of wealth change after redistribution and punishment in REG periods in Phases 1 & 2.|
|AvgPDbeforeVolREG1| Arithmetic mean of wealth change per transacted asset before redistribution and punishment in REG periods in Phases 1 & 2.|
|AvgPDRedistVolREG1| Arithmetic mean of wealth change per transacted asset after redistribution in REG periods in Phases 1 & 2.|
|AvgPDPunVolREG1| Arithmetic mean of wealth change per transacted asset after redistribution and punishment in REG periods in Phases 1 & 2.|
|AvgPRNOREGREG1| Participation rate of this trader in NOREG periods in REG periods in Phases 1 & 2.|
|AvgPDbeforeNOREG1| Arithmetic mean of wealth changes per transacted asset before redistribution and punishment in NOREG periods in Phases 1 & 2.|
|AvgPDRedistNOREG1| Arithmetic mean of wealth change after redistribution in NOREG periods in Phases 1 & 2.|
|AvgPDPunNOREG1| Arithmetic mean of wealth change after redistribution and punishment in NOREG periods in Phases 1 & 2.|
|AvgPDbeforeVolNOREG1| Arithmetic mean of wealth change per transacted asset before redistribution and punishment in NOREG periods in Phases 1 & 2.|
|AvgPDRedistVolNOREG1| Arithmetic mean of wealth change per transacted asset after redistribution in NOREG periods in Phases 1 & 2.|
|AvgPDPunVolNOREG1| Arithmetic mean of wealth change per transacted asset after redistribution and punishment in NOREG periods in Phases 1 & 2.|
|AvgPR1| Perticipation rate of this trader in Phases 1 & 2.|
|AvgPDbefore1| Arithmetic mean of wealth change before redistribution and punishment in Phases 1 & 2.|
|AvgPDRedist1| Arithmetic mean of wealth change after redistribution in Phases 1 & 2.|
|AvgPDPun1| Arithmetic mean of wealth change after redistribution and punishment in Phases 1 & 2.|
|AvgPDbeforeVol1| Arithmetic mean of wealth change per transacted asset before redistribution and punishment in Phases 1 & 2.|
|AvgPDRedistVol1| Arithmetic mean of wealth change per transacted asset after redistribution in Phases 1 & 2.|
|AvgPDPunVol1| Arithmetic mean of wealth change per transacted asset after redistribution and punishment in Phases 1 & 2.|
|sdProfit| Standard deviation of profits in Euro after redistribution and punishment in Phases 1 & 2.|
|sdPDbefore1| Standard deviation of wealth change before redistribution and punishment in Phases 1 & 2.|
|sdPDRedist1| Standard deviation of wealth change after redistribution in Phases 1 & 2.|
|sdPDPun1| Standard deviation of wealth change after redistribution and punishment in Phases 1 & 2.|
|sdPDbeforeVol1| Standard deviation of wealth change per transacted asset before redistribution and punishment in Phases 1 & 2.|
|sdPDRedistVol1| Standard deviation of wealth change per transacted asset after redistribution in Phases 1 & 2.|
|sdPDPunVol1| Standard deviation of wealth change per transacted asset after redistribution and punishment in Phases 1 & 2.|
|xScore| EET's x-score from -2.5 to 2.5 (NA for participants with non-monotonic preferences).|
|yScore| EET's y-score from -2.5 to 2.5 (NA for participants with non-monotonic preferences).|
|xScoreAll| EET's x-score from -2.5 to 2.5 (0 for participants with non-monotonic preferences).|
|yScoreAll| EET's y-score from -2.5 to 2.5 (0 for participants with non-monotonic preferences).|
|EET| EET archetypes that are either Selfish, Altruistic, Maximin, Inequality averse, Kiss up, Envious, Spiteful, Kick down, or Non-monotonic.|
|EETMono| EET monotonicity that is eiter 'Monotonic' or 'Non-monotonic' according to reveiled preferences.|
|Role.x| Trader type index for period 'x' that is either 'Informed trader' or 'Uninformed trader'.| 
|ProfitPeriod.x| Profit from market participation in Euro after redistribution and punishment in period 'x'.| 
|TradingProfit.x| Trading profits from market participation in experimental monetary units before redistribution and punishment in period 'x'.| 
|CompensationReceived.x| Sum of redistribution and punishment payments lost or received in period 'x'.|
|PDbefore.x| Wealth change in period 'x' before redistribution and punishment.|
|PDRedist.x| Wealth change in period 'x' after redistribution.|
|PDPun.x| Wealth change in period 'x' after redistribution and punishment.|
|PDbeforeVol.x| Wealth change in period 'x' per transacted asset before redistribution and punishment.|
|PDRedistVol.x| Wealth change in period 'x' per transacted asset after redistribution.|
|PDPunVol.x| Wealth change in period 'x' per transacted asset after redistribution and punishment.|
|Unmasked.x| Observers success in period 'x' to identify this trader when informed that is either 'Punished' in REG, 'Unmasked' in NOREG, 'not unmasked', or 'Uninformed trader'.|
|IsREG.x| Regulatory index for period 'x', which is either 'REG' for regulated markets or 'NOREG'.|
|IsInsider.x| Trader type index for period 'x' that is either 1 for informed traders or 0 otherwise.|
|PunPerceived| Self-description how punishment is perceived on a Likert scale from 1 (top low) to 7 (too high). PostQ1: 'If a trader with information is correctly selected by the observer, she loses her trading profit and must pay an additional penalty equal to the trading profit. Please indicate whether you consider this penalty to be appropriate, too low, or too high.'|
|ReasonVote| Self-description of their reasons to vote. PostQ2: 'Please describe concisely why you voted for or against the impact of the observer decisions on traders' period incomes. If you changed your vote during the experiment, what were the reasons?'|
|ChanceIdentification| Self-description of traders at the end of the experiment how they estimate the probability of a detection of informed traders from 0 to 100. PostQ3: 'How high do you estimate the probability that an observer correctly identifies a trader with information as such.'.|
|StrategyTrader| Self-description of traders at the end of the experiment of their trading strategy. PostQ4: 'What strategies did you use to avoid being recognized by observers as a trader with information?'.|
|RiskGeneral| Self-description of participants' risk tolerance at the end of the experiment on a Likert scale from 1 (not at all willing to take risks) to 11 (very willing to take risks). PostQ6: 'How do you see yourself: are you generally a person who is fully prepared to take risks or do you try to avoid taking risks?'.|
|RiskFinancial| Self-description of participants' financial risk tolerance at the end of the experiment on a Likert scale from 1 (not at all willing to take risks) to 11 (very willing to take risks). PostQ7: 'People can behave differently in different situations. How would you rate your willingness to take risks in financial matters?'.|
|LossAversion| Self-description of participants loss tolerance at the end of the experiment on a Likert scale from 1 (protection against losses) to 11 (participation to high returns). PostQ8: 'In financial decisions, both gains and losses are possible. To what extent do possible losses compared to possible gains influence you?'.|
|Faculty| Self-description of participants' department of studies. PostQ9: 'Which faculty are you studying at?'.|
|age| Self-description of participants' age. PostQ10a: 'Age in years'.|
|gender| Self-description of participants' gender which can be either 'female', 'male', or 'xdivers'. PostQ10b: 'Gender'|
|notes| Room for further comments concerning the experiment.|

### observers
The table 'observers' summarizes data for each observer in each period, i.e. two observations for each period and cohort. 

| Variable | Description |
---| ---|
|subjectID| ID variable, which uniquely identifies each participant from '1' to '320' (missing values indicate Experimenterg).|
|Group| ID variable, which uniquely identifies each session from '1' to '32'.|
|Date| Date and Program Starting Time of the experimental session in format yymmdd_hhmm.|
|Subject| ID variable, which identifies participants within an experimental session from '1' to '10'.|
|Period| Period index, ranging from '1' to '12'.|
|Treatment| Treatment index, which is either 'FIXEDNR', 'FIXEDRN', 'FLUCTNR', 'FLUCTRN'.|
|subTreatment| Treatment index specifying the regulation in Phases 1 & 3, which is either ''FIXED'' or 'FLUCT'.|
|regime_order| Treatment index specifying the order of market regulation in Phase 2, which is either 'NR' or 'RN'.| 
|BBV| Buyback Value.|
|BBVCent| Buyback Value centralized by the unconditional expected value of 57.5.|
|IsREG| Regulatory index, which is either 'REG' for regulated markets or 'NOREG'.|
|Role| Role index which is either 'Informed trader', 'Uninformed trader', 'Observer', or 'Experimenter'.|
|ExpectedRole| Trader type index which is either 'FLUCT' in treatment FLUCT, or 'Informed trader' or 'Uninformed trader' in treatment FIXED.|
|Referendum1| Binary variable that is either 'REG' when the Referendum outcome is in favor of regulation in Referendum 1, or 'NOREG' otherwise.|
|Referendum2| Binary variable that is either 'REG' when the Referendum outcome is in favor of regulation in Referendum 2, or 'NOREG' otherwise.|
|TotalProfit| Profit from participation in Euro at the end of an experimental session.|
|ProfitPeriod| Profit from market participation in Euro after redistribution and punishment.|
|NumSelected| Number of traders suspected to be informed after market closing.|
|NumDetections| Number of traders correctly identified to be informed after market closing.|
|NumPunished| Number of traders correctly identified to be informed in the regulatory regime REG after market closing.|
|NumMissuspected| Number of traders incorrectly suspected to be informed after market closing.|
|xScore| EET's x-score from -2.5 to 2.5 (NA for participants with non-monotonic preferences).|
|yScore| EET's y-score from -2.5 to 2.5 (NA for participants with non-monotonic preferences).|
|xScoreAll| EET's x-score from -2.5 to 2.5 (0 for participants with non-monotonic preferences).|
|yScoreAll| EET's y-score from -2.5 to 2.5 (0 for participants with non-monotonic preferences).|
|EET| EET archetypes that are either Selfish, Altruistic, Maximin, Inequality averse, Kiss up, Envious, Spiteful, Kick down, or Non-monotonic.|
|PunPerceived| Self-description how punishment is perceived on a Likert scale from 1 (top low) to 7 (too high). PostQ1: 'If a trader with information is correctly selected by the observer, she loses her trading profit and must pay an additional penalty equal to the trading profit. Please indicate whether you consider this penalty to be appropriate, too low, or too high.'|
|ObserverStrategy| Self-description of observers at the end of the experiment how they use information: PostQ5: 'Please describe how you think the available information (1. volume limit; 2. volume limit deleted; 3. trading volume limit; 4. trading volume market; 5. volume purchased; 6. volume sold; 7. volume purchased - sold; 8. average price; 9. average volume) can be used to identify informed traders!'.|
|RiskGeneral| Self-description of participants' risk tolerance at the end of the experiment on a Likert scale from 1 (not at all willing to take risks) to 11 (very willing to take risks). PostQ6: 'How do you see yourself: are you generally a person who is fully prepared to take risks or do you try to avoid taking risks?'.|
|RiskFinancial| Self-description of participants' financial risk tolerance at the end of the experiment on a Likert scale from 1 (not at all willing to take risks) to 11 (very willing to take risks). PostQ7: 'People can behave differently in different situations. How would you rate your willingness to take risks in financial matters?'.|
|LossAversion| Self-description of participants loss tolerance at the end of the experiment on a Likert scale from 1 (protection against losses) to 11 (participation to high returns). PostQ8: 'In financial decisions, both gains and losses are possible. To what extent do possible losses compared to possible gains influence you?'.|
|Faculty| Self-description of participants' department of studies. PostQ9: 'Which faculty are you studying at?'.|
|FacultyOther| If they specified other at department, they are asked to specify here their faculty.|
|age| Self-description of participants' age. PostQ10a: 'Age in years'.|
|gender| Self-description of participants' gender which can be either 'female', 'male', or 'xdivers'. PostQ10b: 'Gender'|
|notes| Room for further comments concerning the experiment.|

### transactions
The table 'transactions' summarizes data for each acceptence of a limit order, i.e. one observation per market order.

| Variable | Description |
---| ---|
|transactionID| ID variable, which uniquely identifies each market order from '1' to '10830'.|
|Group| ID variable, which uniquely identifies each session from '1' to '32'.|
|Date| Date and Program Starting Time of the experimental session in format yymmdd_hhmm.|
|Period| Period index, ranging from '1' to '12'.|
|Treatment| Treatment index, which is either 'FIXEDNR', 'FIXEDRN', 'FLUCTNR', 'FLUCTRN'.|
|subTreatment| Treatment index specifying the regulation in Phases 1 and 3, which is either ''FIXED'' or 'FLUCT'.|
|regime_order| Treatment index specifying the order of market regulation in Phase 2, which is either 'NR' or 'RN'.| 
|BBV| Buyback Value.|
|BBVCent| Buyback Value centralized by the unconditional expected value of 57.5.|
|IsREG| Regulatory index, which is either 'REG' for regulated markets or 'NOREG'.|
|type| Limit order index specifying whether the liquidity provider offers to buy ('BuyingOffer') or to sell ('SellingOffer').|
|TakerID| ID variable, which uniquely identifies the liquidity taker from '1' to '320'.|
|MakerID| ID variable, which uniquely identifies the liquidity provider from '1' to '320'.|
|MakerRole | Trader type index for the liquidity taker which is either 'Informed trader' or 'Uninformed trader'.|
|TakerRole| Trader type index for the liquidity provider which is either 'Informed trader' or 'Uninformed trader'.|
|Rolematching| Index how trader types matched that is either 'ii' for two informed traders matching, 'iu' for an informed trader accepting an uninformed trader's offer, 'iu' for an uninformed trader accepting an informed trader's offer, or 'uu* for two uninformed traders matching.|
|BuyerID| ID variable, which uniquely identifies the buying party from '1' to '320'.|
|SellerID| ID variable, which uniquely identifies the selling party from '1' to '320'.|
|Price| Price of the transactions at which the asset is bought and sold.|
|Pricewins| Price of the transactions at which the asset is bought and sold after a symmetric 90% winsorization of prices.|
|L.Pricewins| Last price before this market order after a symmetric 90% winsorization of prices.|
|L.Price| Last price before this market order.|
|return| Log price change between transactions, i.e., ln('Price') - ln('L.Price').|
|returnwins| Log price change between transactions after a symmetric 90% winsorization of prices.|
|returnwins2| Log price change between transactions after a symmetric 90% winsorization of returns.|
|transactionVol| Number of assets transacted via this market order.|
|remainingOfferVol| Number of assets offered via the respective limit order after the execution of this market order.|
|SellersProfit| Trading profit in experimental monetary units of the selling party by this market order.|
|shortsells| Number of assets sold by the selling party with negative asset endowment using the short limit capacity.|
|marginbuysTaler| Money spend to buy assets by the buying party with negative money endowment using the credit limit.|
|marginbuysAsset| Purchases by the buying party with negative money endowments divided by the transaction price.|
|time| Time in seconds that has been passed since the start of the auction until the market order was executed.|

### offers
The table 'offers' summarizes data for each placement of a limit order, i.e. one observation per limit order.

| Variable | Description |
---| ---|
|offerID| ID variable, which uniquely identifies each limit order from '1' to '15572'.|
|Group| ID variable, which uniquely identifies each session from '1' to '32'.|
|Date| Date and Program Starting Time of the experimental session in format yymmdd_hhmm.|
|Period| Period index, ranging from '1' to '12'.|
|Treatment| Treatment index, which is either 'NN.NR.RR', 'NN.RN.RR', 'RR.NR.NN', 'RR.NR.RR', 'RR.RN.NN', or 'RR.RN.RR'.|
|Period| Period index, ranging from '1' to '12'.|
|Treatment| Treatment index, which is either 'FIXEDNR', 'FIXEDRN', 'FLUCTNR', 'FLUCTRN'.|
|subTreatment| Treatment index specifying the regulation in Phases 1 and 3, which is either ''FIXED'' or 'FLUCT'.|
|regime_order| Treatment index specifying the order of market regulation in Phase 2, which is either 'NR' or 'RN'.| 
|BBV| Buyback Value.|
|BBVCent| Buyback Value centralized by the unconditional expected value of 57.5.|
|IsREG| Regulatory index, which is either 'REG' for regulated markets or 'NOREG'.|
|type| Limit order index specifying whether the liquidity provider offers to buy ('BuyingOffer') or to sell ('SellingOffer').|
|status| Limit order index, which is either 'cancelled' if this limit order got cancelled somewhen throughout the auction, 'on market' if this limit order remaind in the order book at market closing, 'sold out' when all assets were accepted by another party, or 'fully invalidated' when they are no longer feasible at market closing.|
|MakerID| ID variable, which uniquely identifies the liquidity provider from '1' to '320'.|
|MakerRole | Trader type index for the liquidity taker which is either 'Informed trader' or 'Uninformed trader'.|
|Price| Price of the limit order at which the asset is offered to buy or sell.|
|Volume| Number of assets offered via this limit order.|
|limitVolume| Number of assets offered via this limit order.|
|TotTransacted| Number of assets transacted via this limit order.|
|offerStart| Time in seconds that has been passed since the start of the auction until the limit order was placed.|
|offerEnd| Time in seconds that has been passed since the start of the auction until the end of the respective limit order, i.e., either at market closing, withdrawal, or when the limit order sold out.|

### seconds
The table 'seconds' summarizes data for each second within each market, i.e. 180 observations per period and cohort.

| Variable | Description |
---| ---|
|Group| ID variable, which uniquely identifies each session from '1' to '32'.|
|Date| Date and Program Starting Time of the experimental session in format yymmdd_hhmm.|
|Period| Period index, ranging from '1' to '12'.|
|Period0| Period index, ranging from '0' to '5', indicating the distance to the phase’s first period, starting with 0 to facilitate the interpretation of the intercept.|
|Treatment| Treatment index, which is either 'FIXEDNR', 'FIXEDRN', 'FLUCTNR', 'FLUCTRN'.|
|subTreatment| Treatment index specifying the regulation in Phases 1 and 3, which is either ''FIXED'' or 'FLUCT'.|
|regime_order| Treatment index specifying the order of market regulation in Phase 2, which is either 'NR' or 'RN'.| 
|BBV| Buyback Value.|
|BBVCent| Buyback Value centralized by the unconditional expected value of 57.5.|
|IsREG| Regulatory index, which is either 'REG' for regulated markets or 'NOREG'.|
|MA| Moving average of transaction volume with past volume being weighted by $$\left\{\frac{1}{2}^n\quad\vert\quad n\in\{1,2,\ldots, 8, 9, 9\}\right\}$$.|
|BestBid| Active bid in the order book at this time which offered the highest bid price.|
|BestAsk| Active ask in the order book at this time which offered assets for the lowest ask price.|
|BAspread| Difference between best bid and best ask price each second.|
|midpointBA| Midpoint between best bid and best ask price each second.|
|BestBidwins| Active bid in the order book at this time which offered the highest bid price after a symmetric 90% winsorization of prices.|
|BestAskwins| Active ask in the order book at this time which offered assets for the lowest ask price after a symmetric 90% winsorization of prices.|
|BAspreadwins| Difference between best bid and best ask price each second after a symmetric 90% winsorization of prices.|
|BAspreadwins2| Difference between best bid and best ask price each second after a symmetric 90% winsorization of spreads.|
|lastPrice| Last transaction price in a market before this second.|
|lnlastPrice| Log transformed last transaction price in a market.|
|L.lnlastPrice| Log transformed price in a market in the previous second.|
|return| Log-change in prices between last seconds.|

### avgtraderprofit
The table 'avgtraderprofit' summarizes data for each individual trader, i.e. 9 observations for each cohort. 

| Variable | Description |
---| ---|
|subjectID| ID variable, which uniquely identifies each participant from '1' to '320' (missing values in the data table were observers).|
|Group| ID variable, which uniquely identifies each session from '1' to '32'.|
|AvgPDbeforeInf| Arithmetic mean of wealth changes per transacted asset before redistribution and punishment in periods this trader is informed.|
|AvgPDbeforeUni| Arithmetic mean of wealth changes per transacted asset before redistribution and punishment in periods this trader is uninformed.|
|rankavgPDbeforeInf| Ordered rank of average wealth change before redistribution and punishment throughout the experiment when informed from '1' (lowest) to '9' (highest).|
|rankavgPDbeforeUni| Ordered rank of average wealth change before redistribution and punishment throughout the experiment when uninformed from '1' (lowest) to '9' (highest).|

*******************************************************************************
\newpage

## Majority vote

Test treatment differences in Referenda 1 & 2 reported in Result 2 in Section 3.1
```{r testMajorityTreatmentDiff, echo = F}
prop.test(x = c(sum(subset(voteGroup, Referendum != "Referendum 3" & subTreatment == "FIXED")$Vote > 4), sum(subset(voteGroup, Referendum != "Referendum 3" & subTreatment == "FLUCT")$Vote > 4)), n = c(32,32), alternative = "two.sided") ## reported in Result 2
```

```{r cumVote, echo = F, include=F}
{
  cV <- aggregate(cbind((Vote>=0), VoteUni) ~ regime_order + subTreatment + as.factor(Vote), data=subset(voteGroup, Referendum != "Referendum 3"), FUN = function(x) sum(x, na.rm = T), na.action = na.pass)
  cV2 <- aggregate(cbind((Vote>=0), VoteUni) ~ subTreatment + as.factor(Vote), data=subset(voteGroup, Referendum != "Referendum 3"), FUN = function(x) sum(x, na.rm = T), na.action = na.pass)
  cV2$regime_order <- "Total"
  cV <- rbind(cV, cV2)
  
  cV3 <- aggregate(cbind((Vote>=0), VoteUni) ~ regime_order + as.factor(Vote), data=subset(voteGroup, Referendum != "Referendum 3"), FUN = function(x) sum(x, na.rm = T), na.action = na.pass)
  cV4 <- aggregate(cbind((Vote>=0), VoteUni) ~ as.factor(Vote), data=subset(voteGroup, Referendum != "Referendum 3"), FUN = function(x) sum(x, na.rm = T), na.action = na.pass)
  cV4$regime_order <- "Total"
  cV3 <- rbind(cV3, cV4)
  cV3$subTreatment <- "Total"
  cV <- rbind(cV, cV3)

  colnames(cV)<- c("order", "subTreatment", "Votes", "n", "VotesUni")
  cV$traderType <- "all"
  cV$order <- factor(factor(cV$order), levels = rev(levels(factor(cV$order))))
  cV$VotesUni <- cV$VotesUni / as.numeric(levels(cV$Votes))[cV$Votes]
  cV$VotesUni[is.na(cV$VotesUni)] <- 0
  cV$Votes <- factor(cV$Votes, levels = 0:9, labels = c("0/9", "1/8", "2/7", "3/6", "4/5", "5/4", "6/3", "7/2", "8/1", "9/0"))
  cV$majority <- factor(cV$Votes, levels = c("0/9", "1/8", "2/7", "3/6", "4/5", "5/4", "6/3", "7/2", "8/1", "9/0"), labels = c(1,1,1,1,1,0,0,0,0,0))
  
  cVu <- aggregate((VoteUni>=0) ~ regime_order + subTreatment + as.factor(VoteUni), data=subset(voteGroup, Referendum != "Referendum 3"), FUN = function(x) sum(x, na.rm = T), na.action = na.pass)
  cV2u <- aggregate((VoteUni>=0) ~ subTreatment + as.factor(VoteUni), data=subset(voteGroup, Referendum != "Referendum 3"), FUN = function(x) sum(x, na.rm = T), na.action = na.pass)
  cV2u$regime_order <- "Total"
  cVu <- rbind(cVu, cV2u)
  
  cV3u <- aggregate((VoteUni>=0) ~ regime_order + as.factor(VoteUni), data=subset(voteGroup, Referendum != "Referendum 3"), FUN = function(x) sum(x, na.rm = T), na.action = na.pass)
  cV4u <- aggregate((VoteUni>=0) ~ as.factor(VoteUni), data=subset(voteGroup, Referendum != "Referendum 3"), FUN = function(x) sum(x, na.rm = T), na.action = na.pass)
  cV4u$regime_order <- "Total"
  cV3u <- rbind(cV3u, cV4u)
  cV3u$subTreatment <- "Total"
  cVu <- rbind(cVu, cV3u)

  colnames(cVu)<- c("order", "subTreatment", "Votes", "n")
  cVu$traderType <- "uninformed trader"
  cVu$order <- factor(factor(cVu$order), levels = rev(levels(factor(cVu$order))))
  cVu$Votes <- factor(cVu$Votes, levels = 0:6, labels = c("0/6", "1/5", "2/4", "3/3", "4/2", "5/1", "6/0"))
  cVu$majority <- factor(cVu$Votes, levels = c("0/6", "1/5", "2/4", "3/3", "4/2", "5/1", "6/0"), labels = c(1,1,1,.5,0,0,0))
  cVu$VotesUni <- 1
  cV <- rbind(cV, cVu)
  
  cV$subTreatment <-  factor(cV$subTreatment, levels = c("FIXED", "FLUCT", "Total"))
  
  cV5 <- data.frame("order"=c("NR","NR","RN","NR","RN","NR"), "subTreatment"=c("FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED"), "Votes"=c("9/0", "0/6", "0/6", "1/5", "2/4", "6/0"), "n" = 0, "VotesUni"=c(0,0,0,0,0,0), "traderType"=c("all", "uninformed trader", "uninformed trader", "uninformed trader", "uninformed trader", "uninformed trader"), "majority" = c(0, 0,0,0,0,1))
  cV <- rbind(cV, cV5)
}

cVtext <- data.frame("Votes" = c("2/7", "6/3"), "subTreatment" = c("FIXED", "FIXED"), "text" = c("NOREG", "REG"), "n" = c(9, 9))

cVtextUni <- data.frame("Votes" = c("1/5", "5/1"), "subTreatment" = c("FIXED", "FIXED"), "text" = c("NOREG", "REG"), "n" = c(11, 11))
```

```{r Referenda, echo = F, include=F}
{ 
  t <- aggregate(as.numeric(Vote>4) ~  regime_order + subTreatment, data=subset(voteGroup, Referendum != "Referendum 3"), function(x) mean(x, na.rm = T), na.action = na.pass)
  tn <- aggregate(as.numeric(Vote>4) ~  regime_order + subTreatment, data=subset(voteGroup, Referendum != "Referendum 3"), function(x) length(x))
  colnames(tn) <- c("regime_order", "subTreatment", "n")
  tsd <- aggregate(as.numeric(Vote>4) ~  regime_order + subTreatment, data=subset(voteGroup, Referendum != "Referendum 3"), function(x) sd(x, na.rm = T), na.action = na.pass)
  colnames(tsd) <- c("regime_order", "subTreatment", "sdRegime")
  t <- merge(t,tsd, by=c("regime_order", "subTreatment"))
  t <- merge(t,tn, by=c("regime_order", "subTreatment"))
  t2 <- aggregate(as.numeric(Vote>4) ~  subTreatment, data=subset(voteGroup, Referendum != "Referendum 3"), function(x) mean(x, na.rm = T), na.action = na.pass)
  t2sd <- aggregate(as.numeric(Vote>4) ~  subTreatment, data=subset(voteGroup, Referendum != "Referendum 3"), function(x) sd(x, na.rm = T), na.action = na.pass)
  colnames(t2sd) <- c( "subTreatment", "sdRegime")
  t2 <- merge(t2,t2sd, by=c("subTreatment"))
  t2$regime_order <- "Total"
  t2n <- aggregate(as.numeric(Vote>4) ~  subTreatment, data=subset(voteGroup, Referendum != "Referendum 3"), function(x) length(x))
  colnames(t2n) <- c( "subTreatment", "n")
  t2 <- merge(t2,t2n, by=c("subTreatment"))
  t <- rbind(t, t2)
  
  t3 <- aggregate(as.numeric(Vote>4) ~  regime_order, data=subset(voteGroup, Referendum != "Referendum 3"), function(x) mean(x, na.rm = T), na.action = na.pass)
  t3n <- aggregate(as.numeric(Vote>4) ~  regime_order, data=subset(voteGroup, Referendum != "Referendum 3"), function(x) length(x))
  colnames(t3n) <- c("regime_order", "n")
  t3sd <- aggregate(as.numeric(Vote>4) ~  regime_order, data=subset(voteGroup, Referendum != "Referendum 3"), function(x) sd(x, na.rm = T), na.action = na.pass)
  colnames(t3sd) <- c("regime_order", "sdRegime")
  t3 <- merge(t3,t3sd, by=c("regime_order"))
  t3 <- merge(t3,t3n, by=c("regime_order"))
  t3$subTreatment <- "Total"
  t4 <- aggregate(as.numeric(Vote>4) ~ 1, data=subset(voteGroup, Referendum != "Referendum 3"), function(x) mean(x, na.rm = T), na.action = na.pass)
  t4sd <- aggregate(as.numeric(Vote>4) ~  1, data=subset(voteGroup, Referendum != "Referendum 3"), function(x) sd(x, na.rm = T), na.action = na.pass)
  colnames(t4sd) <- c("sdRegime")
  t4 <- merge(t4,t4sd)
  t4$regime_order <- "Total"
  t4$subTreatment <- "Total"
  t4n <- aggregate(as.numeric(Vote>4) ~  1, data=subset(voteGroup, Referendum != "Referendum 3"), function(x) length(x))
  colnames(t4n) <- c("n")
  t4 <- merge(t4,t4n)
  t <- rbind(t, t3)
  t <- rbind(t, t4)
  colnames(t)<- c("order", "subTreatment", "Regime", "sdRegime", "n")
  t$ll <- t$Regime + qt(.025,t$n)*t$sdRegime/sqrt(t$n)
  t$ul <- t$Regime + qt(.975,t$n)*t$sdRegime/sqrt(t$n)
  t$order <- factor(t$order, levels = c("Total", "NR", "RN"))
  t$subTreatment <- factor(t$subTreatment, levels = c("Total", "FIXED", "FLUCT"), labels = c("Referenda 1 & 2", "FIXED", "FLUCT"))
  t$llbinom <- t$Regime + qt(.025,t$n)*sqrt(t$Regime*(1-t$Regime)/t$n)
  t$ulbinom <- t$Regime + qt(.975,t$n)*sqrt(t$Regime*(1-t$Regime)/t$n)
  t$binconf <- binconf(t$Regime*t$n, t$n, alpha = 0.05, method = "wilson")
  t$lllog <- exp(log(t$Regime) - log(qt(.975,t$n)*sqrt(t$Regime*(1-t$Regime)/t$n)))
  t$ullog <- exp(log(t$Regime) + log(qt(.975,t$n)*sqrt(t$Regime*(1-t$Regime)/t$n)))
}
```

```{r Referendum3rd, echo = F, include=F}
voteGroup$ReferendumOutcome <- factor(voteGroup$Vote > 4, levels = c(T,F), labels = c("REG", "NOREG"))
{
  tt <- aggregate(as.numeric(ReferendumOutcome == "REG") ~  regime_order + subTreatment, data=subset(voteGroup) , FUN = function(x) mean(x, na.rm = T), na.action = na.pass)
  ttn <- aggregate(as.numeric(ReferendumOutcome == "REG") ~  regime_order + subTreatment, data=subset(voteGroup) , FUN = function(x) length(x))
  colnames(ttn) <- c("regime_order", "subTreatment", "n")
  ttsd <- aggregate(as.numeric(ReferendumOutcome == "REG") ~  regime_order + subTreatment, data=subset(voteGroup) , FUN = function(x) sd(x, na.rm = T), na.action = na.pass)
  colnames(ttsd) <- c("regime_order", "subTreatment", "sdRegime")
  tt <- merge(tt,tsd, by=c("regime_order", "subTreatment"))
  tt <- merge(tt,tn, by=c("regime_order", "subTreatment"))
  tt2 <- aggregate(as.numeric(ReferendumOutcome == "REG") ~  subTreatment, data=subset(voteGroup) , FUN = function(x) mean(x, na.rm = T), na.action = na.pass)
  tt2sd <- aggregate(as.numeric(ReferendumOutcome == "REG") ~  subTreatment, data=subset(voteGroup) , FUN = function(x) sd(x, na.rm = T), na.action = na.pass)
  colnames(tt2sd) <- c( "subTreatment", "sdRegime")
  tt2 <- merge(tt2,tt2sd, by=c("subTreatment"))
  tt2$regime_order <- "Total"
  tt2n <- aggregate(as.numeric(ReferendumOutcome == "REG") ~  subTreatment, data=subset(voteGroup) , FUN = function(x) length(x))
  colnames(tt2n) <- c( "subTreatment", "n")
  tt2 <- merge(tt2,tt2n, by=c("subTreatment"))
  tt <- rbind(tt, tt2)
  
  tt3 <- aggregate(as.numeric(ReferendumOutcome == "REG") ~  regime_order, data=subset(voteGroup) , FUN = function(x) mean(x, na.rm = T), na.action = na.pass)
  tt3n <- aggregate(as.numeric(ReferendumOutcome == "REG") ~  regime_order, data=subset(voteGroup) , FUN = function(x) length(x))
  colnames(tt3n) <- c("regime_order", "n")
  tt3sd <- aggregate(as.numeric(ReferendumOutcome == "REG") ~  regime_order, data=subset(voteGroup) , FUN = function(x) sd(x, na.rm = T), na.action = na.pass)
  colnames(tt3sd) <- c("regime_order", "sdRegime")
  tt3 <- merge(tt3,t3sd, by=c("regime_order"))
  tt3 <- merge(tt3,t3n, by=c("regime_order"))
  tt4 <- aggregate(as.numeric(ReferendumOutcome == "REG") ~  1, data=subset(voteGroup) , FUN = function(x) mean(x, na.rm = T), na.action = na.pass)
  tt4sd <- aggregate(as.numeric(ReferendumOutcome == "REG") ~  1, data=subset(voteGroup) , FUN = function(x) sd(x, na.rm = T), na.action = na.pass)
  colnames(tt4sd) <- c("sdRegime")
  tt4n <- aggregate(as.numeric(ReferendumOutcome == "REG") ~  1, data=subset(voteGroup) , FUN = function(x) length(x))  
  colnames(tt4n) <- c("n")  
  tt4 <- cbind(tt4,tt4sd, tt4n)
  tt4$regime_order <- "Total"
  tt3 <- rbind(tt3, tt4)
  tt3$subTreatment <- "Referenda 1, 2, & 3"
  tt <- rbind(tt, tt3)

  colnames(tt)<- c("order", "subTreatment", "Regime", "sdRegime", "n")
  tt$ll <- tt$Regime - qt(.025,tt$n)*tt$sdRegime/sqrt(tt$n)
  tt$ul <- tt$Regime + qt(.025,tt$n)*tt$sdRegime/sqrt(tt$n)
  tt$order <- factor(factor(tt$order), levels = rev(levels(factor(tt$order))))
}
```

```{r logitpoisson, echo = F}
lmMajorityre <- lmer((Vote>=5) ~ subTreatment * regime_order + Referendum + (1|Group), data = subset(voteGroup))

## logit model all referenda (Table OA1 Model 1)
binomMajorityre <- glmer((Vote>=5) ~ subTreatment * regime_order + Referendum + (1|Group), 
               family = binomial(link = logit),  data = subset(voteGroup))

binomMajorityreAME1 <- mean((predict(binomMajorityre, type = "response")))
binomMajorityreAME <- binomMajorityreAME1 * (1 - binomMajorityreAME1) * coef(binomMajorityre)$Group[18,]
int_pred_binomMajorityre <- 1/(1+exp(-(mean(coef(binomMajorityre)$Group[,"(Intercept)"]))))

## logit model Referenda 1 & 2 (Table 1 Model 2)
binomMajorityre12 <- glmer((Vote>=5) ~ subTreatment * regime_order + Referendum + (1|Group), 
               family = binomial(link = logit),  data = subset(voteGroup, Referendum != "Referendum 3"))

binomMajorityre12AME1 <- mean((predict(binomMajorityre12, type = "response")))
binomMajorityre12AME <- binomMajorityre12AME1 * (1 - binomMajorityre12AME1) * coef(binomMajorityre12)$Group[18,]
int_pred_binomMajorityre12 <- 1/(1+exp(-(mean(coef(binomMajorityre12)$Group[,"(Intercept)"]))))

## logit model Referenda 1 & 2 (Table 1 Model 1)
binomMajorityre12s <- glmer((Vote>=5) ~ subTreatment + regime_order + Referendum + (1|Group), family = binomial(link = logit),  data = subset(voteGroup, Referendum != "Referendum 3"))

binomMajorityre12sAME1 <- mean((predict(binomMajorityre12s, type = "response")))
binomMajorityre12sAME <- binomMajorityre12sAME1 * (1 - binomMajorityre12sAME1) * coef(binomMajorityre12s)$Group[18,]
int_pred_binomMajorityre12s <- 1/(1+exp(-(mean(coef(binomMajorityre12s)$Group[,"(Intercept)"]))))

## logit model Referendum 3 (Table OA1 Model 3)
binomMajority3 <- glm((Vote>=5) ~ subTreatment * regime_order, 
               family = binomial(link = logit),  data = subset(voteGroup, Referendum == "Referendum 3"))

se_binomMajority3 <- coeftest(binomMajority3, vcov. = sandwich)
binomMajority3AME1 <- mean((predict(binomMajority3, type = "response")))
binomMajority3AME <- binomMajority3AME1 * (1 - binomMajority3AME1) * coef(binomMajority3)
int_pred_binomMajority3 <- 1/(1+exp(-(coef(binomMajority3)["(Intercept)"])))

## logit model Referendum 2 (Table OA1 Model 2)
binomMajority2 <- glm((Vote>=5) ~ subTreatment * regime_order + Referendum1, 
               family = binomial(link = logit),  data = subset(voteGroup, Referendum == "Referendum 2"))

se_binomMajority2 <- coeftest(binomMajority2, vcov. = sandwich)
binomMajority2AME1 <- mean((predict(binomMajority2, type = "response")))
binomMajority2AME <- binomMajority2AME1 * (1 - binomMajority2AME1) * coef(binomMajority2)
int_pred_binomMajority2 <- 1/(1+exp(-(coef(binomMajority2)["(Intercept)"])))

## Poisson model all Referenda (Table OA1 Model 4)
poissonre <- glmer(Vote ~ subTreatment * regime_order + Referendum + (1|Group), 
                  family = poisson, data = voteGroup)

poissonreAME1 <- mean((predict(poissonre, type = "response")))
poissonreAME <- poissonreAME1 * coef(poissonre)$Group[18,]
int_pred_poissonre <- exp(mean((coef(poissonre)$Group)[,"(Intercept)"]))

## Poisson model Referenda 1 & 2 (Table 1 Model 4)
poissonre12 <- glmer(Vote ~ subTreatment * regime_order + Referendum + (1|Group), 
                  family = poisson, data = subset(voteGroup, Referendum != "Referendum 3"))

poissonre12AME1 <- mean((predict(poissonre12, type = "response")))
poissonre12AME <- poissonre12AME1 * coef(poissonre12)$Group[18,]
int_pred_poissonre12 <- exp(mean((coef(poissonre12)$Group)[,"(Intercept)"]))

## Poisson model Referenda 1 & 2 (Table 1 Model 3)
poissonre12s <- glmer(Vote ~ subTreatment + regime_order + Referendum + (1|Group), 
                  family = poisson, data = subset(voteGroup, Referendum != "Referendum 3"))

poissonre12sAME1 <- mean((predict(poissonre12s, type = "response")))
poissonre12sAME <- poissonre12sAME1 * coef(poissonre12s)$Group[18,]
int_pred_poissonre12s <- exp(mean((coef(poissonre12s)$Group)[,"(Intercept)"]))

## Poisson model Referendum 3 (Table OA1 Model 6)
poisson3 <- glm(Vote ~ subTreatment * regime_order, 
                  family = poisson, data = subset(voteGroup, Referendum == "Referendum 3"))

se_poisson3 <- coeftest(poisson3, vcov. = sandwich)
poisson3AME1 <- mean((predict(poisson3, type = "response")))
poisson3AME <- poisson3AME1 * coef(poisson3)
int_pred_poisson3 <- exp(coef(poisson3)["(Intercept)"])

## Poisson model Referendum 2 (Table OA1 Model 5)
poisson2 <- glm(Vote ~ subTreatment * regime_order + Referendum1, 
                  family = poisson, data = subset(voteGroup, Referendum == "Referendum 2"))

se_poisson2 <- coeftest(poisson2, vcov. = sandwich)
poisson2AME1 <- mean((predict(poisson2, type = "response")))
poisson2AME <- poisson2AME1 * coef(poisson2)
int_pred_poisson2 <- exp(coef(poisson2)["(Intercept)"])

## function to set empty cells in table
tempty <- function(x) {
  return(c(1:x)/c(1:x))
}
```

```{r Table1wAME, echo=F, results='hide'}
texreg(list(binomMajorityre12s, binomMajorityre12s, binomMajorityre12, binomMajorityre12, poissonre12s, poissonre12s, poissonre12, poissonre12),  custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"),  
       caption = "[Table 1:] Mixed effects logit and Poisson regressions of (majority) votes in favor of regulation by referendum.",
       label = "Table1",
       custom.model.names = c("(1) Logit", " ", "(2) Logit", " ", "(3) Poisson", " ", "(4) Poisson", " "),
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,
       override.coef = list(NA, as.numeric(binomMajorityre12sAME), NA, as.numeric(binomMajorityre12AME), NA, as.numeric(poissonre12sAME), NA, as.numeric(poissonre12AME)),
       custom.gof.rows = list(
         "mu(Intercept)" = c(int_pred_binomMajorityre12s, int_pred_binomMajorityre12s, int_pred_binomMajorityre12, int_pred_binomMajorityre12, int_pred_poissonre12s, int_pred_poissonre12s, int_pred_poissonre12, int_pred_poissonre12),
         "Avg. predicted probability" = c(binomMajorityre12sAME1, binomMajorityre12sAME1, binomMajorityre12AME1, binomMajorityre12AME1, poissonre12sAME1, poissonre12sAME1, poissonre12AME1, poissonre12AME1),
         "McFadden R^2" = c(
           1 - as.vector(logLik(binomMajorityre12s) / logLik(update(binomMajorityre12s, . ~ 1|Group))),
           1 - as.vector(logLik(binomMajorityre12s) / logLik(update(binomMajorityre12s, . ~ 1|Group))),
           1 - as.vector(logLik(binomMajorityre12) / logLik(update(binomMajorityre12, . ~ 1|Group))),
           1 - as.vector(logLik(binomMajorityre12) / logLik(update(binomMajorityre12, . ~ 1|Group))),
           1 - as.vector(logLik(poissonre12s) / logLik(update(poissonre12s, . ~ 1|Group))),
           1 - as.vector(logLik(poissonre12s) / logLik(update(poissonre12s, . ~ 1|Group))),
           1 - as.vector(logLik(poissonre12) / logLik(update(poissonre12, . ~ 1|Group))),
           1 - as.vector(logLik(poissonre12) / logLik(update(poissonre12, . ~ 1|Group)))
           )
       )
)
```

```{r Table1, echo=F, results='asis'}
## Table 1
texreg(list(binomMajorityre12s, binomMajorityre12, poissonre12s, poissonre12),  custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"),  
       caption = "[Table 1:] Mixed effects logit and Poisson regressions of (majority) votes in favor of regulation by referendum.",
       label = "Table1",
       custom.model.names = c("(1) Logit", "(2) Logit", "(3) Poisson", "(4) Poisson"),
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,
       custom.gof.rows = list(
         "mu(Intercept)" = c(int_pred_binomMajorityre12s, int_pred_binomMajorityre12, int_pred_poissonre12s, int_pred_poissonre12),
         "Avg. predicted probability" = c(binomMajorityre12sAME1, binomMajorityre12AME1, poissonre12sAME1, poissonre12AME1),
         "McFadden R^2" = c(
           1 - as.vector(logLik(binomMajorityre12s) / logLik(update(binomMajorityre12s, . ~ 1|Group))),
           1 - as.vector(logLik(binomMajorityre12) / logLik(update(binomMajorityre12, . ~ 1|Group))),
           1 - as.vector(logLik(poissonre12s) / logLik(update(poissonre12s, . ~ 1|Group))),
           1 - as.vector(logLik(poissonre12) / logLik(update(poissonre12, . ~ 1|Group)))
           )
       )
)
```

Test treatment differences in Referenda 1 & 2 (in setting RN) based on Model 2 of Table 1 reported in Result 2 in Section 3.1
```{r testTreatmentModel2, echo=F}
linearHypothesis(binomMajorityre12, c('subTreatmentFIXED + regime_orderRN + subTreatmentFIXED:regime_orderRN = 0'), singular.ok = T)
```

```{r TableOA1wAME, echo=F, results='hide'}
texreg(list(binomMajorityre, binomMajorityre, binomMajority2, binomMajority2, binomMajority3, binomMajority3, poissonre, poissonre, poisson2, poisson2, poisson3, poisson3), custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"), 
       caption = "[Table OA1:] Logit and Poisson regressions of (majority) votes in favor of regulation by referendum (all referenda).",
       label = "TableOA1",
       custom.model.names = c("(1) Log all ref.", " ", "(2) Log Ref. 2", " ", "(3) Log Ref. 3", " ", "(4) Poi all ref", " ", "(2) Poi Ref. 2", " ", "(3) Poi Ref. 3", " "),
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,
       override.coef = list(NA, as.numeric(binomMajorityreAME), NA, as.numeric(binomMajority2AME), NA, as.numeric(binomMajority3AME), NA, as.numeric(poissonreAME), NA, as.numeric(poisson2AME), NA, as.numeric(poisson3AME)),
       override.se = list(NA,tempty(6), se_binomMajority2[,2], tempty(5), se_binomMajority3[,2], tempty(4), NA, tempty(6), se_poisson2[,2], tempty(5), se_poisson3[,2], tempty(4)),
       override.pvalues = list(NA,tempty(6), se_binomMajority2[,4], tempty(5), se_binomMajority3[,4], tempty(4), NA, tempty(6), se_poisson2[,4], tempty(5), se_poisson3[,4], tempty(4)),
       custom.gof.rows = list(
         "mu(Intercept)" = c(int_pred_binomMajorityre, int_pred_binomMajorityre, int_pred_binomMajority2, int_pred_binomMajority2, int_pred_binomMajority3, int_pred_binomMajority3, int_pred_poissonre, int_pred_poissonre, int_pred_poisson2, int_pred_poisson2, int_pred_poisson3, int_pred_poisson3),
         "Avg. predicted probability" = c(binomMajorityreAME1, binomMajorityreAME1, binomMajority2AME1, binomMajority2AME1, binomMajority3AME1, binomMajority3AME1, poissonreAME1, poissonreAME1, poisson2AME1, poisson2AME1, poisson3AME1, poisson3AME1),
         "McFadden R^2" = c(
           1 - as.vector(logLik(binomMajorityre) / logLik(update(binomMajorityre, . ~ 1|Group))),
           1 - as.vector(logLik(binomMajorityre) / logLik(update(binomMajorityre, . ~ 1|Group))), 
           1 - as.vector(logLik(binomMajority2) / logLik(update(binomMajority2, . ~ 1|Group))), 
           1 - as.vector(logLik(binomMajority2) / logLik(update(binomMajority2, . ~ 1|Group))), 
           1 - as.vector(logLik(binomMajority3) / logLik(update(binomMajority3, . ~ 1|Group))), 
           1 - as.vector(logLik(binomMajority3) / logLik(update(binomMajority3, . ~ 1|Group))),
           1 - as.vector(logLik(poissonre) / logLik(update(poissonre, . ~ 1|Group))),
           1 - as.vector(logLik(poissonre) / logLik(update(poissonre, . ~ 1|Group))), 
           1 - as.vector(logLik(poisson2) / logLik(update(poisson3, . ~ 1|Group))), 
           1 - as.vector(logLik(poisson2) / logLik(update(poisson3, . ~ 1|Group))), 
           1 - as.vector(logLik(poisson3) / logLik(update(poisson3, . ~ 1|Group))), 
           1 - as.vector(logLik(poisson3) / logLik(update(poisson3, . ~ 1|Group)))
           ))
       )
```

```{r TableOA1, echo=F, results='asis'}
texreg(list(binomMajorityre, binomMajority2, binomMajority3, poissonre, poisson2, poisson3), custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"), 
       caption = "[Table OA1:] Logit and Poisson regressions of (majority) votes in favor of regulation by referendum (all referenda).",
       label = "TableOA1",
       custom.model.names = c("(1) Log all ref", "(2) Log Ref 2", "(3) Log Ref 3", "(4) Poi all ref", "(2) Poi Ref 2", "(3) Poi Ref 3"),
       custom.coef.names = c("(Intercept)", "FIXED", "orderRN", "Referendum 2", "Referendum 3", "FIXED : RN", "Referendum 1 REG"),
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,
       custom.gof.rows = list(
         "mu(Intercept)" = c(int_pred_binomMajorityre, int_pred_binomMajority2, int_pred_binomMajority3, int_pred_poissonre, int_pred_poisson2, int_pred_poisson3),
         "Avg. predicted probability" = c(binomMajorityreAME1, binomMajority2AME1, binomMajority3AME1, poissonreAME1, poisson2AME1, poisson3AME1),
         "McFadden R^2" = c(
           1 - as.vector(logLik(binomMajorityre) / logLik(update(binomMajorityre, . ~ 1|Group))),
           1 - as.vector(logLik(binomMajority2) / logLik(update(binomMajority2, . ~ 1|Group))), 
           1 - as.vector(logLik(binomMajority3) / logLik(update(binomMajority3, . ~ 1|Group))),
           1 - as.vector(logLik(poissonre) / logLik(update(poissonre, . ~ 1|Group))), 
           1 - as.vector(logLik(poisson2) / logLik(update(poisson3, . ~ 1|Group))),
           1 - as.vector(logLik(poisson3) / logLik(update(poisson3, . ~ 1|Group)))
           ))
       )
```

```{r predictlogit, echo = F, include=F}
ndata <- data.frame(regime_order = rep(c("NR", "RN"), each = 6), subTreatment = rep(c("FLUCT", "FIXED"), each = 3), Referendum = c("Referendum 1", "Referendum 2"), Group = 18)
#predict response
ndata$pred <- predict(binomMajorityre12, newdata=ndata, type = "response", re.form=NA)
ndata$predlink <- predict(binomMajorityre12, newdata=ndata, type = "link", re.form=NA)
x <- model.matrix(~ subTreatment * regime_order + Referendum, data = ndata)
ndata$se <- sqrt(diag(x %*% vcov(binomMajorityre12) %*% t(x)))
n <- 32
K <- 3
ndata$ll <- 1/(1+exp(-(ndata$predlink + qt(.025, df = n - K) * ndata$se)))
ndata$ul <- 1/(1+exp(-(ndata$predlink + qt(.975, df = n - K) * ndata$se)))
sdata <- subset(ndata, Referendum == "Referendum 1", select = c("regime_order", "subTreatment", "pred", "ll", "ul"))

nndata <- subset(t, select = c("order", "subTreatment", "Regime"))
nndata$ll <- t$binconf[,2]
nndata$ul <- t$binconf[,3]
nndata$var <- "Descriptive"

colnames(sdata) <- c("order", "subTreatment", "Regime", "ll", "ul")
sdata$var <- "Prescriptive"
nndata <- rbind(nndata, sdata)
nndata$var[nndata$order == "Total"] <- "Total"
nndata$var <- factor(nndata$var, levels = c("Total", "Descriptive", "Prescriptive"))
nndata$subTreatment <- factor(nndata$subTreatment, levels = c("FLUCT", "FIXED"))
```

```{r graphicFigureOA1, echo=F, fig.cap="[Figure OA1:] Share of referenda in favor of regulation by treatment and starting regime."}
#postscript("Figures/xxx_FigureOA1_regimes.eps")
ggplot(data=subset(nndata, subTreatment != "Referenda 1 & 2"), aes(y=Regime , x= order, group=var, fill = var)) +
    geom_bar(stat="identity", position = position_dodge(width = 0.7)#, size = 2 # used in paper but not in Rmarkdown output
             ) +
    labs(y="Share of referenda in favor of regulation") +
    geom_errorbar(aes(ymin=ll, ymax=ul, group=var, color = order), position = position_dodge(width = 0.7), width=.2) +
    theme(#text = element_text(size=18), legend.text = element_text(size = 18), # used in paper but not in Rmarkdown output
          axis.title.x = element_blank(), legend.title = element_blank(), legend.position = "bottom", legend.direction = "horizontal", legend.spacing.x = unit(0, "cm"), panel.grid.major.y = element_line(colour = "lightgrey"), panel.background = element_rect(fill = "transparent"), plot.background = element_rect(fill = "transparent"), strip.background.y = element_rect(fill = "transparent"), #strip.text = element_text(size=18), # used in paper but not in Rmarkdown output
          strip.placement = "outside", strip.clip = "off", axis.text.x = element_text(margin = margin(t = -10)), # axis.text.x = element_text(margin = margin(t = -30)), # used in paper but not in Rmarkdown output
          axis.ticks.x = element_blank()) +
    facet_wrap(. ~ subTreatment,scales = "free_x") +
    scale_y_continuous(limits = c(-0.05, 1), breaks = seq(0, 1, by = .1)) +
    scale_fill_manual(values = c("Descriptive" = rgb(1,.84,.0), "Prescriptive" = rgb(1,.4,.1), "Total" = "black"), name = "barFill", guide = "legend", labels = c("", "Observed probabilities    ","Predicted probabilities")) + 
    scale_color_manual("order", values=c("dimgrey", "black", "black", "dimgrey","black","black"), name = 'lines', guide = 'none',labels = '') +
    scale_size_manual(values = 5)
#dev.off()
```

```{r predpoisson, echo=F, include=F}
ndata <- data.frame(regime_order = rep(c("NR", "RN"), each = 4), subTreatment = rep(c("FLUCT", "FIXED"), each = 2), Referendum = c("Referendum 1", "Referendum 2"), Group = 18)
#predict response
ndata$pred <- predict(poissonre12, newdata=ndata, type = "response", se = F, re.form=NA)
ndata$predlink <- predict(poissonre12, newdata=ndata, type = "link", se = F, re.form=NA)
x <- model.matrix(~ subTreatment * regime_order + Referendum, data = ndata)
ndata$se <- sqrt(diag(x %*% vcov(poissonre12) %*% t(x)))
n <- 32
K <- 3
ndata$ll <- exp((ndata$predlink + qt(.025, df = n - K) * ndata$se))
ndata$ul <- exp((ndata$predlink + qt(.975, df = n - K) * ndata$se))

sdata <- subset(ndata, Referendum == "Referendum 1", select = c("regime_order", "subTreatment", "pred", "ll", "ul"))
ssdata <- merge(sdata, data.frame(v = c(0:9)), all = T)
ssdata$pp <- dpois(x = ssdata$v, lambda = ssdata$pred) * 16
ssdata$pu <- dpois(x = ssdata$v, lambda = ssdata$ul) * 16
ssdata$pl <- dpois(x = ssdata$v, lambda = ssdata$ll) * 16
pu <- ssdata$pu
pl <- ssdata$pl
ul <- ssdata$ul
ll <- ssdata$ll
ssdata$pu[pu < pl] <- pl[pu < pl]
ssdata$ul[ul < ll] <- ssdata$ll[ul < ll]
ssdata$pl[pu < pl] <- pu[pu < pl]
ssdata$ll[ul < ll] <- ul[ul < ll]
# when the limits of the CI surround v, then the maximum is found at v  
ssdata$pu[ssdata$ul > ssdata$v & ssdata$ll < ssdata$v] <- dpois(x = ssdata$v[ssdata$ul > ssdata$v & ssdata$ll < ssdata$v], lambda = ssdata$v[ssdata$ul > ssdata$v & ssdata$ll < ssdata$v]) * 16
ssdata$Votes <- factor(ssdata$v, levels = 0:9, labels = c("0/9", "1/8", "2/7", "3/6", "4/5", "5/4", "6/3", "7/2", "8/1", "9/0"))
ssdata$majority <- factor(ssdata$Votes, levels = c("0/9", "1/8", "2/7", "3/6", "4/5", "5/4", "6/3", "7/2", "8/1", "9/0"), labels = c(1,1,1,1,1,0,0,0,0,0)) 
colnames(ssdata) <- c("order", "subTreatment", "pred", "ll", "ul", "v", "pp", "pu", "pl", "Votes", "majority")
ssdata$var <- "Prescriptive"
ncV <- subset(cV, select = c("order", "subTreatment", "Votes", "n", "VotesUni", "majority"), order != "Total" & subTreatment != "Total" & traderType == "all")
ncV <- merge(ncV, subset(ssdata, select = c("order", "subTreatment", "Votes")), by = c("order", "subTreatment", "Votes"), all = T)
ncV$n[is.na(ncV$n)] <- 0
ncV$VotesUni[is.na(ncV$VotesUni)] <- 0
ncV$var <- "Descriptive"
ncV$pl <- NA
ncV$pu <- NA
ncV$pp <- ncV$n
nndata <- rbind(subset(ncV, select = c("order", "subTreatment", "Votes", "majority", "pp", "pu", "pl", "var")), subset(ssdata, select = c("order", "subTreatment", "Votes", "majority", "pp", "pu", "pl", "var")))

ncVtext <- data.frame("order" = rep(c("NR", "RN"), each = 4), "subTreatment" = rep(c("FIXED", "FLUCT"), each = 2), "text" = c("NOREG", "REG"), "Votes" = c("2/7", "7/2"), "pp" = c(7, 7))
ncVtext$var <- "Descriptive"
nndata$subTreatment <- factor(nndata$subTreatment, levels = c("FLUCT", "FIXED"))
```

```{r graphicFig2, echo=F ,fig.cap="[Figure 2:] Distribution of votes by treatment and starting regime."}
#postscript("Figures/xx_Figure2_voteDist.eps")
ggplot(data=subset(nndata), aes(y=pp , x= Votes, group=var, fill = var)) +
  geom_bar(stat="identity", position = position_dodge(width = 0.7, preserve = "single")#, size = 2 # used in paper but not in Rmarkdown output
           ) +
  labs(x="Number of votes (in favor of /against regulation)", y="Number of referenda") +
  geom_errorbar(aes(ymin=pl, ymax=pu, group=var, color = order), position = position_dodge(width = 0.7, preserve = "single"), width=.2) +
  geom_label(data = ncVtext, mapping = aes(x = Votes, y = pp-.5, label = text), col = "black", hjust = .5, fill = "transparent"#, size = 6 # used in paper but not in Rmarkdown output
             ) +
  geom_vline(xintercept = 5.5, color = "black") +
  theme(#text = element_text(size=18), legend.text = element_text(size = 18), # used in paper but not in Rmarkdown output
        legend.title = element_blank(), legend.position = "bottom", legend.direction = "horizontal", panel.grid.major.y = element_line(colour = "lightgrey"), panel.background = element_rect(fill = "transparent"), plot.background = element_rect(fill = "transparent"), strip.background.y = element_rect(fill = "transparent"), #strip.text = element_text(size=18), # used in paper but not in Rmarkdown output
        strip.placement = "outside", strip.clip = "off", axis.ticks.x = element_blank()) +
  facet_grid(order ~ factor(subTreatment, levels = c("FLUCT", "FIXED")),scales = "fixed") +
    scale_y_continuous(limits = c(0, 8), breaks = seq(0, 8, by = 1)) +
  scale_fill_manual(values = c("Descriptive" = rgb(1,.84,.0), "Prescriptive" = rgb(1,.4,.1), "Total" = "black"), name = "barFill", guide = "legend", labels = c("Observed frequencies","Predicted frequencies")) + 
  scale_color_manual("order", values=c("black", "black"), name = "errorBars", guide = "none", labels = c("")) +
  scale_size_manual(values = 5)
#dev.off()
```

*******************************************************************************
\newpage

## Voting behavior

Test REG votes in Referenda 1 & 2 against Referendum 3 for informed traders in treatment FIXED reported in the Online Appendix in Section  2.3
```{r testvotesInformed, echo=F}
prop.test(x = c(sum(subset(Votes, Referendum != "Referendum 3" & ExpectedRole == "Informed trader")$vote == "REG"), sum(subset(Votes, Referendum == "Referendum 3" & ExpectedRole == "Informed trader")$vote == "REG")), n = c(96,48), alternative = "two.sided")
```

Test REG voters in Referenda 1 & 2 against Referendum 3 for informed traders in treatment FIXED reported in the Online Appendix in Section  2.3
```{r testvotersInformed, echo=F}
prop.test(x = c(sum(subset(Votes, Referendum == "Referendum 1" & ExpectedRole == "Informed trader")$votes2Referenda == "REG|NOREG", subset(Votes, Referendum == "Referendum 1" & ExpectedRole == "Informed trader")$votes2Referenda == "NOREG|REG"), sum(subset(Votes, Referendum == "Referendum 3" & ExpectedRole == "Informed trader")$vote == "REG")), n = c(48,48), alternative = "two.sided")
```

Test REG votes in Referenda 1 & 2 against Referendum 3 for uninformed traders in treatment FIXED reported in the Online Appendix in Section  2.3
```{r testVotesUninformed, echo = F}
prop.test(x = c(sum(subset(Votes, Referendum != "Referendum 3" & ExpectedRole == "Uninformed trader")$vote == "REG"), sum(subset(Votes, Referendum == "Referendum 3" & ExpectedRole == "Uninformed trader")$vote == "REG")), n = c(192,96), alternative = "two.sided")
```

Test REG voters in Referenda 1 & 2 against Referendum 3 for uninformed traders in treatment FIXED reported in the Online Appendix in Section  2.3
```{r testVotersUninformedREG, echo=F}
prop.test(x = c(sum(subset(Votes, Referendum == "Referendum 1" & ExpectedRole == "Uninformed trader")$votes2Referenda != "NOREG|NOREG"), sum(subset(Votes, Referendum == "Referendum 3" & ExpectedRole == "Uninformed trader")$vote == "REG")), n = c(96,96), alternative = "two.sided")
```

Test NOREG voters in Referenda 1 & 2 against Referendum 3 for uninformed traders in treatment FIXED reported in the Online Appendix in Section  2.3
```{r testVotersUninformedNOREG, echo=F}
prop.test(x = c(sum(subset(Votes, Referendum == "Referendum 1" & ExpectedRole == "Uninformed trader")$votes2Referenda != "REG|REG"), sum(subset(Votes, Referendum == "Referendum 3" & ExpectedRole == "Uninformed trader")$vote == "NOREG")), n = c(96,96), alternative = "two.sided")
```

Test REG votes between Referenda 1 & 2 for treatment FLUCT reported in the Online Appendix in Section  2.3
```{r testvotesReferenda12FLICT, echo=F}
prop.test(x = c(sum(subset(Votes, Referendum == "Referendum 1" & ExpectedRole == "FLUCT")$vote == "REG"), sum(subset(Votes, Referendum == "Referendum 2" & ExpectedRole == "FLUCT")$vote == "REG")), n = c(144,144), alternative = "two.sided")
```

Test REG votes in Referenda 1 & 2 against Referendum 3 for treatment FLUCT reported in the Online Appendix in Section  2.3
```{r testVotesFLUCT, echo = F}
prop.test(x = c(sum(subset(Votes, Referendum != "Referendum 3" & ExpectedRole == "FLUCT")$vote == "REG"), sum(subset(Votes, Referendum == "Referendum 3" & ExpectedRole == "FLUCT")$vote == "REG")), n = c(288,144), alternative = "two.sided")
```

Test REG voters in Referenda 1 & 2 against Referendum 3 for treatment FLUCT reported in the Online Appendix in Section  2.3
```{r testvoterFLUCTREG, echo = F}
prop.test(x = c(sum(subset(Votes, Referendum == "Referendum 1" & ExpectedRole == "FLUCT")$votes2Referenda != "NOREG|NOREG"), sum(subset(Votes, Referendum == "Referendum 3" & ExpectedRole == "FLUCT")$vote == "REG")), n = c(144,144), alternative = "two.sided")
```

Test NOREG voters in Referenda 1 & 2 against Referendum 3 for treatment FLUCT reported in the Online Appendix in Section  2.3
```{r testvoterFLUCTNOREG, echo = F}
prop.test(x = c(sum(subset(Votes, Referendum == "Referendum 1" & ExpectedRole == "FLUCT")$votes2Referenda != "REG|REG"), sum(subset(Votes, Referendum == "Referendum 3" & ExpectedRole == "FLUCT")$vote == "NOREG")), n = c(144,144), alternative = "two.sided")
```


```{r vote, echo = F}
{
  v <- aggregate(vote == "REG" ~ ExpectedRole + subTreatment, data = subset(Votes, Referendum != "Referendum 3"), FUN = function(x) mean(x, na.rm = T), na.action = na.pass)
colnames(v) <- c("ExpectedRole", "subTreatment", "vote")
vn <- aggregate(vote == "REG" ~ ExpectedRole + subTreatment, data = subset(Votes, Referendum != "Referendum 3"), FUN = function(x) length(x))
colnames(vn) <- c("ExpectedRole", "subTreatment", "n")
vsd <- aggregate(vote == "REG" ~ ExpectedRole + subTreatment, data = subset(Votes, Referendum != "Referendum 3"), FUN = function(x) sd(x, na.rm = T), na.action = na.pass)
colnames(vsd) <- c("ExpectedRole", "subTreatment", "sdVote")
v <- merge(v, vsd, by=c("ExpectedRole", "subTreatment"))
v <- merge(v, vn, by=c("ExpectedRole", "subTreatment"))
v$ExpectedRole <- factor(v$ExpectedRole, levels = c("FLUCT", "Informed trader","Uninformed trader"), labels = c("All traders","Informed\ntraders","Uninformed\ntraders"))
v2 <- aggregate(vote == "REG" ~ subTreatment, data = subset(Votes, Referendum != "Referendum 3"), FUN = function(x) mean(x, na.rm = T), na.action = na.pass)
colnames(v2) <- c("subTreatment", "vote")
v2n <- aggregate(vote == "REG" ~ subTreatment, data = subset(Votes, Referendum != "Referendum 3"), FUN = function(x) length(x))
colnames(v2n) <- c("subTreatment", "n")
v2sd <- aggregate(vote == "REG" ~ subTreatment, data = subset(Votes, Referendum != "Referendum 3"), FUN = function(x) sd(x, na.rm = T), na.action = na.pass)
colnames(v2sd) <- c("subTreatment", "sdVote")
v2 <- merge(v2, v2sd, by=c("subTreatment"))
v2 <- merge(v2, v2n, by=c("subTreatment"))
v2$ExpectedRole <- "All traders"
v2 <- subset(v2, subTreatment=="FIXED")
v <- rbind(v, v2)
v$subTreatment <- factor(v$subTreatment, levels = c("FIXED","FLUCT"), labels = c("FIXED","FLUCT"))
v$ll <- v$vote - qt(.025,v$n)*v$sdVote/sqrt(v$n)
v$ul <- v$vote + qt(.025,v$n)*v$sdVote/sqrt(v$n)
v$binconf <- binconf(v$vote*v$n, v$n, alpha = 0.05, method = "wilson")
}
```


```{r logitvote, echo = F, results='hide', include=F}
formula <- vote ~ ExpectedRole * (AvgPDbefore1 + regime_order + Referendum)

## logit model all referenda (Table OA2)
binomre <- glmer(update(formula, ~. + (1 | Group)), family = binomial(link = logit),  data = subset(Votes))

binomreAME1 <- mean((predict(binomre, type = "response")))
binomreAME <- binomreAME1 * (1 - binomreAME1) * coef(binomre)$Group[18,]
int_pred_binomre <- 1/(1+exp(-(mean((coef(binomre)$Group)[,"(Intercept)"]))))

## logit model Referenda 1 & 2 (Table 2)
binomre12 <- glmer(update(formula, ~. + (1 | Group)), family = binomial(link = logit),  data = subset(Votes, Referendum != "Referendum 3"))

binomre12AME1 <- mean((predict(binomre12, type = "response")))
binomre12AME <- binomre12AME1 * (1 - binomre12AME1) * coef(binomre12)$Group[18,]
int_pred_binomre12 <- 1/(1+exp(-(mean((coef(binomre12)$Group)[,"(Intercept)"]))))

## logit model Referendum 3 (Table OA2)
binom3 <- glm(vote ~ ExpectedRole * (AvgPDbefore1 + regime_order), family = binomial(link = logit),  data = subset(Votes, Referendum == "Referendum 3"))

se_binom3 <- coeftest(binom3, vcov. = sandwich)

binom3AME1 <- mean((predict(binom3, type = "response")))
binom3AME <- binom3AME1 * (1 - binom3AME1) * coef(binom3)
int_pred_binom3 <- 1/(1+exp(-(coef(binom3)["(Intercept)"])))

binomreEET <- glmer(update(formula, ~. + ExpectedRole * (xScoreAll * yScoreAll + EETMono) + (1 | Group)), family = binomial(link = logit),  data = subset(Votes))

## logit model Referenda 1 & 2 incl. EET (Table 2)
binomreEET12 <- glmer(update(formula, ~. + ExpectedRole * (xScoreAll * yScoreAll + EETMono) + (1 | Group)), family = binomial(link = logit),  data = subset(Votes, Referendum != 'Referendum 3'))

binomreEET12AME1 <- mean((predict(binomreEET12, type = "response")))
binomreEET12AME <- binomreEET12AME1 * (1 - binomreEET12AME1) * coef(binomreEET12)$Group[18,]
int_pred_binomreEET12 <- 1/(1+exp(-(mean((coef(binomreEET12)$Group)[,"(Intercept)"]))))

binomEET3 <- glm(vote ~ ExpectedRole * (AvgPDbefore1 + regime_order + xScoreAll * yScoreAll + EETMono), family = binomial(link = logit),  data = subset(Votes, Referendum == "Referendum 3"))
Votes$male <- factor(Votes$gender == "male", levels = c(T,F), labels = c("male", "not male"))

binomre12PRMono <- glmer(update(formula, ~. + (1 | Group)), family = binomial(link = logit),  data = subset(Votes, Referendum != "Referendum 3" & AvgPR1 > .5 & EETMono == 'Monotonic'))

binomre12PRMonoAME1 <- mean((predict(binomre12PRMono, type = "response")))
binomre12PRMonoAME <- binomre12PRMonoAME1 * (1 - binomre12PRMonoAME1) * coef(binomre12PRMono)$Group[18,]
int_pred_binomre12PRMono <- 1/(1+exp(-(mean((coef(binomre12PRMono)$Group)[,"(Intercept)"]))))

## logit model Referenda 1 & 2 excl non-monotonic and non-participati g (Table 2)
binomreEET12PRMono <- glmer(update(formula, ~. + ExpectedRole * (xScoreAll * yScoreAll) + (1 | Group)), family = binomial(link = logit),  data = subset(Votes, Referendum != "Referendum 3" & AvgPR1 > .5 & EETMono == 'Monotonic'))

binomreEET12PRMonoAME1 <- mean((predict(binomreEET12PRMono, type = "response")))
binomreEET12PRMonoAME <- binomreEET12PRMonoAME1 * (1 - binomreEET12PRMonoAME1) * coef(binomreEET12PRMono)$Group[18,]
int_pred_binomreEET12PRMono <- 1/(1+exp(-(mean((coef(binomreEET12PRMono)$Group)[,"(Intercept)"]))))

## logit model Referendum 2 (Table OA2)
binomLag2 <- glm(vote ~ ExpectedRole * (AvgPDbefore1 + regime_order + Referendum1), family = binomial(link = logit),  data = subset(Votes, Referendum == "Referendum 2"))

se_binom2 <- coeftest(binomLag2, vcov. = sandwich)

binomLag2AME1 <- mean((predict(binomLag2, type = "response")))
binomLag2AME <- binomLag2AME1 * (1 - binomLag2AME1) * coef(binomLag2)
int_pred_binomLag2 <- 1/(1+exp(-(coef(binomLag2)["(Intercept)"])))
```

```{r Table2wAME, echo=F, results='hide'}
texreg(list(binomre12, binomre12, binomreEET12, binomreEET12, binomreEET12PRMono, binomreEET12PRMono),
       caption = "[Table 2:] Mixed effects regressions of voting behavior on regulation.",
       label = "Table2",
       custom.model.names = c("(1) indiv. vote", " ", "(2) incl. EET", " ", "(3) cons. and act.", " "),
       custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"),  
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,
       override.coef = list(NA, as.numeric(binomre12AME), NA, as.numeric(binomreEET12AME), NA, as.numeric(binomreEET12PRMonoAME)),
       override.se = list(NA, tempty(12), NA, tempty(24), NA, tempty(21)),
       override.pvalues = list(NA, tempty(12), NA, tempty(24), NA, tempty(21)),
       custom.gof.rows = list(
         "mu(Intercept)" = c(int_pred_binomre12, int_pred_binomre12,int_pred_binomreEET12, int_pred_binomreEET12,int_pred_binomreEET12PRMono, int_pred_binomreEET12PRMono),
         "Avg. predicted probability" = c(binomre12AME1, binomre12AME1, binomreEET12AME1, binomreEET12AME1, binomreEET12PRMonoAME1, binomreEET12PRMonoAME1),
         "McFadden R^2" = c(
           1 - as.vector(logLik(binomre12) / logLik(update(binomre12, . ~ (1|Group)))),
           1 - as.vector(logLik(binomre12) / logLik(update(binomre12, . ~ (1|Group)))),
           1 - as.vector(logLik(binomreEET12) / logLik(update(binomreEET12, . ~ (1|Group)))),
           1 - as.vector(logLik(binomreEET12) / logLik(update(binomreEET12, . ~ (1|Group)))),
           1 - as.vector(logLik(binomreEET12PRMono) / logLik(update(binomreEET12PRMono, . ~ (1|Group)))),
           1 - as.vector(logLik(binomreEET12PRMono) / logLik(update(binomreEET12PRMono, . ~ (1|Group))))
           )
       )
)
```

```{r Table2, echo=F, results='asis'}
texreg(list(binomre12, binomreEET12, binomreEET12PRMono),
       caption = "[Table 2:] Mixed effects regressions of voting behavior on regulation.",
       label = "Table2",
       custom.model.names = c("(1) indiv. vote", "(2) incl. EET", "(3) cons. and act."),
       custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"),  
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,
       custom.gof.rows = list(
         "mu(Intercept)" = c(int_pred_binomre12, int_pred_binomreEET12, int_pred_binomreEET12PRMono),
         "Avg. predicted probability" = c(binomre12AME1, binomreEET12AME1, binomreEET12PRMonoAME1),
         "McFadden R^2" = c(
           1 - as.vector(logLik(binomre12) / logLik(update(binomre12, . ~ (1|Group)))),
           1 - as.vector(logLik(binomreEET12) / logLik(update(binomreEET12, . ~ (1|Group)))),
           1 - as.vector(logLik(binomreEET12PRMono) / logLik(update(binomreEET12PRMono, . ~ (1|Group))))
           )
       )
)
```

Test trader type differences in Referenda 1 & 2 based on Model 2 of Table 2 reported in Result 3 in Section 3.2
```{r testTraderType, echo=F}
linearHypothesis(binomre12, c('ExpectedRoleUninformed trader = ExpectedRoleInformed trader'))
```

Test against a 50-50 choice for traders in treatment FLUCT in Referenda 1 & 2 based on Model 2 of Table 2 reported in Result 3 in Section 3.2
```{r test50FLUCT, echo=F}
## different from .5 for traders in FLUCT
linearHypothesis(binomre12, c('(Intercept) = 0'), singular.ok = T)
```

Test against a 50-50 choice for informed traders in treatment FIXED in Referenda 1 & 2 based on Model 2 of Table 2 reported in Result 3 in Section 3.2
```{r test50Informed, echo=F}
## different from .5 for uninformed traders
linearHypothesis(binomre12, c('(Intercept) + ExpectedRoleInformed trader = 0'), singular.ok = T)
```

Test against a 50-50 choice for uninformed traders in treatment FIXED in Referenda 1 & 2 based on Model 2 of Table 2 reported in Result 3 in Section 3.2
```{r test50Uninformed, echo=F}
## different from .5 for uninformed traders
linearHypothesis(binomre12, c('(Intercept) + ExpectedRoleUninformed trader = 0'), singular.ok = T)
```

Test the influence of uninformed traders' ability to generate profits in treatment FIXED in Referenda 1 & 2 based on Model 2 of Table 2 reported in Result 3 in Section 3.2
```{r testPDUninformed, echo=F}
## effect from profitability for uninformed traders
linearHypothesis(binomre12, c('AvgPDbefore1 + ExpectedRoleUninformed trader:AvgPDbefore1 = 0'), singular.ok = T)
```

Test the influence of EET scores in Referenda 1 & 2 based on Model 2 of Table 2 reported in Result 3 in Section 3.2
```{r testEET, echo=F}
## effect from x,y-scores
linearHypothesis(binomreEET12, c('xScoreAll = 0', 'yScoreAll = 0', 'xScoreAll:yScoreAll = 0', 'ExpectedRoleInformed trader:xScoreAll = 0', 'ExpectedRoleInformed trader:yScoreAll = 0', 'ExpectedRoleInformed trader:xScoreAll:yScoreAll = 0', 'ExpectedRoleUninformed trader:xScoreAll = 0', 'ExpectedRoleUninformed trader:yScoreAll = 0', 'ExpectedRoleUninformed trader:xScoreAll:yScoreAll = 0'), singular.ok = T)
```

```{r TableOA2wAME, echo=F, results='hide'}
texreg(list(binomre, binomre, binomLag2, binomLag2, binom3, binom3),
       caption = "[Table OA2:] Logit regression of voting behavior on regulation.",
       label = "TableOA2",
       custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"),  
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,
       override.coef = list(NA, as.numeric(binomreAME), NA, as.numeric(binomLag2AME), NA, as.numeric(binom3AME)),
       override.se = list(NA, tempty(15), se_binom2[,2], tempty(12), se_binom3[,2], tempty(9)),
       override.pvalues = list(NA, tempty(15), se_binom2[,4], tempty(12), se_binom3[,4], tempty(9)),
       custom.gof.rows = list(
         "mu(Intercept)" = c(int_pred_binomre, int_pred_binomre,int_pred_binomLag2, int_pred_binomLag2,int_pred_binom3, int_pred_binom3),
         "Avg. predicted probability" = c(binomreAME1, binomreAME1, binomLag2AME1, binomLag2AME1, binom3AME1, binom3AME1),
         "McFadden R^2" = c(
           1 - as.vector(logLik(binomre) / logLik(update(binomre, . ~ (1|Group)))),
           1 - as.vector(logLik(binomre) / logLik(update(binomre, . ~ (1|Group)))),
           1 - as.vector(logLik(binomLag2) / logLik(update(binomLag2, . ~ (1|Group)))),
           1 - as.vector(logLik(binomLag2) / logLik(update(binomLag2, . ~ (1|Group)))),
           1 - as.vector(logLik(binom3) / logLik(update(binom3, . ~ (1|Group)))),
           1 - as.vector(logLik(binom3) / logLik(update(binom3, . ~ (1|Group))))
           )
       )
)
```

```{r TableOA2, echo=F, results='asis'}
texreg(list(binomre, binomLag2, binom3),
       caption = "[Table OA2:] Logit regression of voting behavior on regulation.",
       label = "TableOA2",
       custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"),
       custom.model.names = c("(1) all ref.", "(2) Ref. 2", "(3) Ref. 3"),
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,
       custom.gof.rows = list(
         "mu(Intercept)" = c(int_pred_binomre, int_pred_binomLag2, int_pred_binom3),
         "Avg. predicted probability" = c(binomreAME1, binomLag2AME1, binom3AME1),
         "McFadden R^2" = c(
           1 - as.vector(logLik(binomre) / logLik(update(binomre, . ~ (1|Group)))),
           1 - as.vector(logLik(binomLag2) / logLik(update(binomLag2, . ~ (1|Group)))),
           1 - as.vector(logLik(binom3) / logLik(update(binom3, . ~ (1|Group))))
           )
       )
)
```

```{r predGraphicRE, echo=F, include=F}
ndata <- data.frame(regime_order = rep(c("NR", "RN"), each = 6), ExpectedRole = rep(c("Informed trader", "Uninformed trader", "FLUCT"), each = 2), Referendum = c("Referendum 1", "Referendum 2"), Group = 18, AvgPDbefore1 = 0)

#predict response
ndata$pred <- predict(binomre12, newdata=ndata, type = "response", se = F, re.form=NA)
ndata$predlink <- predict(binomre12, newdata=ndata, type = "link", se = F, re.form=NA)
x <- model.matrix(~ ExpectedRole * (AvgPDbefore1 + regime_order + Referendum), data = ndata)
x <- as.matrix(subset(as.data.frame(x), regime_orderRN == 0 & `ReferendumReferendum 2` == 0))
ndata <- subset(ndata, regime_order == "NR" & Referendum == "Referendum 1")
ndata$se <- sqrt(diag(x %*% vcov(binomre12) %*% t(as.matrix(x))))
ndata$ll <- 1/(1+exp(-(ndata$predlink + qt(.025, df = df.residual(binomre12)) * ndata$se)))
ndata$ul <- 1/(1+exp(-(ndata$predlink + qt(.975, df = df.residual(binomre12)) * ndata$se)))

ndata$ExpectedRole <- factor(ndata$ExpectedRole, levels = c("FLUCT", "Informed trader", "Uninformed trader")) 

sdata <- subset(ndata, Referendum == "Referendum 1" & regime_order == 'NR' & AvgPDbefore1 == 0, select = c('ExpectedRole', "pred", "ll", "ul"))
nndata <- subset(v, select = c('ExpectedRole', "subTreatment", "vote"))
nndata$ll <- v$binconf[,2]
nndata$ul <- v$binconf[,3]
nndata$var <- "Descriptive"
colnames(sdata) <- c("ExpectedRole", "vote", "ll", "ul")
sdata$ExpectedRole <- factor(sdata$ExpectedRole, levels = c('FLUCT', 'Informed trader', 'Uninformed trader'), labels = c('FLUCT', 'Informed\ntraders', 'Uninformed\ntraders'))
sdata$subTreatment <- factor(sdata$ExpectedRole, levels = c('FLUCT', 'Informed\ntraders', 'Uninformed\ntraders'), labels = c('FLUCT', 'FIXED', 'FIXED'))
sdata$var <- "Prescriptive"
nndata <- rbind(nndata, sdata)
nndata$var[nndata$ExpectedRole == "All traders"] <- 'All traders'
nndata$ExpectedRole[nndata$ExpectedRole == "FLUCT"] <- 'All traders'
```

```{r graphicFigureOA2, echo=F, fig.cap="[Figure OA2:] Share of traders voting in favor of regulation by treatment and trader type."}
#postscript("Figures/xxx_FigureOA2_votes")
ggplot(data=subset(nndata), aes(y=vote , x= ExpectedRole, group=var, fill = var)) +
    geom_bar(stat="identity", position = position_dodge(width = 0.7)#, size = 2 # used in paper but not in Rmarkdown output
             ) +
    labs(y="Share of traders voting in favor of regulation") +
    geom_errorbar(aes(ymin=ll, ymax=ul, color=factor(ExpectedRole)), position = position_dodge(width = 0.7), width=.2) +
    theme(#text = element_text(size=18), legend.text = element_text(size = 18), # used in paper but not in Rmarkdown output
          axis.title.x=element_blank(), legend.title = element_blank(), legend.position = "bottom", legend.direction = "horizontal", legend.spacing.x = unit(0, "cm"), panel.grid.major.y = element_line(colour = "lightgrey"), panel.background = element_rect(fill = "transparent"),  plot.background = element_rect(fill = "transparent"), strip.background.y = element_rect(fill = "transparent"), #strip.text = element_text(size=18), # used in paper but not in Rmarkdown output
          strip.placement = "outside", strip.clip = "off", axis.text.x = element_text(margin = margin(t = -10)), axis.ticks.x = element_blank()) +
    facet_wrap(. ~ factor(subTreatment, levels = c('FLUCT', 'FIXED')), scales = "free_x") +
    scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, by = .1)) +
    scale_fill_manual(values = c("All traders" = "black", "Descriptive" = rgb(1,.84,.0), "Prescriptive" = rgb(1,.4,.1)), name = "barFill", guide = "legend", labels = c("","Observed probabilities    ", "Predicted probabilites")) + 
    scale_color_manual("var", values=c("dimgrey", "black", "black", 'black'), name = "color", guide = "none", labels = c("", "", "", "")) +
    scale_size_manual(values = 5)
#dev.off()
```


```{r lossDomain, echo = F}
Votes$gains1 <- 0
Votes$losses1 <- 0
for (x in list(Votes$PDbefore.1, Votes$PDbefore.2, Votes$PDbefore.3)){
  gains12 <- losses12 <- x
  gains12[gains12 < 0] <- 0
  losses12[losses12 > 0] <- 0
  Votes$gains1 <- Votes$gains1 + gains12
  Votes$losses1 <- Votes$losses1 + losses12
}
Votes$gains2 <- 0
Votes$losses2 <- 0
for (x in list(Votes$PDbefore.4, Votes$PDbefore.5, Votes$PDbefore.6)){
  gains12 <- losses12 <- x
  gains12[gains12 < 0] <- 0
  losses12[losses12 > 0] <- 0
  Votes$gains2 <- Votes$gains2 + gains12
  Votes$losses2 <- Votes$losses2 + losses12
}
Votes$AvgPDgains1 <- (Votes$gains1 + Votes$gains2) / 6
Votes$AvgPDlosses1 <- (Votes$losses1 + Votes$losses2) / 6

binomre12losses <- glmer(vote ~ ExpectedRole * (abs(AvgPDgains1) + abs(AvgPDlosses1) + regime_order + Referendum) + (1 | Group), family = binomial(link = logit),  data = subset(Votes, Referendum != "Referendum 3"))

binomre12lossesAME1 <- mean((predict(binomre12losses, type = "response")))

int_pred_binomre12losses <- 1/(1+exp(-(coef(binomre12losses)$Group[18,"(Intercept)"])))

```

*******************************************************************************
\newpage

## Voter Migration

```{r migrationTable, echo=F}
table(subset(Votes, Referendum == "Referendum 1")$votesallReferenda, subset(Votes, Referendum == "Referendum 1")$ExpectedRole)
```

```{r sankeygraph, echo = F}
votessankey <- aggregate(cbind(as.numeric(vote == "REG"), 1) ~ vote + vote1 + vote2 + vote3 + Referendum + votesallReferenda + ExpectedRole, data = Votes, FUN = sum)
votessankey$ExpectedRole <- factor(votessankey$ExpectedRole, levels = c("FLUCT", "Informed trader", "Uninformed trader"), label = c("FLUCT", "FIXED\nInformed trader", "FIXED\nUninformed trader"))
votessankey$votesallReferenda <- (factor(votessankey$votesallReferenda, levels = c("NOREG.NOREG.NOREG", "NOREG.NOREG.REG", "NOREG.REG.NOREG", "NOREG.REG.REG", "REG.NOREG.NOREG", "REG.NOREG.REG", "REG.REG.NOREG", "REG.REG.REG"), labels = c("NOREG | NOREG | NOREG", "NOREG | NOREG | REG", "NOREG | REG | NOREG", "NOREG | REG | REG", "REG | NOREG | NOREG", "REG | NOREG | REG", "REG | REG | NOREG", "REG | REG | REG")))
```

```{r graphicHikes, echo=F, fig.cap="[Figure OA3:] Voter migration between referenda by treatment and trader type."}
#postscript("Figures/xxx_FigureOA3_voteMigration.eps")
ggplot(subset(votessankey, Referendum == "Referendum 2"), aes(y = V2, axis1 = vote1, axis2 = vote2, axis3 = vote3), alpha = 1)  +
    geom_alluvium(aes(fill = votesallReferenda), alpha = 1, lode.guidance = "backfront", color = "grey", size = .1) +
    scale_x_discrete(limits = c("Referendum 1", "Referendum 2","Referendum 3"), expand = c(0,0)) +
    geom_stratum(color = "grey", fill = "grey95", size = 1) +
      scale_fill_manual(values = c(rgb(.46, .76, .88), "#4E9AC1" , rgb(1,.84,0), rgb(.96,.61,0), rgb(.68,1,.18), rgb(.13,.55,.13), "#1D689A", rgb(0,.29,.51)), guide = guide_legend(reverse = F)) +
    scale_color_manual(values = c("NOREG" = rgb(.46, .76, .88), "REG" = rgb(0,.29,.51))) +
    geom_text(stat = "stratum", mapping = aes(label = after_stat(stratum))) + 
    scale_y_continuous(expand = c(0.05,0), breaks = c(0,48,96,144)) +
   theme(#text = element_text(size=18), # used in paper but not in Rmarkdown output
         axis.text.x=element_text(margin = margin(t = 0, unit='pt')), 
         axis.title = element_blank(),axis.ticks = element_blank(), axis.line = element_blank(),
          plot.margin = margin(2, 1,1,1),
          panel.background = element_rect(fill = "transparent"),  plot.background = element_rect(fill = "transparent"),
          panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          legend.title = element_blank(), legend.position = "bottom", legend.direction = "horizontal",) +
    coord_cartesian(clip = 'off') +
    facet_grid(ExpectedRole ~ ., scales = "free")
#dev.off()
```

```{r multinom, echo = F}
library("nnet")
formulaM <- votes2Referenda ~ ExpectedRole * (AvgPDbefore1 + regime_order + xScoreAll * yScoreAll + EETMono) # + (1 | Group)
multinomTypes <- nnet::multinom(formulaM, data = subset(Votes, Referendum=="Referendum 1"), trace = F)
```

```{r TableMultinom, echo=F, results='asis'}
texreg(list(multinomTypes), 
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,
       caption = "[Table OA4:] Multinomial logit regressions of voting migration by treatment and trader type.",
       label = "TableOA4",
             custom.gof.rows = list("McFadden R^2" = c(1 - as.vector(logLik(multinomTypes) / logLik(update(multinomTypes, . ~ 1))))
             ))

colMeans(predict(multinomTypes, newdata = subset(Votes, Referendum == "Referendum 1"), type = "probs"))
```

```{r predGraphicMultinom, echo=F, include=F}
#linearHypothesis(multinomTypes, c('REG|REG:xScoreAll:yScoreAll + REG|REG:ExpectedRoleUninformed trader:xScoreAll:yScoreAll = 0'))

#linearHypothesis(multinomTypes, c('REG|REG: EETMonoNon-monotonic + REG|REG: ExpectedRoleUninformed trader:EETMonoNon-monotonic = 0'))

cPD <- -.2
exp(coef(multinomTypes)[3,1] + coef(multinomTypes)[3,"ExpectedRoleUninformed trader"] + cPD*coef(multinomTypes)[3,"AvgPDbefore1"] + cPD*coef(multinomTypes)[3,"ExpectedRoleUninformed trader:AvgPDbefore1"])/
  (1 + 
     exp(coef(multinomTypes)[1,1] + coef(multinomTypes)[1,"ExpectedRoleUninformed trader"] + cPD*coef(multinomTypes)[1,"AvgPDbefore1"] + cPD*coef(multinomTypes)[1,"ExpectedRoleUninformed trader:AvgPDbefore1"]) +
     exp(coef(multinomTypes)[2,1] + coef(multinomTypes)[2,"ExpectedRoleUninformed trader"] + cPD*coef(multinomTypes)[2,"AvgPDbefore1"] +  cPD*coef(multinomTypes)[2,"ExpectedRoleUninformed trader:AvgPDbefore1"]) +
     exp(coef(multinomTypes)[3,1] + coef(multinomTypes)[3,"ExpectedRoleUninformed trader"] + cPD*coef(multinomTypes)[3,"AvgPDbefore1"] +  cPD*coef(multinomTypes)[3,"ExpectedRoleUninformed trader:AvgPDbefore1"])
   )

xScore <- -2.5
yScore <- 2.5
exp(coef(multinomTypes)[3,1] + coef(multinomTypes)[3,"ExpectedRoleUninformed trader"] + xScore*coef(multinomTypes)[3,"xScoreAll"] + yScore*coef(multinomTypes)[3,"yScoreAll"] + xScore*yScore*coef(multinomTypes)[3,"xScoreAll:yScoreAll"] + xScore*coef(multinomTypes)[3,"ExpectedRoleUninformed trader:xScoreAll"] + yScore*coef(multinomTypes)[3,"ExpectedRoleUninformed trader:yScoreAll"] + xScore*yScore*coef(multinomTypes)[3,"ExpectedRoleUninformed trader:xScoreAll:yScoreAll"])/
    (1 + 
         exp(coef(multinomTypes)[1,1] + coef(multinomTypes)[1,"ExpectedRoleUninformed trader"] + xScore*coef(multinomTypes)[1,"xScoreAll"] + yScore*coef(multinomTypes)[1,"yScoreAll"] + xScore*yScore*coef(multinomTypes)[1,"xScoreAll:yScoreAll"] + xScore*coef(multinomTypes)[1,"ExpectedRoleUninformed trader:xScoreAll"] + yScore*coef(multinomTypes)[1,"ExpectedRoleUninformed trader:yScoreAll"] + xScore*yScore*coef(multinomTypes)[1,"ExpectedRoleUninformed trader:xScoreAll:yScoreAll"]) +
         exp(coef(multinomTypes)[2,1] + coef(multinomTypes)[2,"ExpectedRoleUninformed trader"] + xScore*coef(multinomTypes)[2,"xScoreAll"] + yScore*coef(multinomTypes)[2,"yScoreAll"] + xScore*yScore*coef(multinomTypes)[2,"xScoreAll:yScoreAll"] + xScore*coef(multinomTypes)[2,"ExpectedRoleUninformed trader:xScoreAll"] + yScore*coef(multinomTypes)[2,"ExpectedRoleUninformed trader:yScoreAll"] + xScore*yScore*coef(multinomTypes)[2,"ExpectedRoleUninformed trader:xScoreAll:yScoreAll"]) +
         exp(coef(multinomTypes)[3,1] + coef(multinomTypes)[3,"ExpectedRoleUninformed trader"] + xScore*coef(multinomTypes)[3,"xScoreAll"] + yScore*coef(multinomTypes)[3,"yScoreAll"] + xScore*yScore*coef(multinomTypes)[3,"xScoreAll:yScoreAll"] + xScore*coef(multinomTypes)[3,"ExpectedRoleUninformed trader:xScoreAll"] + yScore*coef(multinomTypes)[3,"ExpectedRoleUninformed trader:yScoreAll"] + xScore*yScore*coef(multinomTypes)[3,"ExpectedRoleUninformed trader:xScoreAll:yScoreAll"])
    )


ndata <- data.frame(AvgPDbefore1 = rep(c((-35:-11)*10,(-100:100),(11:35)*10)/1000, each = 6*6*3), xScoreAll = rep(c(0:5) - 2.5, each = 6*3), yScoreAll = rep(c(0:5) - 2.5, each = 3),  ExpectedRole = c('Informed trader', 'Uninformed trader', 'FLUCT'),
                      EETMono = "Monotonic", regime_order = "NR", Referendum = "Referendum 1")

pp.mbinPD <- cbind(ndata, predict(multinomTypes, newdata = ndata, type = "probs", se = TRUE))

lppmbin <- reshape::melt(subset(pp.mbinPD, select = c(ExpectedRole, AvgPDbefore1, xScoreAll, yScoreAll, `NOREG|NOREG`, `NOREG|REG`, `REG|NOREG`, `REG|REG`)), id.vars = c("ExpectedRole",  "AvgPDbefore1", "xScoreAll", "yScoreAll"))
lppmbin$ExpectedRole <- factor(lppmbin$ExpectedRole, levels = c("FLUCT", "Informed trader", "Uninformed trader"), labels = c("FLUCT", "Informed trader", "Uninformed trader"))
lppmbin$Treatment <- factor(lppmbin$ExpectedRole, levels = c("FLUCT", "Informed trader", "Uninformed trader"), labels = c("FLUCT", "FIXED", "FIXED"))
lppmbin$vote <- factor(lppmbin$variable)
```

```{r graphicMultinomPD, echo=F, fig.cap="[Figure OA4:] Out-of-sample probability prediction for multinomial logit regression by treatment and trader type."}
#postscript("Figures/xxx_FigureOA4_multinom.eps")
ggplot(subset(lppmbin, xScoreAll == .5 & yScoreAll == .5), aes(x = AvgPDbefore1*100, y = value*100, fill = vote)) + 
    geom_area(position = position_stack(reverse = T)) +
    geom_line(position = position_stack(reverse = T), color = "grey60") +
    scale_fill_manual( values = c("NOREG|NOREG" = rgb(.46, .76, .88) , "NOREG|REG" = rgb(1,.84,0), "REG|NOREG" = rgb(.68,1,.18),  "REG|REG" = rgb(0,.29,.51))) +
    labs(x=expression("PD"^{"Before"}), y="Predictions of traders voting migration behavior in %") +
    scale_x_continuous(breaks=c(-3:3)*10) +
    theme(#text = element_text(size=18), # used in paper but not in Rmarkdown output
          legend.title = element_blank(), legend.position = "bottom", legend.direction = "horizontal", panel.grid.major.y = element_line(colour = "lightgrey"), panel.background = element_rect(fill = "transparent"),  plot.background = element_rect(fill = "transparent")) +
    facet_grid(. ~ Treatment + ExpectedRole, scales = "fixed")#dev.off
#dev.off()
```

```{r graphicMultinomEET, echo=F, fig.cap="[Figure OA5:] Out-of-sample probability prediction for multinomial logit regression by treatment and trader type."}
#postscript("Figures/xxx_FigureOA5_multinomEET")
ggplot(subset(lppmbin, AvgPDbefore1 == 0 & vote == "NOREG|NOREG"), aes(x = xScoreAll, y = yScoreAll, z = value*100)) + 
  geom_raster(aes(fill = value*100), interpolate = T) +  
  geom_contour(color = "white") +
  scale_fill_gradient(name = "Predictions of  NOREG|NOREG  votes in %", high = rgb(.46, .76, .88), low = rgb(0,.29,.51)) +
  labs(y="y-score", x="x-score") + 
  scale_x_continuous(breaks = c(-3:2) + .5) +
  scale_y_continuous(breaks = c(-3:2) + .5) +
  theme(#text = element_text(size=18), legend.title = element_text(size=18), # used in paper but not in Rmarkdown output
        legend.position = "bottom", legend.direction = "horizontal", panel.grid.major.y = element_line(colour = "lightgrey"), panel.background = element_rect(fill = "transparent"),  plot.background = element_rect(fill = "transparent")) +
    facet_grid(. ~ Treatment + ExpectedRole, scales = "fixed")
#dev.off()
```   

*******************************************************************************
\newpage

## Participation rates and trading activity

```{r destable, echo=F, results='markup'}
table <- lapply( marketsummary[c("transactionVol", "VolumeInf", "VolumeUni", "LimitVol", "limitVolumeInf", "limitVolumeUni", "ProfitPotential", "unprofittime", "GD", "GAD", "RD", "RAD", "NumActiveTrader")] , function(x) rbind( mean = mean(x), 
                                         sd = sd(x) ,
                                         median = median(x) ,
                                         minimum = min(x) ,
                                         maximum = max(x) ,
                                         n = length(x) ) )
data.frame(table)
```

### Participation rates

Traders are active, if they either placed a limit order or accepted a market order.

```{r avgTreat, echo = F, results='hide', include=F}
avgtraderPhaseTreatsummary <- aggregate(cbind(Volume, LimitVolume, TradingProfit, TPUnits, TPUnitsPun, ProfitPeriod, (Volume > 0 | LimitVolume > 0), PDbefore, PDPun, PDRedist, PDbeforeVol, PDPunVol, PDRedistVol, PDbefore*as.numeric(PDbefore>0), PDPun*as.numeric(PDPun>0), PDRedist*as.numeric(PDRedist>0), PDbefore*as.numeric(PDbefore<0), PDPun*as.numeric(PDPun<0), PDRedist*as.numeric(PDRedist<0), shortsells, marginbuys, marginbuysAsset) ~ Role + Phase + IsREG + subTreatment + subTreatment, data=tradersummary, function(x) mean(x, na.rm = T), na.action = na.pass)
colnames(avgtraderPhaseTreatsummary)[colnames(avgtraderPhaseTreatsummary) == "V7"] <- "PR"
avgtraderPhaseTreatsummary2 <- reshape2::melt(subset(avgtraderPhaseTreatsummary), id.vars = c("Phase", "IsREG", "Role", "subTreatment"))
avgtraderPhaseTreatsummaryul <- aggregate(cbind(Volume, LimitVolume, TradingProfit, TPUnits, TPUnitsPun, ProfitPeriod, (Volume > 0 | LimitVolume > 0), PDbefore, PDPun, PDRedist, PDbeforeVol, PDPunVol, PDRedistVol, PDbefore*as.numeric(PDbefore>0), PDPun*as.numeric(PDPun>0), PDRedist*as.numeric(PDRedist>0), PDbefore*as.numeric(PDbefore<0), PDPun*as.numeric(PDPun<0), PDRedist*as.numeric(PDRedist<0), shortsells, marginbuys, marginbuysAsset) ~ Role + Phase + IsREG + subTreatment, data=tradersummary,  function(x) quantile(x, probs = 0.975))
colnames(avgtraderPhaseTreatsummaryul) <- c("Role" , "Phase","IsREG", "subTreatment", "ulVolume", "ulLimitVolume", "ulTradingProfit", "ulTPUnits", "ulTPUnitsPun", "ulProfitPeriod", "ulPR", "ulPDbefore", "ulPDPun", "ulPDRedist", "ulPDbeforeVol", "ulPDPunVol", "ulPDRedistVol", "ulV14", "ulV15", "ulV16", "ulV17", "ulV18", "ulV19", "ulshortsells", "ulmarginbuys", "ulmarginbuysAsset")
avgtraderPhaseTreatsummaryll <- aggregate(cbind(Volume, LimitVolume, TradingProfit, TPUnits, TPUnitsPun, ProfitPeriod, (Volume > 0 | LimitVolume > 0), PDbefore, PDPun, PDRedist, PDbeforeVol, PDPunVol, PDRedistVol, PDbefore*as.numeric(PDbefore>0), PDPun*as.numeric(PDPun>0), PDRedist*as.numeric(PDRedist>0), PDbefore*as.numeric(PDbefore<0), PDPun*as.numeric(PDPun<0), PDRedist*as.numeric(PDRedist<0), shortsells, marginbuys, marginbuysAsset) ~ Role + Phase + IsREG + subTreatment, data=tradersummary,  function(x) quantile(x, probs = 0.025))
colnames(avgtraderPhaseTreatsummaryll) <- c("Role" , "Phase","IsREG", "subTreatment", "llVolume", "llLimitVolume", "llTradingProfit", "llTPUnits", "llTPUnitsPun", "llProfitPeriod", "llPR", "llPDbefore", "llPDPun", "llPDRedist", "llPDbeforeVol", "llPDPunVol", "llPDRedistVol", "llV14", "llV15", "llV16", "llV17", "llV18", "llV19", "llshortsells", "llmarginbuys", "llmarginbuysAsset")
avgtraderPhaseTreatsummarysd <- aggregate(cbind(Volume, LimitVolume, TradingProfit, TPUnits, TPUnitsPun, ProfitPeriod, (Volume > 0 | LimitVolume > 0), PDbefore, PDPun, PDRedist, PDbeforeVol, PDPunVol, PDRedistVol, PDbefore*as.numeric(PDbefore>0), PDPun*as.numeric(PDPun>0), PDRedist*as.numeric(PDRedist>0), PDbefore*as.numeric(PDbefore<0), PDPun*as.numeric(PDPun<0), PDRedist*as.numeric(PDRedist<0), shortsells, marginbuys, marginbuysAsset) ~ Role + Phase + IsREG + subTreatment, data=tradersummary, function(x) sd(x, na.rm = T), na.action = na.pass)
colnames(avgtraderPhaseTreatsummarysd)[colnames(avgtraderPhaseTreatsummarysd) == "V7"] <- "PR"
avgtraderPhaseTreatsummary2sd <- reshape2::melt(subset(avgtraderPhaseTreatsummarysd), id.vars = c("Phase", "IsREG", "Role", "subTreatment"))
colnames(avgtraderPhaseTreatsummary2sd)[colnames(avgtraderPhaseTreatsummary2sd) == "value"] <- "sd"
colnames(avgtraderPhaseTreatsummarysd) <- c("Role" , "Phase","IsREG", "subTreatment", "sdVolume", "sdLimitVolume", "sdTradingProfit", "sdTPUnits", "sdTPUnitsPun", "sdProfitPeriod", "sdPR", "sdPDbefore", "sdPDPun", "sdPDRedist", "sdPDbeforeVol", "sdPDPunVol", "sdPDRedistVol", "sdV14", "sdV15", "sdV16", "sdV17", "sdV18", "sdV19", "sdshortsells", "sdmarginbuys", "sdmarginbuysAsset")
avgtraderPhaseTreatsummaryn <- aggregate(Volume ~ Role + Phase + IsREG + subTreatment, data=tradersummary, function(x) length(x))
colnames(avgtraderPhaseTreatsummaryn) <- c("Role", "Phase","IsREG", "subTreatment", "n")
avgtraderPhaseTreatsummary <- merge(avgtraderPhaseTreatsummary, avgtraderPhaseTreatsummaryn, by = c("Role" ,"Phase","IsREG", "subTreatment"))
avgtraderPhaseTreatsummary <- merge(avgtraderPhaseTreatsummary, avgtraderPhaseTreatsummaryul, by = c("Role","Phase","IsREG", "subTreatment"))
avgtraderPhaseTreatsummary <- merge(avgtraderPhaseTreatsummary, avgtraderPhaseTreatsummaryll, by = c("Role","Phase","IsREG", "subTreatment"))
avgtraderPhaseTreatsummary <- merge(avgtraderPhaseTreatsummary, avgtraderPhaseTreatsummarysd, by = c("Role","Phase","IsREG", "subTreatment"))

avgtraderPhaseTreatsummary2 <- merge(avgtraderPhaseTreatsummary2, avgtraderPhaseTreatsummary2sd, by = c("Role" , "Phase","IsREG", "subTreatment", "variable"))
avgtraderPhaseTreatsummary2 <- merge(avgtraderPhaseTreatsummary2, avgtraderPhaseTreatsummaryn, by = c("Role" , "Phase","IsREG", "subTreatment"))
avgtraderPhaseTreatsummary2$upl <- avgtraderPhaseTreatsummary2$value+qt(.975,avgtraderPhaseTreatsummary2$n-1)*avgtraderPhaseTreatsummary2$sd/sqrt(avgtraderPhaseTreatsummary2$n)
avgtraderPhaseTreatsummary2$dol <- avgtraderPhaseTreatsummary2$value+qt(.025,avgtraderPhaseTreatsummary2$n-1)*avgtraderPhaseTreatsummary2$sd/sqrt(avgtraderPhaseTreatsummary2$n)
avgtraderPhaseTreatsummary2$Role <- factor(avgtraderPhaseTreatsummary2$Role, labels = c("Informed\ntraders","Uninformed\ntraders"))
avgtraderPhaseTreatsummary2$Role <- ordered(avgtraderPhaseTreatsummary2$Role, levels = c("Informed\ntraders","Uninformed\ntraders"))
avgtraderPhaseTreatsummary2$Phase <- factor(avgtraderPhaseTreatsummary2$Phase, levels = c("Phases 1 & 2","Phase 3", "Phase 4"))
avgtraderPhaseTreatsummary2$subTreatment <- factor(avgtraderPhaseTreatsummary2$subTreatment, levels = c("FLUCT", "FIXED"))


avgtraderPhaseTreatsummary2$Variable <- as.character(avgtraderPhaseTreatsummary2$variable)
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "LimitVolume"] <- "Limit volume"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "Volume"] <- "Traders' mean trading volume"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "PR"] <- "Participation rate"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "shortsells"] <- "Short sells"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "marginbuysAsset"] <- "Margin buys"

avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "PDbefore"] <- "Trading profig before redistribution"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "PDredist"] <- "Trading profig after redistribution"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "PDPun"] <- "Trading profig after punishment"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "PDbeforeVol"] <- "Trading profig before redistribution per transacted asset"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "PDredistVol"] <- "Trading profig after redistribution per transacted asset"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "PDPunVol"] <- "Trading profig after punishment per transacted asset"

avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "V14"] <- "Positive trading profig before redistribution"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "V17"] <- "Negative trading profig before redistribution"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "V15"] <- "Positive trading profig after punishment"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "V18"] <- "Negative trading profig after punishment"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "V16"] <- "Positive rading profig after redistribution"
avgtraderPhaseTreatsummary2$Variable[avgtraderPhaseTreatsummary2$variable == "V19"] <- "Negative trading profig after redistribution"

```

Test participation difference between regulatory regimes in both treatments and all phases reported in the Online Appendix in Section 3.1
```{r ttestPR, echo=F}
t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>0), var.equal=T)
```

Test participation difference between regulatory regimes for informed traders in treatment FIXED in all phases reported in the Online Appendix in Section 3.1
```{r ttestPRREGInformed, echo=F}
t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)
```

Test participation difference between regulatory regimes for uninformed traders in treatment FIXED in all phases reported in the Online Appendix in Section 3.1
```{r ttestPRREGUninformed, echo=F}
t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)
```

Test participation difference between regulatory regimes for informed traders in treatment FLUCT in all phases reported in the Online Appendix in Section 3.1
```{r ttestPRREGInformedFLUCT, echo=F}
t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)
```

Test participation difference between regulatory regimes for uninformed traders in treatment FIXED in all phases reported in the Online Appendix in Section 3.1
```{r ttestPRREGUninformedFLUCT, echo=F}
t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)
```

```{r GraphPRTableOA5, echo=F, include=F}
## Tests of participation differences between regulatory regimes reported in Table OA5 and in-text in the Online Appendix in Section 3.1
tPRInfX <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE) # reported in the Online Appendix in Section 3.1 in-text
tPRUniX <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE) # reported in the Online Appendix in Section 3.1 in-text
tPR1InfX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "REG")$active == "active", subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$active == "active", var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPR1UniX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "REG")$active == "active", subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$active == "active", var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPR2InfX <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPR2UniX <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPR3InfX <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPR3UniX <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPR34InfX <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>6 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPR34UniX <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>6  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)

tPRInfU <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE) # reported in the Online Appendix in Section 3.1 in-text
tPRUniU <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE) # reported in the Online Appendix in Section 3.1 in-text
tPR1InfU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "REG")$active == "active", subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$active == "active", var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPR1UniU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "REG")$active == "active", subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$active == "active", var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPR2InfU <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPR2UniU <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPR3InfU <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPR3UniU <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPR34InfU <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>6 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPR34UniU <- format(round(t.test((LimitVolume > 0 | Volume > 0) ~ IsREG, data=subset(tradersummary, Period>6  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)

ePRInfX <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePRUniX <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR1InfX <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR1UniX <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR2InfX <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR2UniX <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR3InfX <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR3UniX <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR34InfX <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>6 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR34UniX <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>6  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)

ePRInfU <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePRUniU <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR1InfU <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR1UniU <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR2InfU <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR2UniU <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR3InfU <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR3UniU <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR34InfU <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>6 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePR34UniU <- format(round(t.test((LimitVolume > 0 | Volume > 0)*100 ~ IsREG, data=subset(tradersummary, Period>6  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)

dat_textVol <- data.frame(
  label = c(paste0("p = ",tPR1InfU,""), paste0("p = ",tPR1UniU,""), paste0("p = ",tPR2InfU,""), paste0("p = ",tPR2UniU,""), paste0("p = ",tPR3InfU,""),paste0("p = ",tPR3UniU,""), paste0("p = ",tPR1InfX,""), paste0("p = ",tPR1UniX,""), paste0("p = ",tPR2InfX,""), paste0("p = ",tPR2UniX,""), paste0("p = ",tPR3InfX,""), paste0("p = ",tPR3UniX,"")),
  IsREG   = c("REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG"),
  Role = c("Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders"),
  Phase = c("Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4", "Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4"),
  group = c("PR","PR","PR", "PR", "PR", "PR", "PR","PR","PR", "PR", "PR", "PR"),
  Variable = c("PR","PR","PR", "PR", "PR", "PR", "PR","PR","PR", "PR", "PR", "PR"),
  subTreatment = c("FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED"),
  vjust = c(0,0,0,0,0,0,0,0,0,0,0,0)
)
```

### Limit order volume

Test limit order volume between regulatory regimes for uninformed traders in treatment FIXED in all phases reported in the Online Appendix in Section 3.1
```{r ttestLimitREGUninformed, echo=F}
t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)
```

Test limit order volume between regulatory regimes for uninformed traders in treatment FIXED in all phases reported in the Online Appendix in Section 3.1
```{r ttestLimitREGUninformedFLUCT, echo=F}
t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)
```

Test limit order volume between treatments for uninformed traders in all phases reported in the Online Appendix in Section 3.1
```{r ttestLimitUninformedFLUCT, echo=F}
t.test(LimitVolume ~ subTreatment, data=subset(tradersummary, Period>0 & Role=="Uninformed trader"), var.equal=T)
```

Test limit order volume between regulatory regimes for informed traders in treatment FIXED in all phases reported in the Online Appendix in Section 3.1
```{r ttestLimitREGInformed, echo=F}
t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)
```

Test limit order volume between regulatory regimes for informed traders in treatment FLUCT in all phases reported in the Online Appendix in Section 3.1
```{r ttestLimitREGInformedFLUCT, echo=F}
t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)
```

Test limit order volume between treatments for informed traders in all phases reported in the Online Appendix in Section 3.1
```{r ttestLimitInformedFLUCT, echo=F}
t.test(LimitVolume ~ subTreatment, data=subset(tradersummary, Period>0 & Role=="Informed trader"), var.equal=T)
```

```{r GraphLimit, echo=F}
## Tests of limit order volume differences between regulatory regimes reported in-text in the Online Appendix in Section 3.1
tLimitVolumeInfX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE) # reported in the Online Appendix in Section 3.1 in-text
tLimitVolumeUniX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE) # reported in the Online Appendix in Section 3.1 in-text
tLimitVolume1InfX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "REG")$LimitVolume, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$LimitVolume, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume1UniX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "REG")$LimitVolume, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$LimitVolume, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume2InfX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume2UniX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume3InfX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume3UniX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume34InfX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume34UniX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)

tLimitVolumeInfU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE) # reported in the Online Appendix in Section 3.1 in-text
tLimitVolumeUniU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE) # reported in the Online Appendix in Section 3.1 in-text
tLimitVolume1InfU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "REG")$LimitVolume, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$LimitVolume, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume1UniU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "REG")$LimitVolume, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$LimitVolume, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume2InfU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume2UniU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume3InfU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume3UniU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume34InfU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tLimitVolume34UniU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)

eLimitVolumeInfX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolumeUniX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume1InfX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume1UniX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume2InfX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume2UniX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume3InfX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume3UniX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume34InfX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume34UniX <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)

eLimitVolumeInfU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolumeUniU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume1InfU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume1UniU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume2InfU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume2UniU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume3InfU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume3UniU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume34InfU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eLimitVolume34UniU <- format(round(t.test(LimitVolume ~ IsREG, data=subset(tradersummary, Period>6  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)

dat_textVol <- data.frame(
  label = c(paste0("p = ",tLimitVolume1InfU,""), paste0("p = ",tLimitVolume1UniU,""), paste0("p = ",tLimitVolume2InfU,""), paste0("p = ",tLimitVolume2UniU,""), paste0("p = ",tLimitVolume3InfU,""),paste0("p = ",tLimitVolume3UniU,""), paste0("p = ",tLimitVolume1InfX,""), paste0("p = ",tLimitVolume1UniX,""), paste0("p = ",tLimitVolume2InfX,""), paste0("p = ",tLimitVolume2UniX,""), paste0("p = ",tLimitVolume3InfX,""), paste0("p = ",tLimitVolume3UniX,"")),
  IsREG   = c("REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG"),
  Role = c("Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders"),
  Phase = c("Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4", "Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4"),
  group = c("LimitVolume","LimitVolume","LimitVolume", "LimitVolume", "LimitVolume", "LimitVolume", "LimitVolume","LimitVolume","LimitVolume", "LimitVolume", "LimitVolume", "LimitVolume"),
  Variable = c("LimitVolume","LimitVolume","LimitVolume", "LimitVolume", "LimitVolume", "LimitVolume", "LimitVolume","LimitVolume","LimitVolume", "LimitVolume", "LimitVolume", "LimitVolume"),
  subTreatment = c("FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED"),
  vjust = c(0,0,0,0,0,0,0,0,0,0,0,0)
)
```

```{r offervolumetableAll, echo=F, results = 'asis'}
## mixed models
lnoffer3Uninf <- lmer(log(limitVolumeUni) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>6 & Period<10))
lnoffer3Inf <- lmer(log(limitVolumeInf) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>6 & Period<10))
lnoffer12Uninf <- lmer(log(limitVolumeUni) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0 & Period <7))
lnoffer12Inf <- lmer(log(limitVolumeInf) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0 & Period <7))
lnoffer4Uninf <- lmer(log(limitVolumeUni) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>=10))
lnoffer4Inf <- lmer(log(limitVolumeInf) ~  subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>=10))

lnofferallUninf <- lmer(log(limitVolumeUni) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0))
lnofferallInf <- lmer(log(limitVolumeInf) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0))

lnoffer3 <- lmer(log(LimitVol) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>6 & Period<10))
lnoffer12 <- lmer(log(LimitVol) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0 & Period <7))
lnoffer4 <- lmer(log(LimitVol) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>=10))
lnofferall <- lmer(log(LimitVol) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0))
```

```{r tableOA6, echo=F, results='asis'}
texreg(list(lnoffer12Inf, lnoffer3Inf, lnoffer4Inf, lnoffer12Uninf, lnoffer3Uninf, lnoffer4Uninf), 
       custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"),
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,   omit.coef = "(Session)|(subject)", 
       custom.model.names = c("Phases 1 and 2", "Phase 3", "Phase 4","Phases 1 and 2", "Phase 3", "Phase 4"),
       caption = "[Table OA6:] Mixed effects regressions of offered volume (‘ln(limit volume)’) by trader type and phase.", 
       label = "TableOA6")
```


### Transaction volume

```{r persecond, echo=F}
transactionspersecond <- length(transactions$transactionID)/32/180/12
volumepersecond <- sum(transactions$transactionVol)/32/180/12
```
The number of transactions per second is equal to `r transactionspersecond`, while `r volumepersecond` is the transacted volume per second over all sessions, periods, and markets.


Test transaction volume between regulatory regimes for informed traders in treatment FIXED in all phases reported in the Online Appendix in Section 3.1
```{r ttestVolumeREGInformed, echo=F}
t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)
```

Test transaction volume between regulatory regimes for informed traders in treatment FLUCT in all phases reported in the Online Appendix in Section 3.1
```{r ttestVolumeREGInformedFLUCT, echo=F}
t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)
```

Test transaction volume between treatments for informed traders in all phases reported in the Online Appendix in Section 3.1
```{r ttestVolumeInformedFLUCT, echo=F}
t.test(Volume ~ subTreatment, data=subset(tradersummary, Period>0 & Role=="Informed trader"), var.equal=T)
```

Test transaction volume between regulatory regimes for uninformed traders in treatment FIXED in all phases reported in the Online Appendix in Section 3.1
```{r ttestVolumeREGUninformed, echo=F}
t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)
```

Test transaction volume between regulatory regimes for uninformed traders in treatment FLUCT in all phases reported in the Online Appendix in Section 3.1
```{r ttestVolumeREGUniformedFLUCT, echo=F}
t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)
```

Test transaction volume between treatments for uninformed traders in all phases reported in the Online Appendix in Section 3.1
```{r ttestVolumeUninformedFLUCT, echo=F}
t.test(Volume ~ subTreatment, data=subset(tradersummary, Period>0 & Role=="Uninformed trader"), var.equal=T)
```

```{r Graphvol, echo=F}
## Tests of transacted volume differences between regulatory regimes reported in-text in the Online Appendix in Section 3.1
tVolumeInfX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE) # reported in the Online Appendix in Section 3.1 in-text
tVolumeUniX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE) # reported in the Online Appendix in Section 3.1 in-text
tVolume1InfX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "REG")$Volume, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$Volume, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tVolume1UniX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "REG")$Volume, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$Volume, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tVolume2InfX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tVolume2UniX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tVolume3InfX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tVolume3UniX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tVolume34InfX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tVolume34UniX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)

tVolumeInfU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE) # reported in the Online Appendix in Section 3.1 in-text
tVolumeUniU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE) # reported in the Online Appendix in Section 3.1 in-text
tVolume1InfU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "REG")$Volume, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$Volume, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tVolume1UniU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "REG")$Volume, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$Volume, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tVolume2InfU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tVolume2UniU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tVolume3InfU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tVolume3UniU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tVolume34InfU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tVolume34UniU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)

eVolumeInfX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolumeUniX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume1InfX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume1UniX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume2InfX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume2UniX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume3InfX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume3UniX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume34InfX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume34UniX <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)

eVolumeInfU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolumeUniU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume1InfU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume1UniU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume2InfU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume2UniU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume3InfU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume3UniU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume34InfU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eVolume34UniU <- format(round(t.test(Volume ~ IsREG, data=subset(tradersummary, Period>6  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)

dat_textVol <- data.frame(
  label = c(paste0("p = ",tVolume1InfU,""), paste0("p = ",tVolume1UniU,""), paste0("p = ",tVolume2InfU,""), paste0("p = ",tVolume2UniU,""), paste0("p = ",tVolume3InfU,""),paste0("p = ",tVolume3UniU,""), paste0("p = ",tVolume1InfX,""), paste0("p = ",tVolume1UniX,""), paste0("p = ",tVolume2InfX,""), paste0("p = ",tVolume2UniX,""), paste0("p = ",tVolume3InfX,""), paste0("p = ",tVolume3UniX,"")),
  IsREG   = c("REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG"),
  Role = c("Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders"),
  Phase = c("Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4", "Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4"),
  group = c("Volume","Volume","Volume", "Volume", "Volume", "Volume", "Volume","Volume","Volume", "Volume", "Volume", "Volume"),
  Variable = c("Volume","Volume","Volume", "Volume", "Volume", "Volume", "Volume","Volume","Volume", "Volume", "Volume", "Volume"),
  subTreatment = c("FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED"),
  vjust = c(0,0,0,0,0,0,0,0,0,0,0,0)
)
```

Test transaction volume between regulatory regimes for the trader type correspondence between uninformed traders (uu) in Phases 1 & 2 reported in the Online Appendix in Section 3.1
```{r ttestCorrUUREG, echo=F}
t.test(subset(marketsummary, Period>0 & Period<7 & IsREG == "REG")$Volume_Uninformed_Uninformed, subset(marketsummary, Period>0 & Period<7 & IsREG == "NOREG")$Volume_Uninformed_Uninformed, var.equal=T, paired=T)
```

Test transaction volume between regulatory regimes for the trader type correspondence between informed and uninformed traders (iu) in Phases 1 & 2 reported in the Online Appendix in Section 3.1
```{r ttestCorrIUREG, echo=F}
t.test(subset(marketsummary, Period>0 & Period<7 & IsREG == "REG")$Volume_Informed_Uninformed, subset(marketsummary, Period>0 & Period<7 & IsREG == "NOREG")$Volume_Informed_Uninformed, var.equal=T, paired=T)
```

Test transaction volume between regulatory regimes for the trader type correspondence between uninformed and informed traders (ui) in Phases 1 & 2 reported in the Online Appendix in Section 3.1
```{r ttestCorrUIREG, echo=F}
t.test(subset(marketsummary, Period>0 & Period<7 & IsREG == "REG")$Volume_Uninformed_Informed, subset(marketsummary, Period>0 & Period<7 & IsREG == "NOREG")$Volume_Uninformed_Informed, var.equal=T, paired=T)
```

Test transaction volume between regulatory regimes for the trader type correspondence between uninformed and informed traders (ui) in treatment FIXED in Phases 1 & 2 reported in the Online Appendix in Section 3.1
```{r ttestCorrUIREGFIXED, echo=F}
t.test(subset(marketsummary, Period>0 & Period<7 & subTreatment == "FIXED" & IsREG == "REG")$Volume_Uninformed_Informed, subset(marketsummary, Period>0 & Period<7 & subTreatment == "FIXED" & IsREG == "NOREG")$Volume_Uninformed_Informed, var.equal=T, paired=T)
```

Test transaction volume between regulatory regimes for the trader type correspondence between informed and uninformed traders (iu) in Phases 1 & 2 reported in the Online Appendix in Section 3.1
```{r ttestCorrIUREGFLUCT, echo=F}
t.test(subset(marketsummary, Period>0 & Period<7 & subTreatment == "FLUCT" & IsREG == "REG")$Volume_Informed_Uninformed, subset(marketsummary, Period>0 & Period<7 & subTreatment == "FLUCT" & IsREG == "NOREG")$Volume_Informed_Uninformed, var.equal=T, paired=T)
```

```{r RoleTreatTrade, echo=F}
u <- aggregate(cbind(Volume_Informed_Informed)  ~ Phase + subTreatment + IsREG, data = subset(marketsummary, Period > 0), function(x) mean(x[x < Inf & x > -Inf], na.rm = TRUE))
colnames(u)[4] <- "Volume"
un <- aggregate(cbind(Volume_Informed_Informed)  ~ Phase + subTreatment + IsREG, data = subset(marketsummary, Period > 0), function(x) length(x[x < Inf & x > -Inf]))
colnames(un) <- c("Phase", "subTreatment", "IsREG", "n")
usd <- aggregate(cbind(Volume_Informed_Informed)  ~ Phase + subTreatment + IsREG, data = subset(marketsummary, Period > 0), function(x) sd(x[x < Inf & x > -Inf], na.rm = TRUE))
colnames(usd) <- c("Phase", "subTreatment", "IsREG", "sd")
u$type <- "ii"
u <- merge(u, usd, by=c("Phase", "subTreatment", "IsREG"))
u <- merge(u, un, by=c("Phase", "subTreatment", "IsREG"))

u2 <- aggregate(cbind(Volume_Informed_Uninformed)  ~ Phase + subTreatment + IsREG, data = subset(marketsummary, Period > 0), function(x) mean(x[x < Inf & x > -Inf], na.rm = TRUE))
colnames(u2)[4] <- "Volume"
u2n <- aggregate(cbind(Volume_Informed_Uninformed)  ~ Phase + subTreatment + IsREG, data = subset(marketsummary, Period > 0), function(x) length(x[x < Inf & x > -Inf]))
colnames(u2n) <- c("Phase", "subTreatment", "IsREG", "n")
u2sd <- aggregate(cbind(Volume_Informed_Uninformed)  ~ Phase + subTreatment + IsREG, data = subset(marketsummary, Period > 0), function(x) sd(x[x < Inf & x > -Inf], na.rm = TRUE))
colnames(u2sd) <- c("Phase", "subTreatment", "IsREG", "sd")
u2$type <- "iu"
u2 <- merge(u2, u2sd, by=c("Phase", "subTreatment", "IsREG"))
u2 <- merge(u2, u2n, by=c("Phase", "subTreatment", "IsREG"))

u3 <- aggregate(cbind(Volume_Uninformed_Informed)  ~ Phase + subTreatment + IsREG, data = subset(marketsummary, Period > 0), function(x) mean(x[x < Inf & x > -Inf], na.rm = TRUE))
colnames(u3)[4] <- "Volume"
u3n <- aggregate(cbind(Volume_Uninformed_Informed)  ~ Phase + subTreatment + IsREG, data = subset(marketsummary, Period > 0), function(x) length(x[x < Inf & x > -Inf]))
colnames(u3n) <- c("Phase", "subTreatment", "IsREG", "n")
u3sd <- aggregate(cbind(Volume_Uninformed_Informed)  ~ Phase + subTreatment + IsREG, data = subset(marketsummary, Period > 0), function(x) sd(x[x < Inf & x > -Inf], na.rm = TRUE))
colnames(u3sd) <- c("Phase", "subTreatment", "IsREG", "sd")
u3$type <- "ui"
u3 <- merge(u3, u3sd, by=c("Phase", "subTreatment", "IsREG"))
u3 <- merge(u3, u3n, by=c("Phase", "subTreatment", "IsREG"))

u4 <- aggregate(cbind(Volume_Uninformed_Uninformed)  ~ Phase + subTreatment + IsREG, data = subset(marketsummary, Period > 0), function(x) mean(x[x < Inf & x > -Inf], na.rm = TRUE))
colnames(u4)[4] <- "Volume"
u4n <- aggregate(cbind(Volume_Uninformed_Uninformed)  ~ Phase + subTreatment + IsREG, data = subset(marketsummary, Period > 0), function(x) length(x[x < Inf & x > -Inf]))
colnames(u4n) <- c("Phase", "subTreatment", "IsREG", "n")
u4sd <- aggregate(cbind(Volume_Uninformed_Uninformed)  ~ Phase + subTreatment + IsREG, data = subset(marketsummary, Period > 0), function(x) sd(x[x < Inf & x > -Inf], na.rm = TRUE))
colnames(u4sd) <- c("Phase", "subTreatment", "IsREG", "sd")
u4$type <- "uu"
u4 <- merge(u4, u4sd, by=c("Phase", "subTreatment", "IsREG"))
u4 <- merge(u4, u4n, by=c("Phase", "subTreatment", "IsREG"))
u <- rbind(u,u2,u3,u4)
u$maxV <- max(u$Volume)
u$ll <- u$Volume + qt(.025,u$n)*u$sd/sqrt(u$n)
u$ul <- u$Volume + qt(.975,u$n)*u$sd/sqrt(u$n)
u$Phase <- factor(u$Phase, levels = c("Phases 1 & 2", "Phase 3", "Phase 4"))
u$subTreatment <- factor(u$subTreatment, levels = c("FLUCT", "FIXED"))

dt1X <- format(round(t.test(subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FIXED" & IsREG == "REG")$Volume_Informed_Informed, subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FIXED" & IsREG == "NOREG")$Volume_Informed_Informed, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
dt2X <- format(round(t.test(Volume_Informed_Informed ~ IsREG, data=subset(marketsummary, Phase == "Phase 3" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt3X <- format(round(t.test(Volume_Informed_Informed ~ IsREG, data=subset(marketsummary, Phase == "Phase 4" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt4X <- format(round(t.test(subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FIXED" & IsREG =="REG")$Volume_Informed_Uninformed, subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FIXED" & IsREG =="NOREG")$Volume_Informed_Uninformed, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
dt5X <- format(round(t.test(Volume_Informed_Uninformed ~ IsREG, data=subset(marketsummary, Phase == "Phase 3" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt6X <- format(round(t.test(Volume_Informed_Uninformed ~ IsREG, data=subset(marketsummary, Phase == "Phase 4" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt7X <- format(round(t.test(subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FIXED" & IsREG == "REG")$Volume_Uninformed_Informed, subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FIXED" & IsREG == "NOREG")$Volume_Uninformed_Informed, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
dt8X <- format(round(t.test(Volume_Uninformed_Informed ~ IsREG, data=subset(marketsummary, Phase == "Phase 3" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt9X <- format(round(t.test(Volume_Uninformed_Informed ~ IsREG, data=subset(marketsummary, Phase == "Phase 4" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt10X <- format(round(t.test(subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FIXED" & IsREG == "REG")$Volume_Uninformed_Uninformed, subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FIXED" & IsREG == "NOREG")$Volume_Uninformed_Uninformed, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
dt11X <- format(round(t.test(Volume_Uninformed_Uninformed ~ IsREG, data=subset(marketsummary, Phase == "Phase 3" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt12X <- format(round(t.test(Volume_Uninformed_Uninformed ~ IsREG, data=subset(marketsummary, Phase == "Phase 4" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)

dt1U <- format(round(t.test(subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FLUCT" & IsREG == "REG")$Volume_Informed_Informed, subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FLUCT" & IsREG == "NOREG")$Volume_Informed_Informed, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
dt2U <- format(round(t.test(Volume_Informed_Informed ~ IsREG, data=subset(marketsummary, Phase == "Phase 3" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt3U <- format(round(t.test(Volume_Informed_Informed ~ IsREG, data=subset(marketsummary, Phase == "Phase 4" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt4U <- format(round(t.test(subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FLUCT" & IsREG == "REG")$Volume_Informed_Uninformed, subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FLUCT" & IsREG == "NOREG")$Volume_Informed_Uninformed, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
dt5U <- format(round(t.test(Volume_Informed_Uninformed ~ IsREG, data=subset(marketsummary, Phase == "Phase 3" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt6U <- format(round(t.test(Volume_Informed_Uninformed ~ IsREG, data=subset(marketsummary, Phase == "Phase 4" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt7U <- format(round(t.test(subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FLUCT" & IsREG == "REG")$Volume_Uninformed_Informed, subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FLUCT" & IsREG == "NOREG")$Volume_Uninformed_Informed, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
dt8U <- format(round(t.test(Volume_Uninformed_Informed ~ IsREG, data=subset(marketsummary, Phase == "Phase 3" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt9U <- format(round(t.test(Volume_Uninformed_Informed ~ IsREG, data=subset(marketsummary, Phase == "Phase 4" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt10U <- format(round(t.test(subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FLUCT" & IsREG == "REG")$Volume_Uninformed_Uninformed, subset(marketsummary, Phase == "Phases 1 & 2" & subTreatment == "FLUCT" & IsREG == "NOREG")$Volume_Uninformed_Uninformed, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
dt11U <- format(round(t.test(Volume_Uninformed_Uninformed ~ IsREG, data=subset(marketsummary, Phase == "Phase 3" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
dt12U <- format(round(t.test(Volume_Uninformed_Uninformed ~ IsREG, data=subset(marketsummary, Phase == "Phase 4" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)


dat_text <- data.frame(
  label = c(paste0("p = ",dt1X,""), paste0("p = ",dt2X,""), paste0("p = ",dt3X,""), paste0("p = ",dt4X,""), paste0("p = ",dt5X,""),paste0("p = ",dt6X,""),paste0("p = ",dt7X,""),paste0("p = ",dt8X,""),paste0("p = ",dt9X,""),paste0("p = ",dt10X,""),paste0("p = ",dt11X,""),paste0("p = ",dt12X,""), paste0("p = ",dt1U,""), paste0("p = ",dt2U,""), paste0("p = ",dt3U,""), paste0("p = ",dt4U,""), paste0("p = ",dt5U,""),paste0("p = ",dt6U,""),paste0("p = ",dt7U,""),paste0("p = ",dt8U,""),paste0("p = ",dt9U,""),paste0("p = ",dt10U,""),paste0("p = ",dt11U,""),paste0("p = ",dt12U,"")),
  IsREG   = c("REG", "REG", "NOREG", "NOREG", "REG", "REG", "NOREG", "NOREG", "REG", "REG", "NOREG", "NOREG","REG", "REG", "NOREG", "NOREG", "REG", "REG", "NOREG", "NOREG", "REG", "REG", "NOREG", "NOREG"),
  Phase = c("Phases 1 & 2", "Phase 3", "Phase 4", "Phases 1 & 2", "Phase 3", "Phase 4","Phases 1 & 2", "Phase 3", "Phase 4","Phases 1 & 2", "Phase 3", "Phase 4", "Phases 1 & 2", "Phase 3", "Phase 4", "Phases 1 & 2", "Phase 3", "Phase 4","Phases 1 & 2", "Phase 3", "Phase 4","Phases 1 & 2", "Phase 3", "Phase 4"),
  type = c("ii", "ii", "ii", "iu", "iu", "iu", "ui", "ui", "ui", "uu", "uu", "uu", "ii", "ii", "ii", "iu", "iu", "iu", "ui", "ui", "ui", "uu", "uu", "uu"),
  subTreatment = c("FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT")
)
```

```{r graphicVolumeRole, echo=F, fig.cap="[Figure OA6:] Mean market trading volume by combination of trading partners, regulatory regime, and phase."}
#postscript("Figures/xxx_FigureOA6_volume.eps")
ggplot(data=u, aes(y= Volume, x= type, group=interaction(subTreatment, IsREG), fill = IsREG, color = type)) +
  geom_bar(stat="identity", position = position_dodge(width = 0.5))+  
  labs(y="Markets' mean trading volume") +
  geom_text(data = subset(dat_text[1:6,]), mapping = aes(x = type, y = -2, label = label), col = "black", size = 2 #, size = 4 # used in paper but not in Rmarkdown output
            ) +
  geom_text(data = subset(dat_text[7:12,]), mapping = aes(x = type, y = -2 , label = label), col = "black", size = 2 #, size = 4 # used in paper but not in Rmarkdown output
            ) +
  geom_text(data = subset(dat_text[13:18,]), mapping = aes(x = type, y = -2, label = label), col = "black", size = 2 #, size = 4 # used in paper but not in Rmarkdown output
            ) +
  geom_text(data = subset(dat_text[19:24,]), mapping = aes(x = type, y = -2 , label = label), col = "black", size = 2 #, size = 4 # used in paper but not in Rmarkdown output
            ) +
  geom_errorbar(aes(ymin = ll, ymax = ul), width=.2, color = 'black', position=position_dodge(width=0.5)) +
  theme(#text = element_text(size=18), # used in paper but not in Rmarkdown output
        axis.title.x=element_blank(),legend.title = element_blank(), legend.position = "bottom", legend.direction = "vertical", panel.grid.minor = element_line(colour = "lightgrey"), panel.background = element_rect(fill = "transparent"),  plot.background = element_rect(fill = "transparent")) +
  facet_grid(factor(subTreatment, levels = c("FLUCT", "FIXED")) ~ factor(Phase),scales = "free") +
  scale_fill_manual( values = c("NOREG" = rgb(.46, .76, .88), "REG" = rgb(0,.29,.51))) +
  scale_colour_manual(name = "", values = c(0,0,0,0), labels = c("ii   = informed accepted from informed", "iu  = informed accepted from uninformed", "ui  = uninformed accepted from informed", "uu = uninformed accepted from uninformed")) +
  guides(color = guide_legend(keywidth = unit(0,"mm"))) +
  geom_blank(aes(y= maxV))
#dev.off()
```


```{r volumetableAll, echo=F, results = 'asis'}
marketsummary$subTreatment <- factor(marketsummary$subTreatment, levels = c("FLUCT", "FIXED"))
## mixed models
ln3Uninf <- lmer(log(VolumeUni) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>6 & Period<10))
ln3Inf <- lmer(log(VolumeInf) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, VolumeInf>0 & Period>6 & Period<10))
ln12Uninf <- lmer(log(VolumeUni) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0 & Period <7))
ln12Inf <- lmer(log(VolumeInf) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, VolumeInf>0 & Period > 0 & Period <7))
ln4Uninf <- lmer(log(VolumeUni) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>=10 & VolumeUni > 0))
ln4Inf <- lmer(log(VolumeInf) ~  subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, VolumeInf>0 & Period>=10))

lnallUninf <- lmer(log(VolumeUni) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0 & VolumeUni>0))
lnallInf <- lmer(log(VolumeInf) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0 & VolumeInf>0 ))

ln3 <- lmer(log(transactionVol) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>6 & Period<10))
ln12 <- lmer(log(transactionVol) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0 & Period <7))
ln4 <- lmer(log(transactionVol) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>=10 & transactionVol > 0))
lnall <- lmer(log(transactionVol) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0 & transactionVol > 0))
```

```{r TableOA7, echo=F, results='asis'}
texreg(list(ln12Inf, ln3Inf, ln4Inf, ln12Uninf, ln3Uninf, ln4Uninf), custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"), 
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,   omit.coef = "(Session)|(subject)", 
       custom.model.names = c("Phases 1 and 2", "Phase 3", "Phase 4","Phases 1 and 2", "Phase 3", "Phase 4"),
       caption = "[Table OA7:] Mixed effects regressions of trading volume (‘ln(transaction volume)’) by trader type and phase.", 
       label = "TableOA7")
```

### Participation rates, transacted volume, and limit order volume by regulatory regime, trader type, and phase (Table OA5)
```{r TableOA5, echo=F}
dat_PRTreat <- data.frame( c(ePRInfX, tPRInfX, ePRUniX, tPRUniX), c(ePR1InfX, tPR1InfX, ePR1UniX, tPR1UniX), c(ePR2InfX, tPR2InfX, ePR2UniX, tPR2UniX),  c(ePR3InfX, tPR3InfX, ePR3UniX, tPR3UniX), c(ePR34InfX, tPR34InfX, ePR34UniX, tPR34UniX),
                      c(ePRInfU, tPRInfU, ePRUniU, tPRUniU), c(ePR1InfU, tPR1InfU, ePR1UniU, tPR1UniU), c(ePR2InfU, tPR2InfU, ePR2UniU, tPR2UniU),  c(ePR3InfU, tPR3InfU, ePR3UniU, tPR3UniU), c(ePR34InfU, tPR34InfU, ePR34UniU, tPR34UniU),
                       c(eVolumeInfX, tVolumeInfX, eVolumeUniX, tVolumeUniX),  c(eVolume1InfX, tVolume1InfX, eVolume1UniX, tVolume1UniX), c(eVolume2InfX, tVolume2InfX, eVolume2UniX, tVolume2UniX), c(eVolume3InfX, tVolume3InfX, eVolume3UniX, tVolume3UniX), c(eVolume34InfX, tVolume34InfX, eVolume34UniX, tVolume34UniX), 
                       c(eVolumeInfU, tVolumeInfU, eVolumeUniU, tVolumeUniU),  c(eVolume1InfU, tVolume1InfU, eVolume1UniU, tVolume1UniU), c(eVolume2InfU, tVolume2InfU, eVolume2UniU, tVolume2UniU), c(eVolume3InfU, tVolume3InfU, eVolume3UniU, tVolume3UniU), c(eVolume34InfU, tVolume34InfU, eVolume34UniU, tVolume34UniU), 
                      c(eLimitVolumeInfX, tLimitVolumeInfX, eLimitVolumeUniX, tLimitVolumeUniX),  c(eLimitVolume1InfX, tLimitVolume1InfX, eLimitVolume1UniX, tLimitVolume1UniX), c(eLimitVolume2InfX, tLimitVolume2InfX, eLimitVolume2UniX, tLimitVolume2UniX), c(eLimitVolume3InfX, tLimitVolume3InfX, eLimitVolume3UniX, tLimitVolume3UniX), c(eLimitVolume34InfX, tLimitVolume34InfX, eLimitVolume34UniX, tLimitVolume34UniX), 
                      c(eLimitVolumeInfU, tLimitVolumeInfU, eLimitVolumeUniU, tLimitVolumeUniU),  c(eLimitVolume1InfU, tLimitVolume1InfU, eLimitVolume1UniU, tLimitVolume1UniU), c(eLimitVolume2InfU, tLimitVolume2InfU, eLimitVolume2UniU, tLimitVolume2UniU), c(eLimitVolume3InfU, tLimitVolume3InfU, eLimitVolume3UniU, tLimitVolume3UniU),  c(eLimitVolume34InfU, tLimitVolume34InfU, eLimitVolume34UniU, tLimitVolume34UniU)
                      )
dat_PRTreat <- t(dat_PRTreat)
colnames(dat_PRTreat) <- c("NOREG", "REG", "pvalues_Informed","NOREG", "REG", "pvalues_Uninformed")
row.names(dat_PRTreat) <- c("PR all phases FIXED", "PR Phases 1 & 2 FIXED",  "PR Phase 3 FIXED",  "PR Phase 4 FIXED", "PR Phase 3 & 4 FIXED", "PR all phases FLUCT", "PR Phases 1 & 2 FLUCT",  "PR Phase 3 FLUCT",  "PR Phase 4 FLUCT", "PR Phase 3 & 4 FLUCT", "Vol all phases FIXED", "Vol Phases 1 & 2 FIXED",  "Vol Phase 3 FIXED",  "Vol Phase 4 FIXED", "Vol Phase 3 & 4 FIXED", "Vol all phases FLUCT", "Vol Phases 1 & 2 FLUCT",  "Vol Phase 3 FLUCT",  "Vol Phase 4 FLUCT", "Vol Phase 3 & 4 FLUCT", "LimitVol all phases FIXED", "LimitVol Phases 1 & 2 FIXED",  "LimitVol Phase 3 FIXED",  "LimitVol Phase 4 FIXED", "LimitVol Phase 3 & 4 FIXED", "LimitVol all phases FLUCT", "LimitVol Phases 1 & 2 FLUCT",  "LimitVol Phase 3 FLUCT",  "LimitVol Phase 4 FLUCT", "LimitVol Phase 3 & 4 FLUCT")

dat_PRTreat
```

### Short selling activity

```{r shorttradermarket, echo = F}
eshortInf <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eshortUni <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eshort1Inf <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eshort1Uni <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eshort2Inf <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eshort2Uni <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eshort3Inf <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
eshort3Uni <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
tshortInf <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tshortUni <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tshort1Inf <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & IsREG == "REG")$shortsells, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & IsREG == "NOREG")$shortsells, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tshort1Uni <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & IsREG == "REG")$shortsells, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & IsREG == "NOREG")$shortsells, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tshort2Inf <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tshort2Uni <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tshort3Inf <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tshort3Uni <- format(round(t.test(shortsells ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader"), var.equal=T)$p.value, digits = 4), scientific = FALSE)

dat_short <- data.frame( c(eshortInf, tshortInf, eshortInf, tshortInf), c(eshort1Inf, tshort1Inf, eshort1Inf, tshort1Inf), c(eshort2Inf, tshort2Inf, eshort2Inf, tshort2Inf),  c(eshort3Inf, tshort3Inf, eshort3Inf, tshort3Inf)
                      )

dat_short <- t(dat_short)
colnames(dat_short) <- c("NOREG", "REG", "pvalues_Informed","NOREG", "REG", "pvalues_Uninformed")
row.names(dat_short) <- c("Short sells all phases", "Short sells Phases 1 & 2",  "Short sells Phase 3",  "Short sells Phase 4")

dat_short
```

```{r shortingtableAll, echo=F}
short3Uninf <- zeroinfl((shortsells_Uninformed) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>6 & Period<10))
short3Inf <- zeroinfl((shortsells_Informed) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>6 & Period<10))
short12Uninf <- zeroinfl((shortsells_Uninformed) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7))
short12Inf <- zeroinfl((shortsells_Informed) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7))
short4Uninf <- zeroinfl((shortsells_Uninformed) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>=10))
short4Inf <- zeroinfl((shortsells_Informed) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>=10))

short3 <- zeroinfl((shortsells) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>6 & Period<10))
short12 <- zeroinfl(shortsells ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7))
short4 <- zeroinfl(shortsells ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>=10))

short3Uninftest <- hurdletest(hurdle((shortsells_Uninformed) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period>6 & Period<10)))
short3Inftest <- hurdletest(hurdle((shortsells_Informed) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period>6 & Period<10)))
short12Uninftest <- hurdletest(hurdle((shortsells_Uninformed) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7)))
short12Inftest <- hurdletest(hurdle((shortsells_Informed) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7)))
short4Uninftest <- hurdletest(hurdle((shortsells_Uninformed) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period>=10)))
short4Inftest <- hurdletest(hurdle((shortsells_Informed) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period>=10)))

se_short3 <- coeftest(short3, vcov. = vcovCL(short3, cluster = ~ Group, type = "HC1"))
se_short12 <- coeftest(short12, vcov. = vcovCL(short12, cluster = ~ Group, type = "HC1"))
se_short4 <- coeftest(short4, vcov. = vcovCL(short4, cluster = ~ Group, type = "HC1"))

se_short3Uninf <- coeftest(short3Uninf, vcov. = vcovCL(short3Uninf, cluster = ~ Group, type = "HC1"))
se_short12Uninf <- coeftest(short12Uninf, vcov. = vcovCL(short12Uninf, cluster = ~ Group, type = "HC1"))
se_short4Uninf <- coeftest(short4Uninf, vcov. = vcovCL(short4Uninf, cluster = ~ Group, type = "HC1"))

se_short3Inf <- coeftest(short3Inf, vcov. = vcovCL(short3Inf, cluster = ~ Group, type = "HC1"))
se_short12Inf <- coeftest(short12Inf, vcov. = vcovCL(short12Inf, cluster = ~ Group, type = "HC1"))
se_short4Inf <- coeftest(short4Inf, vcov. = vcovCL(short4Inf, cluster = ~ Group, type = "HC1"))
```

```{r tableOA8, echo=F, results='asis'}
texreg(list(short12Inf, short3Inf, short4Inf, short12Uninf, short3Uninf, short4Uninf), custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"), 
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,   omit.coef = "(Session)|(subject)", 
       custom.model.names = c("Phases 1 and 2", "Phase 3", "Phase 4","Phases 1 and 2", "Phase 3", "Phase 4"),
       caption = "[Table OA8:] Zero-inflated negative binomial model of short sells by trader type and phase",
       label = "TableOA8", 
       override.se=list( c(se_short12Inf[1:7,2],NA,se_short12Inf[8:14,2]), c(se_short3Inf[1:7,2],NA,se_short3Inf[8:14,2]), c(se_short4Inf[1:7,2],NA,se_short4Inf[8:14,2]), c(se_short12Uninf[1:7,2],NA,se_short12Uninf[8:14,2]), c(se_short3Uninf[1:7,2],NA,se_short3Uninf[8:14,2]), c(se_short4Uninf[1:7,2],NA,se_short4Uninf[8:14,2])), override.p=list( c(se_short12Inf[1:7,4],NA,se_short12Inf[8:14,4]), c(se_short3Inf[1:7,4],NA,se_short3Inf[8:14,4]), c(se_short4Inf[1:7,4],NA,se_short4Inf[8:14,4]), c(se_short12Uninf[1:7,4],NA,se_short12Uninf[8:14,4]), c(se_short3Uninf[1:7,4],NA,se_short3Uninf[8:14,4]), c(se_short4Uninf[1:7,4],NA,se_short4Uninf[8:14,4])), 
       custom.gof.rows = list("Hurdle test p-value" = c(short12Inftest$`Pr(>Chisq)`[2], short3Inftest$`Pr(>Chisq)`[2], short4Inftest$`Pr(>Chisq)`[2], short12Uninftest$`Pr(>Chisq)`[2], short3Uninftest$`Pr(>Chisq)`[2], short4Uninftest$`Pr(>Chisq)`[2]), 
                              "$sum_i hat{f}_i(0)$" = c( round(sum(predict(short12Inf, type = "prob")[,1])),round(sum(predict(short3Inf, type = "prob")[,1])), round(sum(predict(short4Inf, type = "prob")[,1])), round(sum(predict(short12Uninf, type = "prob")[,1])),round(sum(predict(short3Uninf, type = "prob")[,1])), round(sum(predict(short4Uninf, type = "prob")[,1]))),
"$mu_i$" = c(round(predict(short12Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(short3Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(short4Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(short12Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(short3Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(short4Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2)),
       "$mu_i(BBV12.5)$" = c(round(predict(short12Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(short3Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(short4Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(short12Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(short3Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(short4Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2)),
       "$mu_i(BBV-12.5)$" = c(round(predict(short12Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(short3Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(short4Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(short12Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(short3Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(short4Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2))
       ))
```

### Margin buying activity

```{r margintradermarket, echo = F}
emarginInf <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
emarginUni <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
emargin1Inf <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
emargin1Uni <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
emargin2Inf <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
emargin2Uni <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
emargin3Inf <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
emargin3Uni <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
tmarginInf <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tmarginUni <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tmargin1Inf <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & IsREG == "REG")$marginbuys, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & IsREG == "NOREG")$marginbuys, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tmargin1Uni <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & IsREG == "REG")$marginbuys, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & IsREG == "NOREG")$marginbuys, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tmargin2Inf <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tmargin2Uni <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tmargin3Inf <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tmargin3Uni <- format(round(t.test(marginbuys ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader"), var.equal=T)$p.value, digits = 4), scientific = FALSE)

dat_margin <- data.frame( c(emarginInf, tmarginInf, emarginInf, tmarginInf), c(emargin1Inf, tmargin1Inf, emargin1Inf, tmargin1Inf), c(emargin2Inf, tmargin2Inf, emargin2Inf, tmargin2Inf),  c(emargin3Inf, tmargin3Inf, emargin3Inf, tmargin3Inf)
                      )

dat_margin <- t(dat_margin)
colnames(dat_margin) <- c("NOREG", "REG", "pvalues_Informed","NOREG", "REG", "pvalues_Uninformed")
row.names(dat_margin) <- c("Margin buys all phases", "Margin buys Phases 1 & 2", "Margin buys Phase 3", "Margin buys Phase 4")

dat_margin
```

```{r marginingtableAll, echo=F}
margin3Uninf <- zeroinfl((ceiling(marginbuys_Uninformed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>6 & Period<10))
margin3Inf <- zeroinfl((ceiling(marginbuys_Informed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>6 & Period<10))
margin12Uninf <- zeroinfl((ceiling(marginbuys_Uninformed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7))
margin12Inf <- zeroinfl((ceiling(marginbuys_Informed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7))
margin4Uninf <- zeroinfl((ceiling(marginbuys_Uninformed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>=10))
margin4Inf <- zeroinfl((ceiling(marginbuys_Informed)) ~  subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>=10))

margin3 <- zeroinfl((ceiling(marginbuys)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>6 & Period<10))
margin12 <- zeroinfl(ceiling(marginbuys) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7))
margin4 <- zeroinfl(ceiling(marginbuys) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>=10))

margin3Uninftest <- hurdletest(hurdle((ceiling(marginbuys_Uninformed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period>6 & Period<10)))
margin3Inftest <- hurdletest(hurdle((ceiling(marginbuys_Informed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period>6 & Period<10)))
margin12Uninftest <- hurdletest(hurdle((ceiling(marginbuys_Uninformed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7)))
margin12Inftest <- hurdletest(hurdle((ceiling(marginbuys_Informed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7)))
margin4Uninftest <- hurdletest(hurdle((ceiling(marginbuys_Uninformed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period>=10)))
margin4Inftest <- hurdletest(hurdle((ceiling(marginbuys_Informed)) ~  subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period>=10)))

se_margin3 <- coeftest(margin3, vcov. = vcovCL(margin3, cluster = ~ Group, type = "HC1"))
se_margin12 <- coeftest(margin12, vcov. = vcovCL(margin12, cluster = ~ Group, type = "HC1"))
se_margin4 <- coeftest(margin4, vcov. = vcovCL(margin4, cluster = ~ Group, type = "HC1"))

se_margin3Uninf <- coeftest(margin3Uninf, vcov. = vcovCL(margin3Uninf, cluster = ~ Group, type = "HC1"))
se_margin12Uninf <- coeftest(margin12Uninf, vcov. = vcovCL(margin12Uninf, cluster = ~ Group, type = "HC1"))
se_margin4Uninf <- coeftest(margin4Uninf, vcov. = vcovCL(margin4Uninf, cluster = ~ Group, type = "HC1"))

se_margin3Inf <- coeftest(margin3Inf, vcov. = vcovCL(margin3Inf, cluster = ~ Group, type = "HC1"))
se_margin12Inf <- coeftest(margin12Inf, vcov. = vcovCL(margin12Inf, cluster = ~ Group, type = "HC1"))
se_margin4Inf <- coeftest(margin4Inf, vcov. = vcovCL(margin4Inf, cluster = ~ Group, type = "HC1"))
```

```{r tableOA9, echo=F, results='asis'}
texreg(list(margin12Inf, margin3Inf, margin4Inf, margin12Uninf, margin3Uninf, margin4Uninf), custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"), 
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,   omit.coef = "(Session)|(subject)", 
       custom.model.names = c("Phases 1 and 2", "Phase 3", "Phase 4","Phases 1 and 2", "Phase 3", "Phase 4"),
       caption = "[Table OA9:] Zero-inflated negative binomial model of margin buys evaluated at bbv by trader type and phase",
       label = "TableOA9",
       override.se=list( c(se_margin12Inf[1:7,2],NA,se_margin12Inf[8:14,2]), c(se_margin3Inf[1:7,2],NA,se_margin3Inf[8:14,2]), c(se_margin4Inf[1:7,2],NA,se_margin4Inf[8:14,2]), c(se_margin12Uninf[1:7,2],NA,se_margin12Uninf[8:14,2]), c(se_margin3Uninf[1:7,2],NA,se_margin3Uninf[8:14,2]), c(se_margin4Uninf[1:7,2],NA,se_margin4Uninf[8:14,2])), override.p=list( c(se_margin12Inf[1:7,4],NA,se_margin12Inf[8:14,4]), c(se_margin3Inf[1:7,4],NA,se_margin3Inf[8:14,4]), c(se_margin4Inf[1:7,4],NA,se_margin4Inf[8:14,4]), c(se_margin12Uninf[1:7,4],NA,se_margin12Uninf[8:14,4]), c(se_margin3Uninf[1:7,4],NA,se_margin3Uninf[8:14,4]), c(se_margin4Uninf[1:7,4],NA,se_margin4Uninf[8:14,4])), 
       custom.gof.rows = list("Hurdle test p-value" = c(margin12Inftest$`Pr(>Chisq)`[2], margin3Inftest$`Pr(>Chisq)`[2], margin4Inftest$`Pr(>Chisq)`[2], margin12Uninftest$`Pr(>Chisq)`[2], margin3Uninftest$`Pr(>Chisq)`[2], margin4Uninftest$`Pr(>Chisq)`[2]), 
                              "$sum_i hat{f}_i(0)$" = c( round(sum(predict(margin12Inf, type = "prob")[,1])),round(sum(predict(margin3Inf, type = "prob")[,1])), round(sum(predict(margin4Inf, type = "prob")[,1])), round(sum(predict(margin12Uninf, type = "prob")[,1])),round(sum(predict(margin3Uninf, type = "prob")[,1])), round(sum(predict(margin4Uninf, type = "prob")[,1]))),
"$mu_i$" = c(round(predict(margin12Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(margin3Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(margin4Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(margin12Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(margin3Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(margin4Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2)),
       "$mu_i(BBV12.5)$" = c(round(predict(margin12Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(margin3Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(margin4Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(margin12Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(margin3Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(margin4Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2)),
       "$mu_i(BBV-12.5)$" = c(round(predict(margin12Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(margin3Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(margin4Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(margin12Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(margin3Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(margin4Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2))
       ))

```


```{r marginAssetingtableAll, echo=F, results = 'asis'}
marginAsset3Uninf <- zeroinfl((ceiling(marginbuysAsset_Uninformed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>6 & Period<10))
marginAsset3Inf <- zeroinfl((ceiling(marginbuysAsset_Informed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>6 & Period<10))
marginAsset12Uninf <- zeroinfl((ceiling(marginbuysAsset_Uninformed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7))
marginAsset12Inf <- zeroinfl((ceiling(marginbuysAsset_Informed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7))
marginAsset4Uninf <- zeroinfl((ceiling(marginbuysAsset_Uninformed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>=10))
marginAsset4Inf <- zeroinfl((ceiling(marginbuysAsset_Informed)) ~  subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>=10))

marginAsset3 <- zeroinfl((ceiling(marginbuysAsset)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>6 & Period<10))
marginAsset12 <- zeroinfl(ceiling(marginbuysAsset) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7))
marginAsset4 <- zeroinfl(ceiling(marginbuysAsset) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, dist = "negbin", data = subset(marketsummary, Period>=10))

se_marginAsset3 <- coeftest(marginAsset3, vcov. = vcovCL(marginAsset3, cluster = ~ Group, type = "HC1"))
se_marginAsset12 <- coeftest(marginAsset12, vcov. = vcovCL(marginAsset12, cluster = ~ Group, type = "HC1"))
se_marginAsset4 <- coeftest(marginAsset4, vcov. = vcovCL(marginAsset4, cluster = ~ Group, type = "HC1"))

se_marginAsset3Uninf <- coeftest(marginAsset3Uninf, vcov. = vcovCL(marginAsset3Uninf, cluster = ~ Group, type = "HC1"))
se_marginAsset12Uninf <- coeftest(marginAsset12Uninf, vcov. = vcovCL(marginAsset12Uninf, cluster = ~ Group, type = "HC1"))
se_marginAsset4Uninf <- coeftest(marginAsset4Uninf, vcov. = vcovCL(marginAsset4Uninf, cluster = ~ Group, type = "HC1"))

se_marginAsset3Inf <- coeftest(marginAsset3Inf, vcov. = vcovCL(marginAsset3Inf, cluster = ~ Group, type = "HC1"))
se_marginAsset12Inf <- coeftest(marginAsset12Inf, vcov. = vcovCL(marginAsset12Inf, cluster = ~ Group, type = "HC1"))
se_marginAsset4Inf <- coeftest(marginAsset4Inf, vcov. = vcovCL(marginAsset4Inf, cluster = ~ Group, type = "HC1"))

marginAsset3Uninftest <- hurdletest(hurdle((ceiling(marginbuysAsset_Uninformed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period>6 & Period<10)))
marginAsset3Inftest <- hurdletest(hurdle((ceiling(marginbuysAsset_Informed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period>6 & Period<10)))
marginAsset12Uninftest <- hurdletest(hurdle((ceiling(marginbuysAsset_Uninformed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7)))
marginAsset12Inftest <- hurdletest(hurdle((ceiling(marginbuysAsset_Informed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period > 0 & Period < 7)))
marginAsset4Uninftest <- hurdletest(hurdle((ceiling(marginbuysAsset_Uninformed)) ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period>=10)))
marginAsset4Inftest <- hurdletest(hurdle((ceiling(marginbuysAsset_Informed)) ~  subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0, zero.dist = "negbin", dist = "negbin", data = subset(marketsummary, Period>=10)))
```

```{r tableOA10, echo=F, results='asis'}
texreg(list(marginAsset12Inf, marginAsset3Inf, marginAsset4Inf, marginAsset12Uninf, marginAsset3Uninf, marginAsset4Uninf), custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"), 
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,   omit.coef = "(Session)|(subject)", 
       custom.model.names = c("Phases 1 and 2", "Phase 3", "Phase 4","Phases 1 and 2", "Phase 3", "Phase 4"),
       caption = "[Table OA10:] Zero-inflated negative binomial model of margin buys evaluated at the corresponding market price by trader type and phases", 
       label = "TableOA10",
       override.se=list( c(se_marginAsset12Inf[1:7,2],NA,se_marginAsset12Inf[8:14,2]), c(se_marginAsset3Inf[1:7,2],NA,se_marginAsset3Inf[8:14,2]), c(se_marginAsset4Inf[1:7,2],NA,se_marginAsset4Inf[8:14,2]), c(se_marginAsset12Uninf[1:7,2],NA,se_marginAsset12Uninf[8:14,2]), c(se_marginAsset3Uninf[1:7,2],NA,se_marginAsset3Uninf[8:14,2]), c(se_marginAsset4Uninf[1:7,2],NA,se_marginAsset4Uninf[8:14,2])), override.p=list( c(se_marginAsset12Inf[1:7,4],NA,se_marginAsset12Inf[8:14,4]), c(se_marginAsset3Inf[1:7,4],NA,se_marginAsset3Inf[8:14,4]), c(se_marginAsset4Inf[1:7,4],NA,se_marginAsset4Inf[8:14,4]), c(se_marginAsset12Uninf[1:7,4],NA,se_marginAsset12Uninf[8:14,4]), c(se_marginAsset3Uninf[1:7,4],NA,se_marginAsset3Uninf[8:14,4]), c(se_marginAsset4Uninf[1:7,4],NA,se_marginAsset4Uninf[8:14,4])), 
       custom.gof.rows = list("Hurdle test p-value" = c(marginAsset12Inftest$`Pr(>Chisq)`[2], marginAsset3Inftest$`Pr(>Chisq)`[2], marginAsset4Inftest$`Pr(>Chisq)`[2], marginAsset12Uninftest$`Pr(>Chisq)`[2], marginAsset3Uninftest$`Pr(>Chisq)`[2], marginAsset4Uninftest$`Pr(>Chisq)`[2]), 
                              "$sum_i hat{f}_i(0)$" = c( round(sum(predict(marginAsset12Inf, type = "prob")[,1])),round(sum(predict(marginAsset3Inf, type = "prob")[,1])), round(sum(predict(marginAsset4Inf, type = "prob")[,1])), round(sum(predict(marginAsset12Uninf, type = "prob")[,1])),round(sum(predict(marginAsset3Uninf, type = "prob")[,1])), round(sum(predict(marginAsset4Uninf, type = "prob")[,1]))),
"$mu_i$" = c(round(predict(marginAsset12Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(marginAsset3Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(marginAsset4Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(marginAsset12Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(marginAsset3Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2), round(predict(marginAsset4Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 0, Period0 = 0)), 2)),

       "$mu_i(BBV12.5)$" = c(round(predict(marginAsset12Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(marginAsset3Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(marginAsset4Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(marginAsset12Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(marginAsset3Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2), round(predict(marginAsset4Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = 12.5, Period0 = 0)), 2)),
       "$mu_i(BBV-12.5)$" = c(round(predict(marginAsset12Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(marginAsset3Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(marginAsset4Inf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(marginAsset12Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(marginAsset3Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2), round(predict(marginAsset4Uninf, type = "response", newdata = data.frame(subTreatment = "FLUCT", regime_order = "NR", IsREG = "NOREG", BBVCent = -12.5, Period0 = 0)), 2))
       ))
```

**************************************************************************************
\newpage

## Market quality

### Deviations 

\begin{equation}
\begin{split}
RD = & \frac{\sum Volume_i (Price_i-BBV)}{BBV\sum Volume_i} = \frac{\sum Volume_i Price_i}{BBV\sum Volume_i}-1\\
RAD = & \frac{\sum Volume_i |Price_i-BBV|}{BBV\sum Volume_i}\\
GD_{Market}
= & \exp\left(\frac{1}{Vol}\sum_{j=1}^{\#TRA_{m}} \ln\left(\frac{P_j}{BBV}\right)\cdot Vol_j\right)-1\\
GAD_{Market}
=  & \exp\left(\frac{1}{Vol}\sum_{j=1}^{\#TRA_{m}} \left\lvert \ln\left(\frac{P_j}{BBV}\right)\right\rvert\cdot Vol_j\right)-1
\end{split}
\end{equation}


```{r GDtable, echo=F, results = 'asis'}
# mixed models
GD3 <- lmer(GD*100 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>6 & Period<10))
GD12 <- lmer(GD*100 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0 & Period <7))
GD4 <- lmer(GD*100 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>=10 ))

GDall <- lmer(GD*100 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0))

GAD3 <- lmer(GAD*100 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>6 & Period<10))
GAD12 <- lmer(GAD*100 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0 & Period <7))
GAD4 <- lmer(GAD*100 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>=10 ))

GADall <- lmer(GAD*100 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0))
```

```{r tableOA11, echo=F, results='asis'}
texreg(list(GD12, GD3, GD4, GAD12, GAD3, GAD4 ), custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"), 
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,   omit.coef = "(Session)|(subject)", 
       custom.model.names = c("Phases 1 and 2", "Phase 3", "Phase 4", "Phases 1 and 2", "Phase 3", "Phase 4"),
       caption = "[Table OA11:] Mixed effects regressions of measures for the informational efficiency of prices (‘GD’, ‘GAD’) by phase.",
       label = "TableOA11")
```


\begin{align} \label{eq:GADratio}
    \mathit{Efficiency}=\frac{\emph{GAD}^U-\emph{GAD}^A}{\emph{GAD}^U}
\end{align}

```{r tableEfficiency, echo = F}
sGADfv <- aggregate(cbind(transactionVol, abs(log(57.5/BBV))*transactionVol) ~ Group + BBV + Period + IsREG + subTreatment, data = transactions, function(x) sum(x, na.rm = T), na.action = na.pass)

sGADfv$GADhyp <- exp(1/sGADfv$transactionVol*sGADfv$V2)-1
sGADfv <- merge(sGADfv, subset(marketsummary, select = c(GAD, Group, Period)), by = c("Group", "Period"))
sGADfv$rGAD <- 1-sGADfv$GAD/sGADfv$GADhyp
#quantile(sGADfv$rGAD, probs = .3)
sGADfv$lnrGAD <- log(sGADfv$rGAD+1)
#ecdf(x = sGADfv$BBV)(57.5+8)-ecdf(sGADfv$BBV)(57.5-8)
da <- 57.5+5.5
db <- 57.5-5.5

sGADfv$dGAD <- sGADfv$GADhyp-sGADfv$GAD

trGAD <- t.test(rGAD ~ IsREG, data = subset(marketsummary, (BBV <= db | BBV >= da) & subTreatment == "FIXED"), var.equal = T)
trGAD1 <- t.test(rGAD ~ IsREG, data = subset(marketsummary, Period > 0 & Period < 7 & (BBV <= db | BBV >= da) & subTreatment == "FIXED"), var.equal = T) #not paired because of different BBV
trGAD1s <- t.test(subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FIXED" & IsREG == "REG")$rGAD, subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FIXED" & IsREG == "NOREG")$rGAD, var.equal = T, paired = T)
trGAD2 <- t.test(rGAD ~ IsREG, data = subset(marketsummary, Period > 6 & Period < 10 & (BBV <= db | BBV >= da) & subTreatment == "FIXED"), var.equal = T)
trGAD3 <- t.test(rGAD ~ IsREG, data = subset(marketsummary, Period >=10 & (BBV <= db | BBV >= da) & subTreatment == "FIXED"), var.equal = T)

t.test(dGAD ~ IsREG, data = subset(sGADfv, (Period <= 3 | Period >= 10)), var.equal = T)
#t.test(dGAD ~ IsREG, data = subset(sGADfv, Period > 6 & Period < 10), var.equal = T)
#t.test(dGAD ~ IsREG, data = subset(sGADfv), var.equal = T)

tGAD <- t.test(GAD ~ IsREG, data = subset(marketsummary, Period > 0 & subTreatment == "FIXED"), var.equal = T)
tGAD1 <- t.test(GAD ~ IsREG, data = subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FIXED"), var.equal = T)
tGAD1s <- t.test(subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FIXED" & IsREG == "REG")$GAD, subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FIXED" & IsREG == "NOREG")$GAD, var.equal = T, paired = T)
tGAD2 <- t.test(GAD ~ IsREG, data = subset(marketsummary, Period > 6 & Period < 10 & subTreatment == "FIXED"), var.equal = T)
tGAD3 <- t.test(GAD ~ IsREG, data = subset(marketsummary, Period >= 10 & subTreatment == "FIXED"), var.equal = T)

dat_GAD2 <- data.frame(c(tGAD$estimate, tGAD$p.value, trGAD$estimate, trGAD$p.value), c(tGAD1$estimate, tGAD1$p.value, trGAD1$estimate, trGAD1$p.value), c(tGAD2$estimate, tGAD2$p.value, trGAD2$estimate, trGAD2$p.value), c(tGAD3$estimate, tGAD3$p.value, trGAD3$estimate, trGAD3$p.value))
dat_GAD2 <- t(dat_GAD2)
colnames(dat_GAD2) <- c("NOREG", "REG", "pvalues_GADA",  "NOREG", "REG", "pvalues_Efficiency")
row.names(dat_GAD2) <- c("all phases", "Phases 1 & 2",  "Phase 3",  "Phase 4")

format(dat_GAD2, digits = 3, scientific = 5)

trGAD <- t.test(rGAD ~ IsREG, data = subset(marketsummary, (BBV <= db | BBV >= da) & subTreatment == "FLUCT"), var.equal = T)
trGAD1 <- t.test(rGAD ~ IsREG, data = subset(marketsummary, Period > 0 & Period < 7 & (BBV <= db | BBV >= da) & subTreatment == "FLUCT"), var.equal = T) #not paired because of different BBV
trGAD1s <- t.test(subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FLUCT" & IsREG == "REG")$rGAD, subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FLUCT" & IsREG == "NOREG")$rGAD, var.equal = T, paired = T)
trGAD2 <- t.test(rGAD ~ IsREG, data = subset(marketsummary, Period > 6 & Period < 10 & (BBV <= db | BBV >= da) & subTreatment == "FLUCT"), var.equal = T)
trGAD3 <- t.test(rGAD ~ IsREG, data = subset(marketsummary, Period >=10 & (BBV <= db | BBV >= da) & subTreatment == "FLUCT"), var.equal = T)

#t
tGAD <- t.test(GAD ~ IsREG, data = subset(marketsummary, Period > 0 & subTreatment == "FLUCT"), var.equal = T)
tGAD1 <- t.test(GAD ~ IsREG, data = subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FLUCT"), var.equal = T)
tGAD1s <- t.test(subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FLUCT" & IsREG == "REG")$GAD, subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FLUCT" & IsREG == "NOREG")$GAD, var.equal = T, paired = T)
tGAD2 <- t.test(GAD ~ IsREG, data = subset(marketsummary, Period > 6 & Period < 10 & subTreatment == "FLUCT"), var.equal = T)
tGAD3 <- t.test(GAD ~ IsREG, data = subset(marketsummary, Period >= 10 & subTreatment == "FLUCT"), var.equal = T)

dat_GAD2 <- data.frame(c(tGAD$estimate, tGAD$p.value, trGAD$estimate, trGAD$p.value), c(tGAD1$estimate, tGAD1$p.value, trGAD1$estimate, trGAD1$p.value), c(tGAD2$estimate, tGAD2$p.value, trGAD2$estimate, trGAD2$p.value), c(tGAD3$estimate, tGAD3$p.value, trGAD3$estimate, trGAD3$p.value))
dat_GAD2 <- t(dat_GAD2)
colnames(dat_GAD2) <- c("NOREG", "REG", "pvalues_GADA",  "NOREG", "REG", "pvalues_Efficiency")
row.names(dat_GAD2) <- c("all phases", "Phases 1 & 2",  "Phase 3",  "Phase 4")

format(dat_GAD2, digits = 3, scientific = 5)

sGADfv120 <- aggregate(cbind(transactionVol, abs(log(57.5/BBV))*transactionVol) ~ Group + BBV + Period + IsREG, data = subset(transactions, time >=120), function(x) sum(x, na.rm = T), na.action = na.pass)
sGADfv120 <- merge(sGADfv120,subset(sGADfv, select = c("Group", "BBV", "Period", "IsREG")),  by = c("Group", "BBV", "Period", "IsREG"), all = T)
sGADfv120$Volume[is.na(sGADfv120$transactionVol)] <- 0
sGADfv120$V2[is.na(sGADfv120$V2)] <- 0
sGADfv120$GADhyp120 <- exp(1/sGADfv120$Volume*sGADfv120$V2)-1
sGADfv120$GADhyp120[is.na(sGADfv120$GADhyp120)] <- 57.5/sGADfv120$BBV[is.na(sGADfv120$GADhyp120)]-1
sGADfv120 <- merge(sGADfv120, subset(marketsummary, select = c(GAD120, Group, Period)), by = c("Group", "Period"), all = T)
sGADfv120$GAD120[is.na(sGADfv120$GAD120)] <- 0
sGADfv120$rGAD120 <- 1-sGADfv120$GAD120/sGADfv120$GADhyp120
#quantile(sGADfv120$rGAD120, probs = .3)
sGADfv120$lnrGAD120 <- log(sGADfv120$rGAD120+1)
#ecdf(x = sGADfv120$BBV)(57.5+8)-ecdf(sGADfv120$BBV)(57.5-8)
da <- 57.5+5.5
db <- 57.5-5.5

sGADfv120$dGAD120 <- sGADfv120$GADhyp120-sGADfv120$GAD120

trGAD <- t.test(rGAD120 ~ IsREG, data = subset(marketsummary, (BBV <= db | BBV >= da) & subTreatment == "FIXED"), var.equal = T)
trGAD1 <- t.test(rGAD120 ~ IsREG, data = subset(marketsummary, Period > 0 & Period < 7 & (BBV <= db | BBV >= da) & subTreatment == "FIXED"), var.equal = T) #not paired because of different BBV
trGAD1s <- t.test(subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FIXED" & IsREG == "REG")$rGAD120, subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FIXED" & IsREG == "NOREG")$rGAD120, var.equal = T, paired = T)
trGAD2 <- t.test(rGAD120 ~ IsREG, data = subset(marketsummary, Period > 6 & Period < 10 & (BBV <= db | BBV >= da) & subTreatment == "FIXED"), var.equal = T)
trGAD3 <- t.test(rGAD120 ~ IsREG, data = subset(marketsummary, Period >=10 & (BBV <= db | BBV >= da) & subTreatment == "FIXED"), var.equal = T)

t.test(dGAD ~ IsREG, data = subset(sGADfv, (Period <= 3 | Period >= 10)), var.equal = T)

tGAD <- t.test(GAD120 ~ IsREG, data = subset(marketsummary, Period > 0 & subTreatment == "FIXED"), var.equal = T)
tGAD1 <- t.test(GAD120 ~ IsREG, data = subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FIXED"), var.equal = T)
tGAD1s <- t.test(subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FIXED" & IsREG == "REG")$GAD120, subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FIXED" & IsREG == "NOREG")$GAD120, var.equal = T, paired = T)
tGAD2 <- t.test(GAD120 ~ IsREG, data = subset(marketsummary, Period > 6 & Period < 10 & subTreatment == "FIXED"), var.equal = T)
tGAD3 <- t.test(GAD120 ~ IsREG, data = subset(marketsummary, Period >= 10 & subTreatment == "FIXED"), var.equal = T)

dat_GAD2 <- data.frame(c(tGAD$estimate, tGAD$p.value, trGAD$estimate, trGAD$p.value), c(tGAD1$estimate, tGAD1$p.value, trGAD1$estimate, trGAD1$p.value), c(tGAD2$estimate, tGAD2$p.value, trGAD2$estimate, trGAD2$p.value), c(tGAD3$estimate, tGAD3$p.value, trGAD3$estimate, trGAD3$p.value))
dat_GAD2 <- t(dat_GAD2)
colnames(dat_GAD2) <- c("NOREG", "REG", "pvalues_GADA",  "NOREG", "REG", "pvalues_Efficiency")
row.names(dat_GAD2) <- c("all phases", "Phases 1 & 2",  "Phase 3",  "Phase 4")

format(dat_GAD2, digits = 3, scientific = 5)


trGAD <- t.test(rGAD120 ~ IsREG, data = subset(marketsummary, (BBV <= db | BBV >= da) & subTreatment == "FLUCT"), var.equal = T)
trGAD1 <- t.test(rGAD120 ~ IsREG, data = subset(marketsummary, Period > 0 & Period < 7 & (BBV <= db | BBV >= da) & subTreatment == "FLUCT"), var.equal = T) #not paired because of different BBV
trGAD1s <- t.test(subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FLUCT" & IsREG == "REG")$rGAD120, subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FLUCT" & IsREG == "NOREG")$rGAD120, var.equal = T, paired = T)
trGAD2 <- t.test(rGAD120 ~ IsREG, data = subset(marketsummary, Period > 6 & Period < 10 & (BBV <= db | BBV >= da) & subTreatment == "FLUCT"), var.equal = T)
trGAD3 <- t.test(rGAD120 ~ IsREG, data = subset(marketsummary, Period >=10 & (BBV <= db | BBV >= da) & subTreatment == "FLUCT"), var.equal = T)

#t
tGAD <- t.test(GAD120 ~ IsREG, data = subset(marketsummary, Period > 0 & subTreatment == "FLUCT"), var.equal = T)
tGAD1 <- t.test(GAD120 ~ IsREG, data = subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FLUCT"), var.equal = T)
tGAD1s <- t.test(subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FLUCT" & IsREG == "REG")$GAD120, subset(marketsummary, Period > 0 & Period < 7 & subTreatment == "FLUCT" & IsREG == "NOREG")$GAD120, var.equal = T, paired = T)
tGAD2 <- t.test(GAD120 ~ IsREG, data = subset(marketsummary, Period > 6 & Period < 10 & subTreatment == "FLUCT"), var.equal = T)
tGAD3 <- t.test(GAD120 ~ IsREG, data = subset(marketsummary, Period >= 10 & subTreatment == "FLUCT"), var.equal = T)

dat_GAD2 <- data.frame(c(tGAD$estimate, tGAD$p.value, trGAD$estimate, trGAD$p.value), c(tGAD1$estimate, tGAD1$p.value, trGAD1$estimate, trGAD1$p.value), c(tGAD2$estimate, tGAD2$p.value, trGAD2$estimate, trGAD2$p.value), c(tGAD3$estimate, tGAD3$p.value, trGAD3$estimate, trGAD3$p.value))
dat_GAD2 <- t(dat_GAD2)
colnames(dat_GAD2) <- c("NOREG", "REG", "pvalues_GADA",  "NOREG", "REG", "pvalues_Efficiency")
row.names(dat_GAD2) <- c("all phases", "Phases 1 & 2",  "Phase 3",  "Phase 4")

format(dat_GAD2, digits = 3, scientific = 5)

```


### Bid-Ask spread 

\begin{equation}
BA spread = BestAsk-BestBid
\end{equation}

The Bid-Ask spread is analysed via the per second observation of the Bid and Ask prices.


```{r lmBAspreadtable, echo=F, results = 'asis'}
# mixed models
BAspreadwins_3 <- lmer(meanBAspreadwins2 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>6 & Period<10))
BAspreadwins_12 <- lmer(meanBAspreadwins2 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0 & Period <7))
BAspreadwins_4 <- lmer(meanBAspreadwins2 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>=10))
BAspreadwins_all <- lmer(meanBAspreadwins2 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0))

volatility_3 <- lmer(volatility ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>6 & Period<10))
volatility_12 <- lmer(volatility ~   subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0 & Period <7))
volatility_4 <- lmer(volatility ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>=10))
volatility_all <- lmer(volatility ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0))


volatilitywins_3 <- lmer(volatilitywins2 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>6 & Period<10))
volatilitywins_12 <- lmer(volatilitywins2 ~ + subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0 & Period <7))
volatilitywins_4 <- lmer(volatilitywins2 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period>=10))
volatilitywins_all <- lmer(volatilitywins2 ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1 | Group), data = subset(marketsummary, Period > 0))
```

```{r tableOA12, echo=F, results='asis'}
texreg(list(BAspreadwins_12, BAspreadwins_3, BAspreadwins_4, volatility_12, volatility_3, volatility_4), custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"), 
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE,   omit.coef = "(Session)|(subject)", 
       custom.model.names = c("Phases 1 and 2", "Phase 3", "Phase 4", "Phases 1 and 2", "Phase 3", "Phase 4"),
       caption = "[Table OA12:] Mixed effect regressions of ‘Spread’ and ‘Volatility’ by phase.", 
       label = "TableOA12")

```

```{r ba graph2,echo=F ,fig.cap="BA-spread over time"}
seconds$Group2 <- as.factor(seconds$Group)

data <- subset(seconds, Period > 0)
fbam3 <- gam(BAspreadwins2 ~ 0 + s(time, k = 20, by = interaction(IsREG, subTreatment, (Period>0 & Period<7))) + BBVCent + abs(BBVCent) + IsREG + subTreatment + regime_order + Period0 + s(Group2, bs = 're'), data = data)
p.bash2 <- visreg(fbam3, type = "conditional", scale='response', xvar="time", line.par = list(col = 'red'), cond = list(Group2=5, IsREG="REG", Period0 = 4, Period = 5, regime_order = "NR", subTreatment = "FIXED"), plot=FALSE)
p.bansh2 <- visreg(fbam3, type = "conditional", scale='response', xvar="time", line.par = list(col = 'red'), cond = list(Group2=5, IsREG="NOREG", Period0 = 4, Period = 5, regime_order = "NR", subTreatment = "FIXED"), plot=FALSE)
dplyr::bind_rows(
  dplyr::mutate(p.bash2$fit, group = "REG"),
  dplyr::mutate(p.bansh2$fit, group = "NOREG")
)-> fitbash2

#postscript("Figures/GraphBAspread1.eps")
ggplot(data = fitbash2) +
  geom_ribbon(aes(time, ymin=visregLwr, ymax=visregUpr, group=group), fill="gray90") +
  geom_line(aes(time, visregFit, group=group, color=group)) +
  theme_bw() +
  scale_x_continuous(limits = c(-5,185),breaks=c(0,30,60,90,120,150,180)) +
  labs(colour = " ") + ylab("Spread") + xlab('Time(s)') + ylim(-2,NA)  +
  scale_color_manual( values = c("NOREG" = rgb(.46, .76, .88), "REG" = rgb(0,.29,.51))) +
  theme(#text = element_text(size = 18), # used in paper but not in Rmarkdown output
        axis.text.y.right = element_text(color = "darkgrey"), axis.title.y.right = element_text(color = "darkgrey"), legend.position = "bottom")
#dev.off()
```

*****************************************************************
\newpage

## Trader profits

```{r allsubjectsREG, echo=F, results='markup'}
table <- lapply( c(subset(subjects, Subject!=11 & Role=="Informed trader")["ProfitPeriod"], subset(tradersummary, Role=="Informed trader" & IsREG=="REG")["ProfitPeriod"], subset(tradersummary, Role=="Informed trader" & IsREG=="NOREG")["ProfitPeriod"], subset(subjects, Subject!=11 & Role=="Uninformed trader")["ProfitPeriod"], subset(tradersummary, Role=="Uninformed trader"& IsREG=="REG")["ProfitPeriod"], subset(tradersummary, Role=="Uninformed trader"& IsREG=="NOREG")["ProfitPeriod"]), function(x) rbind( mean = mean(x),
                                         sd = sd(x) ,
                                         median = median(x) ,
                                         minimum = min(x) ,
                                         maximum = max(x) ,
                                         n = length(x) ) )
names(table) <- c("Informed trader", "Informed trader-REG", "Informed trader-NOREG", "Uninformed trader", "Uninformed trader_REG", "Uninformed trader_NOREG")
data.frame(table)
```

### Gross trading profits

\begin{align}
    (\sum Vol_{j})\pi^{Before}=\cdot\frac{\sum\limits_{j}\theta_j\cdot\left(P_j-BBV\right)\cdot Vol_j}{W_{t=0}},
\end{align}

\begin{align}
    (\sum Vol_{j})\pi^{After\,redistribution}=\pi^{Before}+\cdot\frac{Redist}{W_{t=0}},
\end{align}

\begin{align}
    (\sum Vol_{j})\pi^{After\, punishment}=\pi^{After\,redistribution}-\cdot\frac{Pen}{W_{t=0}},
\end{align}

```{r TP graph, echo=F}
tPDbeforeInfX <- format(round(t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeUniX <- format(round(t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbefore1InfX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "REG")$PDbefore, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$PDbefore, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDbefore1UniX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "REG")$PDbefore, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$PDbefore, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDbefore2InfX <- format(round(t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbefore2UniX <- format(round(t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbefore3InfX <- format(round(t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbefore3UniX <- format(round(t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunInfX <- format(round(t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunUniX <- format(round(t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPun1InfX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "REG")$PDPun, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$PDPun, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDPun1UniX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "REG")$PDPun, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$PDPun, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDPun2InfX <- format(round(t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPun2UniX <- format(round(t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPun3InfX <- format(round(t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPun3UniX <- format(round(t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)

tPDbeforeInfU <- format(round(t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeUniU <- format(round(t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbefore1InfU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "REG")$PDbefore, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$PDbefore, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDbefore1UniU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "REG")$PDbefore, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$PDbefore, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDbefore2InfU <- format(round(t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbefore2UniU <- format(round(t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbefore3InfU <- format(round(t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbefore3UniU <- format(round(t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunInfU <- format(round(t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunUniU <- format(round(t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPun1InfU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "REG")$PDPun, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$PDPun, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDPun1UniU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "REG")$PDPun, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$PDPun, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDPun2InfU <- format(round(t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPun2UniU <- format(round(t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPun3InfU <- format(round(t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPun3UniU <- format(round(t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)

ePDbeforeInfX <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeUniX <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbefore1InfX <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbefore1UniX <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbefore2InfX <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbefore2UniX <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbefore3InfX <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbefore3UniX <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunInfX <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunUniX <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPun1InfX <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPun1UniX <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPun2InfX <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPun2UniX <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPun3InfX <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPun3UniX <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)

ePDbeforeInfU <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeUniU <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbefore1InfU <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbefore1UniU <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbefore2InfU <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbefore2UniU <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbefore3InfU <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbefore3UniU <- format(round(t.test(PDbefore*100 ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunInfU <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunUniU <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPun1InfU <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPun1UniU <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPun2InfU <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPun2UniU <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPun3InfU <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPun3UniU <- format(round(t.test(PDPun*100 ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)

dat_textPD <- data.frame(
  label = c(paste0("p = ",tPDbefore1InfU,""), paste0("p = ",tPDbefore1UniU,""), paste0("p = ",tPDbefore2InfU,""), paste0("p = ",tPDbefore2UniU,""), paste0("p = ",tPDbefore3InfU,""),paste0("p = ",tPDbefore3UniU,""),paste0("p = ",tPDPun1InfU,""),paste0("p = ",tPDPun1UniU,""),paste0("p = ",tPDPun2InfU,""),paste0("p = ",tPDPun2UniU,""),paste0("p = ",tPDPun3InfU,""),paste0("p = ",tPDPun3UniU,""), paste0("p = ",tPDbefore1InfX,""), paste0("p = ",tPDbefore1UniX,""), paste0("p = ",tPDbefore2InfX,""), paste0("p = ",tPDbefore2UniX,""), paste0("p = ",tPDbefore3InfX,""), paste0("p = ",tPDbefore3UniX,""),paste0("p = ",tPDPun1InfX,""),paste0("p = ",tPDPun1UniX,""),paste0("p = ",tPDPun2InfX,""),paste0("p = ",tPDPun2UniX,""),paste0("p = ",tPDPun3InfX,""),paste0("p = ",tPDPun3UniX,"")),
  IsREG   = c("REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG"),
  Role = c("Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders"),
  Phase = c("Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4", "Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4", "Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4", "Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4"),
  group = c("PDbefore","PDbefore","PDbefore", "PDbefore", "PDbefore", "PDbefore", "REG.PDPun", "REG.PDPun", "REG.PDPun","REG.PDPun","REG.PDPun","REG.PDPun", "PDbefore","PDbefore","PDbefore", "PDbefore", "PDbefore", "PDbefore", "REG.PDPun", "REG.PDPun", "REG.PDPun","REG.PDPun","REG.PDPun","REG.PDPun"),
  Variable = c("PDbefore","PDbefore","PDbefore", "PDbefore", "PDbefore", "PDbefore", "PDPun", "PDPun", "PDPun","PDPun","PDPun","PDPun", "PDbefore","PDbefore","PDbefore", "PDbefore", "PDbefore", "PDbefore", "PDPun", "PDPun", "PDPun","PDPun","PDPun","PDPun"),
  subTreatment = c("FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED"),
  vjust = c(0,0,0,0,0,0,1,1,1,1,1,1, 0,0,0,0,0,0,1,1,1,1,1,1)
)

avgtraderPhaseTreatsummary2$group <- interaction(avgtraderPhaseTreatsummary2$IsREG, avgtraderPhaseTreatsummary2$variable)
avgtraderPhaseTreatsummary2$group <- factor(avgtraderPhaseTreatsummary2$group, levels = c("NOREG.PDbefore", "REG.PDbefore", "REG.PDPun", "NOREG.PDbeforeVol", "REG.PDbeforeVol", "REG.PDPunVol"))
avgtraderPhaseTreatsummary2$Phase <- factor(avgtraderPhaseTreatsummary2$Phase, levels = c("Phases 1 & 2", "Phase 3", "Phase 4"))
```

```{r FigureOA7, echo=F, fig.cap="[Figure OA7:] Mean gross trading profits per trader by treatment, regulatory regime, trader type, and phase."}
#postscript("Figures/xxx_FigureOA7_PD.eps")
ggplot(data=subset(avgtraderPhaseTreatsummary2, variable == "PDbefore" | ( IsREG != "NOREG" & variable =="PDPun")), aes(y= value*100, x= Role, group = group, fill = group, color = group)) +
  geom_bar(stat="identity", position = position_dodge(width = 0.7)#, size = 2 # used in paper but not in Rmarkdown output
           )+ 
  labs(y="") +
  geom_text(data = subset(dat_textPD[1:6,]), mapping = aes(x = Role, y = -4.3 - .7*vjust, label = label), col = "black", size = 2 #, size = 4 # used in paper but not in Rmarkdown output
            ) +
  geom_text(data = subset(dat_textPD[7:12,]), mapping = aes(x = Role, y = -4.3 - .7*vjust, label = label), col = "orange", size = 2 #, size = 4 # used in paper but not in Rmarkdown output
            ) +
  geom_text(data = subset(dat_textPD[13:18,]), mapping = aes(x = Role, y = -4.3 - .7*vjust, label = label), col = "black", size = 2 #, size = 4 # used in paper but not in Rmarkdown output
            ) +
  geom_text(data = subset(dat_textPD[19:24,]), mapping = aes(x = Role, y = -4.3 - .7*vjust, label = label), col = "orange", size = 2 #, size = 4 # used in paper but not in Rmarkdown output
            ) +
  geom_errorbar(aes(ymin = dol*100, ymax = upl*100), width=.2, color = 'black', size = .7, position=position_dodge(width=0.7)) +
  theme(#text = element_text(size=18), # used in paper but not in Rmarkdown output
        axis.title.x=element_blank(),legend.title = element_blank(), legend.position = "bottom", legend.direction = "horizontal", panel.grid.major.y = element_line(colour = "lightgrey"), panel.background = element_rect(fill = "transparent"),  plot.background = element_rect(fill = "transparent")) +
  facet_grid(factor(subTreatment, levels = c("FLUCT", "FIXED")) ~ factor(Phase), scales = "fixed") +
    scale_y_continuous( breaks = seq(-4, 6, by = 2)) +
  scale_color_manual(name = "Regime - Punishment", values = c("REG.PDbefore" = "transparent", "NOREG.PDbefore" = "transparent", "REG.PDPun" = "orange"), breaks = c("NOREG.PDbefore", "REG.PDbefore", "REG.PDPun"), labels = c("NOREG", "REG - before punishment", "REG - after punishment")) +
  scale_fill_manual(name = "Regime - Punishment", values = c("NOREG.PDbefore" = rgb(.46, .76, .88), "REG.PDPun" = rgb(0,.29,.51), "REG.PDbefore" = rgb(0,.29,.51)), breaks = c("NOREG.PDbefore", "REG.PDbefore", "REG.PDPun"), labels = c("NOREG", "REG - before punishment", "REG - after punishment"))
#dev.off()
```

Test trader profits before redistribution between regulatory regimes for informed traders in both treatments and in all phases reported in the Online Appendix in Section 3.3
```{r }
t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" ), var.equal=T)
```

Test trader profits after redistribution and penalty payments between regulatory regimes for informed traders in both treatments and in all phases reported in the Online Appendix in Section 3.3
```{r }
t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" ), var.equal=T)
```

Test trader profits after redistribution and penalty payments between trader types in NOREG in both treatments and in all phases reported in the Online Appendix in Section 3.3
```{r }
t.test(PDPun ~ Role, data=subset(tradersummary, Period>0 & IsREG=="NOREG" ), var.equal=T)
```

Test trader profits after redistribution and penalty payments between trader types in REG in both treatments and in all phases reported in the Online Appendix in Section 3.3
```{r }
t.test(PDPun ~ Role, data=subset(tradersummary, Period>0 & IsREG=="REG" ), var.equal=T)
```

Test trader profits before redistribution between regulatory regimes for uninformed traders in both treatments and in all phases reported in the Online Appendix in Section 3.3
```{r }
t.test(PDbefore ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" ), var.equal=T)
```

Test trader profits after redistribution and penalty payments between regulatory regimes for uninformed traders in both treatments and in all phases reported in the Online Appendix in Section 3.3
```{r }
t.test(PDPun ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" ), var.equal=T)
```

```{r rankPD, echo = F}
tradersummary$rankavgPDbeforeRole2 <- tradersummary$rankavgPDbeforeRole
tradersummary$rankavgPDbeforeRole2[tradersummary$subTreatment == "FLUCT"] <- tradersummary$rankavgPDbeforeRole[tradersummary$subTreatment == "FLUCT"] / 3
tradersummary$rankavgPDbeforeRole2[tradersummary$ExpectedRole == "Uninformed trader"] <- tradersummary$rankavgPDbeforeRole[tradersummary$ExpectedRole == "Uninformed trader"] / 2
avgtraderphasesummaryRank <- aggregate(cbind(Volume, LimitVolume, TradingProfit, TPUnits, TPUnitsPun, ProfitPeriod, (Volume > 0 | LimitVolume > 0), PDbefore, PDPun, PDRedist, PDbeforeVol, PDPunVol, PDRedistVol, PDbefore*as.numeric(PDbefore>0), PDPun*as.numeric(PDPun>0), PDRedist*as.numeric(PDRedist>0), PDbefore*as.numeric(PDbefore<0), PDPun*as.numeric(PDPun<0), PDRedist*as.numeric(PDRedist<0), shortsells, marginbuys, marginbuysAsset) ~ Role + ceiling(rankavgPDbeforeRole2) + Phase + IsREG + subTreatment, data=tradersummary, function(x) mean(x, na.rm = T), na.action = na.pass)
colnames(avgtraderphasesummaryRank)[colnames(avgtraderphasesummaryRank) == "V7"] <- "PR"
colnames(avgtraderphasesummaryRank)[2] <- "rank"
avgtraderphasesummaryRank2 <- reshape2::melt(subset(avgtraderphasesummaryRank), id.vars = c("Phase", "IsREG", "subTreatment", "Role", "rank"))
avgtraderphasesummaryRankul <- aggregate(cbind(Volume, LimitVolume, TradingProfit, TPUnits, TPUnitsPun, ProfitPeriod, (Volume > 0 | LimitVolume > 0), PDbefore, PDPun, PDRedist, PDbeforeVol, PDPunVol, PDRedistVol, PDbefore*as.numeric(PDbefore>0), PDPun*as.numeric(PDPun>0), PDRedist*as.numeric(PDRedist>0), PDbefore*as.numeric(PDbefore<0), PDPun*as.numeric(PDPun<0), PDRedist*as.numeric(PDRedist<0), shortsells, marginbuys, marginbuysAsset) ~ Role + ceiling(rankavgPDbeforeRole2) + Phase + IsREG + subTreatment, data=tradersummary, function(x) quantile(x, probs = 0.975))
colnames(avgtraderphasesummaryRankul) <- c("Role", "rank", "Phase","IsREG", "subTreatment", "ulVolume", "ulLimitVolume", "ulTradingProfit", "ulTPUnits", "ulTPUnitsPun", "ulProfitPeriod", "ulPR", "ulPDbefore", "ulPDPun", "ulPDRedist", "ulPDbeforeVol", "ulPDPunVol", "ulPDRedistVol", "ulV14", "ulV15", "ulV16", "ulV17", "ulV18", "ulV19", "ulshortsells", "ulmarginbuys", "ulmarginbuysAsset")
avgtraderphasesummaryRankll <- aggregate(cbind(Volume, LimitVolume, TradingProfit, TPUnits, TPUnitsPun, ProfitPeriod, (Volume > 0 | LimitVolume > 0), PDbefore, PDPun, PDRedist, PDbeforeVol, PDPunVol, PDRedistVol, PDbefore*as.numeric(PDbefore>0), PDPun*as.numeric(PDPun>0), PDRedist*as.numeric(PDRedist>0), PDbefore*as.numeric(PDbefore<0), PDPun*as.numeric(PDPun<0), PDRedist*as.numeric(PDRedist<0), shortsells, marginbuys, marginbuysAsset) ~ Role + ceiling(rankavgPDbeforeRole2) + Phase + IsREG + subTreatment, data=tradersummary, function(x) quantile(x, probs = 0.025))
colnames(avgtraderphasesummaryRankll) <- c("Role", "rank", "Phase","IsREG", "subTreatment", "llVolume", "llLimitVolume", "llTradingProfit", "llTPUnits", "llTPUnitsPun", "llProfitPeriod", "llPR", "llPDbefore", "llPDPun", "llPDRedist", "llPDbeforeVol", "llPDPunVol", "llPDRedistVol", "llV14", "llV15", "llV16", "llV17", "llV18", "llV19", "llshortsells", "llmarginbuys", "llmarginbuysAsset")
avgtraderphasesummaryRanksd <- aggregate(cbind(Volume, LimitVolume, TradingProfit, TPUnits, TPUnitsPun, ProfitPeriod, (Volume > 0 | LimitVolume > 0), PDbefore, PDPun, PDRedist, PDbeforeVol, PDPunVol, PDRedistVol, PDbefore*as.numeric(PDbefore>0), PDPun*as.numeric(PDPun>0), PDRedist*as.numeric(PDRedist>0), PDbefore*as.numeric(PDbefore<0), PDPun*as.numeric(PDPun<0), PDRedist*as.numeric(PDRedist<0), shortsells, marginbuys, marginbuysAsset) ~ Role + ceiling(rankavgPDbeforeRole2) + Phase + IsREG + subTreatment, data=tradersummary, function(x) sd(x, na.rm = T), na.action = na.pass)
colnames(avgtraderphasesummaryRanksd)[colnames(avgtraderphasesummaryRanksd) == "V7"] <- "PR"
colnames(avgtraderphasesummaryRanksd)[2] <- "rank"
avgtraderphasesummaryRank2sd <- reshape2::melt(subset(avgtraderphasesummaryRanksd), id.vars = c("Phase", "IsREG", "subTreatment", "Role", "rank"))
colnames(avgtraderphasesummaryRank2sd)[colnames(avgtraderphasesummaryRank2sd) == "value"] <- "sd"
colnames(avgtraderphasesummaryRanksd) <- c("Role", "rank", "Phase","IsREG", "subTreatment", "sdVolume", "sdLimitVolume", "sdTradingProfit", "sdTPUnits", "sdTPUnitsPun", "sdProfitPeriod", "sdPR", "sdPDbefore", "sdPDPun", "sdPDRedist", "sdPDbeforeVol", "sdPDPunVol", "sdPDRedistVol", "sdV14", "sdV15", "sdV16", "sdV17", "sdV18", "sdV19", "sdshortsells", "sdmarginbuys", "sdmarginbuysAsset")
avgtraderphasesummaryRankn <- aggregate(Volume ~ Role + ceiling(rankavgPDbeforeRole2) + Phase + IsREG + subTreatment, data=tradersummary, function(x) length(x))
colnames(avgtraderphasesummaryRankn) <- c("Role", "rank", "Phase","IsREG", "subTreatment", "n")
avgtraderphasesummaryRank <- merge(avgtraderphasesummaryRank, avgtraderphasesummaryRankn, by = c("Role" ,"Phase","IsREG", "subTreatment", "rank"))
avgtraderphasesummaryRank <- merge(avgtraderphasesummaryRank, avgtraderphasesummaryRankul, by = c("Role", "Phase","IsREG", "subTreatment", "rank"))
avgtraderphasesummaryRank <- merge(avgtraderphasesummaryRank, avgtraderphasesummaryRankll, by = c("Role", "Phase","IsREG", "subTreatment", "rank"))
avgtraderphasesummaryRank <- merge(avgtraderphasesummaryRank, avgtraderphasesummaryRanksd, by = c("Role", "Phase","IsREG", "subTreatment", "rank"))
avgtraderphasesummaryRank$uplVolume <- avgtraderphasesummaryRank$Volume+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdVolume/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolVolume <- avgtraderphasesummaryRank$Volume+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdVolume/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplLimitVolume <- avgtraderphasesummaryRank$LimitVolume+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdLimitVolume/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolLimitVolume <- avgtraderphasesummaryRank$LimitVolume+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdLimitVolume/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplTradingProfit <- avgtraderphasesummaryRank$TradingProfit+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdTradingProfit/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolTradingProfit <- avgtraderphasesummaryRank$TradingProfit+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdTradingProfit/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplTPUnits <- avgtraderphasesummaryRank$TPUnits+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdTPUnits/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolTPUnits <- avgtraderphasesummaryRank$TPUnits+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdTPUnits/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplTPUnitsPun <- avgtraderphasesummaryRank$TPUnitsPun+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdTPUnitsPun/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolTPUnitsPun <- avgtraderphasesummaryRank$TPUnitsPun+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdTPUnitsPun/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplProfitPeriod <- avgtraderphasesummaryRank$ProfitPeriod+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdProfitPeriod/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolProfitPeriod <- avgtraderphasesummaryRank$ProfitPeriod+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdProfitPeriod/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplPR <- avgtraderphasesummaryRank$PR+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPR/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolPR <- avgtraderphasesummaryRank$PR+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPR/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplPDbefore <- avgtraderphasesummaryRank$PDbefore+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPDbefore/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolPDbefore <- avgtraderphasesummaryRank$PDbefore+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPDbefore/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplPDPun <- avgtraderphasesummaryRank$PDPun+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPDPun/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolPDPun <- avgtraderphasesummaryRank$PDPun+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPDPun/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplPDRedist <- avgtraderphasesummaryRank$PDRedist+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPDRedist/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolPDRedist <- avgtraderphasesummaryRank$PDRedist+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPDRedist/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplPDbeforeVol <- avgtraderphasesummaryRank$PDbeforeVol+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPDbeforeVol/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolPDbeforeVol <- avgtraderphasesummaryRank$PDbeforeVol+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPDbeforeVol/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplPDPunVol <- avgtraderphasesummaryRank$PDPunVol+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPDPunVol/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolPDPunVol <- avgtraderphasesummaryRank$PDPunVol+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPDPunVol/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplPDRedistVol <- avgtraderphasesummaryRank$PDRedistVol+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPDRedistVol/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolPDRedistVol <- avgtraderphasesummaryRank$PDRedistVol+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdPDRedistVol/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplshortsells <- avgtraderphasesummaryRank$shortsells+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdshortsells/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolshortsells <- avgtraderphasesummaryRank$shortsells+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdshortsells/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplmarginbuys <- avgtraderphasesummaryRank$marginbuys+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdmarginbuys/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolmarginbuys <- avgtraderphasesummaryRank$marginbuys+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdmarginbuys/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$uplmarginbuysAsset <- avgtraderphasesummaryRank$marginbuysAsset+qt(.975,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdmarginbuysAsset/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$dolmarginbuysAsset <- avgtraderphasesummaryRank$marginbuysAsset+qt(.025,avgtraderphasesummaryRank$n-1)*avgtraderphasesummaryRank$sdmarginbuysAsset/sqrt(avgtraderphasesummaryRank$n)
avgtraderphasesummaryRank$Phase <- factor(avgtraderphasesummaryRank$Phase, levels = c("Phases 1 & 2", "Phase 3", "Phase 4"), label = c("Phases 1 & 2", "Phase 3", "Phase 4"))
avgtraderphasesummaryRank$maxV <- max(avgtraderphasesummaryRank$uplVolume)
avgtraderphasesummaryRank$Role <- factor(avgtraderphasesummaryRank$Role, labels = c("Informed\ntraders","Uninformed\ntraders"))
avgtraderphasesummaryRank$Role <- ordered(avgtraderphasesummaryRank$Role, levels = c("Informed\ntraders","Uninformed\ntraders"))


avgtraderphasesummaryRank2 <- merge(avgtraderphasesummaryRank2, avgtraderphasesummaryRank2sd, by = c("Role", "rank", "Phase","IsREG", "subTreatment", "variable"))
avgtraderphasesummaryRank2 <- merge(avgtraderphasesummaryRank2, avgtraderphasesummaryRankn, by = c("Role", "rank", "Phase","IsREG", "subTreatment"))
avgtraderphasesummaryRank2$upl <- avgtraderphasesummaryRank2$value+qt(.975,avgtraderphasesummaryRank2$n-1)*avgtraderphasesummaryRank2$sd/sqrt(avgtraderphasesummaryRank2$n)
avgtraderphasesummaryRank2$dol <- avgtraderphasesummaryRank2$value+qt(.025,avgtraderphasesummaryRank2$n-1)*avgtraderphasesummaryRank2$sd/sqrt(avgtraderphasesummaryRank2$n)
avgtraderphasesummaryRank2$Phase <- factor(avgtraderphasesummaryRank2$Phase, levels = c("Phases 1 & 2", "Phase 3", "Phase 4"), label = c("Phases 1 & 2", "Phase 3", "Phase 4"))
avgtraderphasesummaryRank2$Role <- factor(avgtraderphasesummaryRank2$Role, labels = c("Informed\ntraders","Uninformed\ntraders"))
avgtraderphasesummaryRank2$Role <- ordered(avgtraderphasesummaryRank2$Role, levels = c("Informed\ntraders","Uninformed\ntraders"))
avgtraderphasesummaryRank2$Variable <- as.character(avgtraderphasesummaryRank2$variable)
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "LimitVolume"] <- "Limit volume"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "Volume"] <- "Traders' mean trading volume"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "PR"] <- "Participation rate"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "shortsells"] <- "Short sells"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "marginbuysAsset"] <- "Margin buys"

avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "PDbefore"] <- "Trading profig before redistribution"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "PDredist"] <- "Trading profig after redistribution"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "PDPun"] <- "Trading profig after punishment"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "PDbeforeVol"] <- "Trading profig before redistribution per transacted asset"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "PDredistVol"] <- "Trading profig after redistribution per transacted asset"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "PDPunVol"] <- "Trading profig after punishment per transacted asset"

avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "V14"] <- "PDbeforePos"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "V17"] <- "PDbeforePos"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "V15"] <- "PDPunPos"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "V18"] <- "PDPunPos"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "V16"] <- "PDRedisPos"
avgtraderphasesummaryRank2$Variable[avgtraderphasesummaryRank2$variable == "V19"] <- "PDRedisPos"

avgtraderphasesummaryRank2$group <- interaction(avgtraderphasesummaryRank2$IsREG, avgtraderphasesummaryRank2$variable)
avgtraderphasesummaryRank2$group <- factor(avgtraderphasesummaryRank2$group, levels = c("NOREG.PDbefore", "REG.PDbefore", "REG.PDPun", "NOREG.PDbeforeVol", "REG.PDbeforeVol", "REG.PDPunVol"))
avgtraderphasesummaryRank2$group2 <- interaction(avgtraderphasesummaryRank2$IsREG, avgtraderphasesummaryRank2$Variable)
avgtraderphasesummaryRank2$group2 <- factor(avgtraderphasesummaryRank2$group2, levels = c("NOREG.PDbeforePos", "REG.PDbeforePos", "REG.PDPunPos"))
avgtraderphasesummaryRank2$rank2 <- factor(avgtraderphasesummaryRank2$rank, labels = c("low", "middle", "high"))
```

```{r FigureOA8, echo=F, fig.cap="[Figure OA8:] Mean gross trading profits per trader by treatment, regulatory regime, trader types, phase, and profit rank."}
library(gridExtra)
#postscript("Figures/xxx_FigureOA8_rankPD.eps")
grid.arrange(
ggplot(data=subset(avgtraderphasesummaryRank2, Role == "Informed\ntraders" & (variable == "PDbefore" | ( IsREG != "NOREG" & variable =="PDPun"))), aes(y= value*100, x= rank2, group = group, fill = group, color = group)) +
    geom_bar(stat="identity", position = position_dodge(width = 0.7)#, size = 2 # used in paper but not in Rmarkdown output
             )+ 
    labs(y="", title = "Informed trader") +
    geom_errorbar(aes(ymin = dol*100, ymax = upl*100), width=.2, color = 'black', size = .7, position=position_dodge(width=0.7)) +
    theme(#plot.title = element_text(size=14, face="plain", hjust = 0.5), text = element_text(size=18), # used in paper but not in Rmarkdown output
          axis.title.x=element_blank(),  axis.ticks.x = element_blank(), legend.title = element_blank(), legend.position = "none", legend.direction = "horizontal", panel.grid.major.y = element_line(colour = "lightgrey"), panel.background = element_rect(fill = "transparent"), plot.background = element_rect(fill = "transparent")) +
    facet_grid(factor(subTreatment, levels = c("FLUCT", "FIXED")) ~ Phase, scales = "fixed") +
    scale_color_manual(name = "Regime - Punishment", values = c("REG.PDbefore" = "transparent", "NOREG.PDbefore" = "transparent", "REG.PDPun" = "orange"), breaks = c("NOREG.PDbefore", "REG.PDbefore", "REG.PDPun"), labels = c("NOREG", "REG - before punishment", "REG - after punishment")) +
    scale_fill_manual(name = "Regime - Punishment", values = c("NOREG.PDbefore" = rgb(.46, .76, .88), "REG.PDPun" = rgb(0,.29,.51), "REG.PDbefore" = rgb(0,.29,.51)), breaks = c("NOREG.PDbefore", "REG.PDbefore", "REG.PDPun"), labels = c("NOREG", "REG - before punishment", "REG - after punishment")),

ggplot(data=subset(avgtraderphasesummaryRank2, Role == "Uninformed\ntraders" & (variable == "PDbefore" | ( IsREG != "NOREG" & variable =="PDPun"))), aes(y= value*100, x= rank2, group = group, fill = group, color = group)) +
    geom_bar(stat="identity", position = position_dodge(width = 0.7)#, size = 2 # used in paper but not in Rmarkdown output
             )+ 
    labs(y="", title = "Uninformed trader") +
    geom_errorbar(aes(ymin = dol*100, ymax = upl*100), width=.2, color = 'black', size = .7, position=position_dodge(width=0.7)) +
    theme(#plot.title = element_text(size=14, face="plain", hjust = 0.5), text = element_text(size=18), # used in paper but not in Rmarkdown output
      axis.title.x=element_blank(),  axis.ticks.x = element_blank(), legend.title = element_blank(), legend.position = "bottom", legend.direction = "horizontal", panel.grid.major.y = element_line(colour = "lightgrey"), panel.background = element_rect(fill = "transparent"), plot.background = element_rect(fill = "transparent")) +
    facet_grid(factor(subTreatment, levels = c("FLUCT", "FIXED")) ~ Phase, scales = "fixed") +
    scale_color_manual(name = "Regime - Punishment", values = c("REG.PDbefore" = "transparent", "NOREG.PDbefore" = "transparent", "REG.PDPun" = "orange"), breaks = c("NOREG.PDbefore", "REG.PDbefore", "REG.PDPun"), labels = c("NOREG", "REG - before punishment", "REG - after punishment")) +
    scale_fill_manual(name = "Regime - Punishment", values = c("NOREG.PDbefore" = rgb(.46, .76, .88), "REG.PDPun" = rgb(0,.29,.51), "REG.PDbefore" = rgb(0,.29,.51)), breaks = c("NOREG.PDbefore", "REG.PDbefore", "REG.PDPun"), labels = c("NOREG", "REG - before punishment", "REG - after punishment")),
nrow = 2)
#dev.off()
```

```{r countPD, echo=F}
countPDbefore <- aggregate(cbind(PDbefore>0, PDbefore == 0, PDbefore < 0, 1) ~ subjectID + Role + subTreatment, subset(tradersummary), function(x) sum(x, na.rm = T), na.action = na.pass)
countPDbefore <- cbind(countPDbefore, with(cbind(V1, V2, V3)/V4, data = countPDbefore))
colnames(countPDbefore) <- c("subjectID", "Role", "subTreatment", "positive", "neutral", "negative", "n", "relpositive", "relneutral", "relnegative")
countPDbefore <- merge(countPDbefore, avgtraderprofit, by = c("subjectID"))
countPDbefore$AvgPDbeforeRole <- countPDbefore$AvgPDbeforeInf
countPDbefore$AvgPDbeforeRole[countPDbefore$Role == "Uninformed trader"] <- countPDbefore$AvgPDbeforeUni[countPDbefore$Role == "Uninformed trader"]

aggCountPDbefore <- aggregate(cbind(1, positive > 0,positive == 0, neutral == 0, negative == 0, neutral == 0 & negative == 0 & positive > 0, neutral == 0 & negative > 0 & positive == 0, AvgPDbeforeRole > 0, AvgPDbeforeRole == 0, AvgPDbeforeRole < 0) ~ Role  + subTreatment,countPDbefore, function(x) sum(x, na.rm = T), na.action = na.pass)
colnames(aggCountPDbefore) <- c("Role", "subTreatment", "n", "positive", "no-positive", "no-neutral", "no-negative", "only-positive", "only-negative", "avg positive", "avg zero", "avg negative")

aggCountPDbefore

countPDbeforeOrder <- aggregate(cbind(PDbefore>0, PDbefore == 0, PDbefore < 0, 1) ~ regime_order + subjectID + Role + subTreatment, subset(tradersummary), function(x) sum(x, na.rm = T), na.action = na.pass)
countPDbeforeOrder <- cbind(countPDbeforeOrder, with(cbind(V1, V2, V3)/V4, data = countPDbeforeOrder))
colnames(countPDbeforeOrder) <- c("regime_order", "subjectID", "Role", "subTreatment", "positive", "neutral", "negative", "n", "relpositive", "relneutral", "relnegative")
countPDbeforeOrder <- merge(countPDbeforeOrder, avgtraderprofit, by = c("subjectID"))
countPDbeforeOrder$AvgPDbeforeRole <- countPDbeforeOrder$AvgPDbeforeInf
countPDbeforeOrder$AvgPDbeforeRole[countPDbeforeOrder$Role == "Uninformed trader"] <- countPDbeforeOrder$AvgPDbeforeUni[countPDbeforeOrder$Role == "Uninformed trader"]

aggCountPDbeforeOrder <- aggregate(cbind(1, positive > 0,positive == 0, neutral == 0, negative == 0, neutral == 0 & negative == 0 & positive > 0, neutral == 0 & negative > 0 & positive == 0, AvgPDbeforeRole > 0, AvgPDbeforeRole == 0, AvgPDbeforeRole < 0) ~ regime_order + Role  + subTreatment,countPDbeforeOrder, function(x) sum(x, na.rm = T), na.action = na.pass)
colnames(aggCountPDbeforeOrder) <- c("regime_order", "Role", "subTreatment", "n", "positive", "no-positive", "no-neutral", "no-negative", "only-positive", "only-negative", "avg positive", "avg zero", "avg negative")

aggCountPDbeforeOrder
```

### Trading profit per share

\begin{align}\label{eq:ProfitBefore}
    \pi^{Before}=1000\cdot\frac{\sum\limits_{j}\theta_j\cdot\left(P_j-BBV\right)\cdot Vol_j}{W_{t=0}\cdot \sum Vol_{j}},
\end{align}

\begin{align}\label{eq:ProfitAfterRedist}
    \pi^{After\,redistribution}=\pi^{Before}+1000\cdot\frac{Redist}{W_{t=0}\cdot \sum Vol_{j}},
\end{align}

\begin{align}\label{eq:ProfitAfterPun}
    \pi^{After\, punishment}=\pi^{After\,redistribution}-1000\cdot\frac{Pen}{W_{t=0}\cdot \sum Vol_{j}},
\end{align}

```{r TPVolgraph, echo=F}
tPDbeforeVolInfX <- format(round(t.test(PDbeforeVol ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVolUniX <- format(round(t.test(PDbeforeVol ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVol1InfX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "REG")$PDbeforeVol, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$PDbeforeVol, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVol1UniX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "REG")$PDbeforeVol, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$PDbeforeVol, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVol2InfX <- format(round(t.test(PDbeforeVol ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVol2UniX <- format(round(t.test(PDbeforeVol ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVol3InfX <- format(round(t.test(PDbeforeVol ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVol3UniX <- format(round(t.test(PDbeforeVol ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunVolInfX <- format(round(t.test(PDPunVol ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunVolUniX <- format(round(t.test(PDPunVol ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunVol1InfX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "REG")$PDPunVol, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$PDPunVol, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDPunVol1UniX <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "REG")$PDPunVol, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED" & IsREG == "NOREG")$PDPunVol, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDPunVol2InfX <- format(round(t.test(PDPunVol ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunVol2UniX <- format(round(t.test(PDPunVol ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunVol3InfX <- format(round(t.test(PDPunVol ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunVol3UniX <- format(round(t.test(PDPunVol ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$p.value, digits = 4), scientific = FALSE)

tPDbeforeVolInfU <- format(round(t.test(PDbeforeVol ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVolUniU <- format(round(t.test(PDbeforeVol ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVol1InfU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "REG")$PDbeforeVol, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$PDbeforeVol, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVol1UniU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "REG")$PDbeforeVol, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$PDbeforeVol, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVol2InfU <- format(round(t.test(PDbeforeVol ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVol2UniU <- format(round(t.test(PDbeforeVol ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVol3InfU <- format(round(t.test(PDbeforeVol ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDbeforeVol3UniU <- format(round(t.test(PDbeforeVol ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunVolInfU <- format(round(t.test(PDPunVol ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunVolUniU <- format(round(t.test(PDPunVol ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunVol1InfU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "REG")$PDPunVol, subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$PDPunVol, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDPunVol1UniU <- format(round(t.test(subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "REG")$PDPunVol, subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT" & IsREG == "NOREG")$PDPunVol, var.equal=T, paired = T)$p.value, digits = 4), scientific = FALSE)
tPDPunVol2InfU <- format(round(t.test(PDPunVol ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunVol2UniU <- format(round(t.test(PDPunVol ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunVol3InfU <- format(round(t.test(PDPunVol ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)
tPDPunVol3UniU <- format(round(t.test(PDPunVol ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$p.value, digits = 4), scientific = FALSE)

ePDbeforeVolInfX <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVolUniX <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVol1InfX <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVol1UniX <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVol2InfX <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVol2UniX <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVol3InfX <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVol3UniX <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVolInfX <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVolUniX <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVol1InfX <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVol1UniX <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVol2InfX <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVol2UniX <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVol3InfX <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVol3UniX <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FIXED"), var.equal=T)$estimate, digits = 4), scientific = FALSE)

ePDbeforeVolInfU <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVolUniU <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVol1InfU <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVol1UniU <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVol2InfU <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVol2UniU <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVol3InfU <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDbeforeVol3UniU <- format(round(t.test(PDbeforeVol*100 ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVolInfU <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVolUniU <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVol1InfU <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVol1UniU <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>0 & Period<7 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVol2InfU <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVol2UniU <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVol3InfU <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>9 & Role=="Informed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)
ePDPunVol3UniU <- format(round(t.test(PDPunVol*100 ~ IsREG, data=subset(tradersummary, Period>9  & Role=="Uninformed trader" & subTreatment == "FLUCT"), var.equal=T)$estimate, digits = 4), scientific = FALSE)

dat_textPD <- data.frame(
  label = c(paste0("p = ",tPDbeforeVol1InfU,""), paste0("p = ",tPDbeforeVol1UniU,""), paste0("p = ",tPDbeforeVol2InfU,""), paste0("p = ",tPDbeforeVol2UniU,""), paste0("p = ",tPDbeforeVol3InfU,""),paste0("p = ",tPDbeforeVol3UniU,""),paste0("p = ",tPDPunVol1InfU,""),paste0("p = ",tPDPunVol1UniU,""),paste0("p = ",tPDPunVol2InfU,""),paste0("p = ",tPDPunVol2UniU,""),paste0("p = ",tPDPunVol3InfU,""),paste0("p = ",tPDPunVol3UniU,""), paste0("p = ",tPDbeforeVol1InfX,""), paste0("p = ",tPDbeforeVol1UniX,""), paste0("p = ",tPDbeforeVol2InfX,""), paste0("p = ",tPDbeforeVol2UniX,""), paste0("p = ",tPDbeforeVol3InfX,""), paste0("p = ",tPDbeforeVol3UniX,""),paste0("p = ",tPDPunVol1InfX,""),paste0("p = ",tPDPunVol1UniX,""),paste0("p = ",tPDPunVol2InfX,".0000"),paste0("p = ",tPDPunVol2UniX,""),paste0("p = ",tPDPunVol3InfX,""),paste0("p = ",tPDPunVol3UniX,"")),
  IsREG   = c("REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG", "REG"),
  Role = c("Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders", "Informed\ntraders", "Uninformed\ntraders"),
  Phase = c("Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4", "Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4", "Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4", "Phases 1 & 2", "Phases 1 & 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4"),
  group = c("PDbeforeVol","PDbeforeVol","PDbeforeVol", "PDbeforeVol", "PDbeforeVol", "PDbeforeVol", "REG.PDPunVol", "REG.PDPunVol", "REG.PDPunVol","REG.PDPunVol","REG.PDPunVol","REG.PDPunVol", "PDbeforeVol","PDbeforeVol","PDbeforeVol", "PDbeforeVol", "PDbeforeVol", "PDbeforeVol", "REG.PDPunVol", "REG.PDPunVol", "REG.PDPunVol","REG.PDPunVol","REG.PDPunVol","REG.PDPunVol"),
  Variable = c("PDbeforeVol","PDbeforeVol","PDbeforeVol", "PDbeforeVol", "PDbeforeVol", "PDbeforeVol", "PDPunVol", "PDPunVol", "PDPunVol","PDPunVol","PDPunVol","PDPunVol", "PDbeforeVol","PDbeforeVol","PDbeforeVol", "PDbeforeVol", "PDbeforeVol", "PDbeforeVol", "PDPunVol", "PDPunVol", "PDPunVol","PDPunVol","PDPunVol","PDPunVol"),
  subTreatment = c("FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FLUCT", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED", "FIXED"),
  vjust = c(0,0,0,0,0,0,1,1,1,1,1,1, 0,0,0,0,0,0,1,1,1,1,1,1)
)
```


```{r TPtableInf, echo=F, results = 'asis'}
# mixed model
tradersummary$subTreatment <- factor(tradersummary$subTreatment, levels = c('FLUCT', 'FIXED'))
PD3InfsVol<- lmer((PDbeforeVol) ~subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader"))
PD3UnInfsVol<- lmer((PDbeforeVol) ~subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period>6 & Period<10  & Role=="Uninformed trader"))
PD12InfsVol<- lmer(PDbeforeVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period > 0 & Period < 7 &  Role=="Informed trader"))
PD12UnInfsVol<- lmer(PDbeforeVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period > 0 & Period < 7 &  Role=="Uninformed trader"))
PD4InfsVol<- lmer(PDbeforeVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period>9 &  Role=="Informed trader"))
PD4UnInfsVol<- lmer(PDbeforeVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period>9 &  Role=="Uninformed trader"))
PDallInfsVol<- lmer(PDbeforeVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary,  Role=="Informed trader"))
PDallUnInfsVol<- lmer(PDbeforeVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary,  Role=="Uninformed trader"))

PDPun3InfsVol <- lmer((PDPunVol) ~subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader"))
PDPun12InfsVol <- lmer(PDPunVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period > 0 & Period < 7 &  Role=="Informed trader"))
PDPun4InfsVol <- lmer(PDPunVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period>9 &  Role=="Informed trader"))
PDPunallInfsVol <- lmer(PDPunVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary,  Role=="Informed trader"))

PDRedist3InfsVol <- lmer((PDRedistVol) ~subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period>6 & Period<10 & Role=="Informed trader"))
PDRedist3UnInfsVol <- lmer((PDRedistVol) ~subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period>6 & Period<10 & Role=="Uninformed trader"))
PDRedist12InfsVol <- lmer(PDRedistVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period > 0 & Period < 7 &  Role=="Informed trader"))
PDRedist12UnInfsVol <- lmer(PDRedistVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period > 0 & Period < 7 &  Role=="Uninformed trader"))
PDRedist4InfsVol <- lmer(PDRedistVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period>9 &  Role=="Informed trader"))
PDRedist4UnInfsVol <- lmer(PDRedistVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary, Period>9 &  Role=="Uninformed trader"))
PDRedistallInfsVol <- lmer(PDRedistVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary,  Role=="Informed trader"))
PDRedistallUnInfsVol <- lmer(PDRedistVol ~ subTreatment + regime_order + IsREG + BBVCent + abs(BBVCent) + Period0 + (1| Group), data = subset(tradersummary,  Role=="Uninformed trader"))
```

```{r tableOA13, echo=F, results='asis'}
texreg(list(PD12InfsVol, PDRedist12InfsVol,PDPun12InfsVol,  PD3InfsVol, PDRedist3InfsVol,  PDPun3InfsVol,PD4InfsVol, PDRedist4InfsVol,  PDPun4InfsVol), custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"), 
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE, omit.coef = "(Session)|(subject)", 
       caption = "[Table OA13:] Regressions of trading profits of informed traders by phase.", 
       label = "TableOA13",
       custom.model.names = c("Phases 1 and 2", "Phases 1 and 2", "Phases 1 and 2", "Phase 3", "Phase 3", "Phase 3", "Phase 4", "Phase 4", "Phase 4"))
```

```{r tableOA14, echo=F, results='asis'}
texreg(list(PD12UnInfsVol, PDRedist12UnInfsVol, PD3UnInfsVol, PDRedist3UnInfsVol, PD4UnInfsVol, PDRedist4UnInfsVol), custom.note = ("\\parbox{.4\\linewidth}{\\vspace{2pt}%stars.}"), 
       stars = c(0.001,  0.01, 0.05), digits = 2, leading.zero = TRUE, omit.coef = "(Session)|(subject)", 
       custom.model.names = c("Phases 1 and 2", "Phases 1 and 2", "Phase 3", "Phase 3", "Phase 4", "Phase 4"),
       caption = "[Table OA14:] Regressions of trading profits of uninformed traders by phase.",
       label = "TableOA14")


```

****************************************************
\newpage

## Observers performance

[Table OA15:] Observer performance by treatment and starting phase.
```{r destableobservers, echo=F, results='markup'}
tableObs <- t(aggregate(cbind(NumSelected/9, (NumSelected>0), NumDetections/3, (NumDetections>0)) ~ Treatment, data=subset(observers, IsREG != "Training"), function(x) mean(x, na.rm = T), na.action = na.pass))[2:5,]
tableObs <- data.frame(tableObs)
colnames(tableObs) <- c("FIXEDNR", "FIXEDRN", "FLUCTNR", "FLUCTRN")
row.names(tableObs) <- c("Selected", "Any selected", "Unveiled", "Any unveiled")
observers2 <- aggregate(cbind(NumSelected, (NumSelected>0), NumDetections, (NumDetections>0), 1) ~ subjectID + Treatment + subTreatment, data=observers, FUN=sum)

ktobsSel <- kruskal.test(NumSelected ~ Treatment, data = observers2)$p.value
ktobsASel <- kruskal.test(V2 ~ Treatment, data = observers2)$p.value
ktobsPun <- kruskal.test(NumDetections ~ Treatment, data = observers2)$p.value
ktobsAPun <- kruskal.test(V4 ~ Treatment, data = observers2)$p.value

tableObs$pvalue <- c(ktobsSel, ktobsASel, ktobsPun, ktobsAPun)
data.frame(tableObs)
```

*******************************************************************************

## EET test

```{r EETscoresgraph, echo=F, include=F}
subjects$ExpectedRoleL <- factor(subjects$ExpectedRole, levels = c("Informed trader", "Uninformed trader", "FLUCT", "Observer"), labels = c("FIXED - Informed trader", "FIXED - Uninformed trader", "FLUCT", "Observer"))
dat_text <- data.frame(aggregate(subjectID ~ ExpectedRoleL + ExpectedRole + EET, data = subset(subjects, Period == 12 & Role != "Experimenter"), FUN = length))
dat_text$xScore <- 2.05
dat_text$xScore[dat_text$EET == "Equality averse" |dat_text$EET == "Altruistic" |dat_text$EET == "Kiss up"] <- 2
dat_text$xScore[dat_text$EET == "Kick down" |dat_text$EET == "Selfish" |dat_text$EET == "Maximin"] <- 0
dat_text$xScore[dat_text$EET == "Inequality averse" |dat_text$EET == "Spiteful" |dat_text$EET == "Envious"] <- -2
dat_text$yScore <- -2.05
dat_text$yScore[dat_text$EET == "Inequality averse" |dat_text$EET == "Altruistic" |dat_text$EET == "Maximin"] <- 2
dat_text$yScore[dat_text$EET == "Kiss up" |dat_text$EET == "Selfish" |dat_text$EET == "Envious"] <- 0
dat_text$yScore[dat_text$EET == "Equality averse" |dat_text$EET == "Spiteful" |dat_text$EET == "Kick down"] <- -2
dat_text$rel <- dat_text$subjectID/144
dat_text$rel[dat_text$ExpectedRole == "Informed trader"] <- dat_text$subjectID[dat_text$ExpectedRole == "Informed trader"]/48
dat_text$rel[dat_text$ExpectedRole == "Uninformed trader"] <- dat_text$subjectID[dat_text$ExpectedRole == "Uninformed trader"]/96
dat_text$rel[dat_text$ExpectedRole == "Observer"] <- dat_text$subjectID[dat_text$ExpectedRole == "Observer"]/32
dat_text$rel <- format(round(dat_text$rel*100, digits = 2), scientific = FALSE)
dat_text$EET <- factor(dat_text$EET, levels = c("Selfish", "Altruistic", "Envious", "Inequality averse", "Kick down", "Kiss up", "Maximin", "Spiteful", "Non-monotonic"),
                       labels = c("Selfish", "Altruistic", "Envious", "Inequality\naverse", "Kick down", "Kiss up", "Maximin", "Spiteful", "Non-monotonic"))
dat_text$label <- paste0(dat_text$EET, "\n", dat_text$subjectID, " obs\n", dat_text$rel, "%")

subjects$votes2Referenda2 <- factor(subjects$votes2Referenda, levels = c('NOREG|NOREG', 'NOREG|REG', 'REG|NOREG', 'REG|REG', NaN), labels = c('NOREG|NOREG', 'NOREG|REG', 'REG|NOREG', 'REG|REG', 'Observer - not eligible to vote'))
subjects$votes2Referenda2[is.na(subjects$votes2Referenda)] <- 'Observer - not eligible to vote'
```

```{r graphicEETScore, echo=F, fig.cap="[Figure OA10:] <x, y>-scores and EET archetypes of participants by role."}
#postscript("Figures/xxx_FigureOA10_EETCoordinates")
ggplot(data=subset(subjects, Period == 12 & Role != "Experimenter"), aes(x=xScore, y=yScore)) + 
  geom_jitter(width = .2, height = .2, aes(color = votes2Referenda2 )) +
  geom_label(data = subset(dat_text), mapping = aes(x = xScore, y = yScore, label = label), col = "black", fill = "transparent", size = 2 #, size = 4 # used in paper but not in Rmarkdown output
             ) +
  labs(y="y-score", x = "x-score") +
  theme(#text = element_text(size=18), # used in paper but not in Rmarkdown output
        legend.title = element_blank(), legend.position = "bottom", legend.direction = "horizontal", panel.grid.minor.y = element_line(colour = "lightgrey"), panel.grid.minor.x = element_line(colour = "lightgrey"), panel.background = element_rect(fill = "transparent"), plot.background = element_rect(fill = "transparent")) +
  scale_color_manual(values = c("NOREG|NOREG" = rgb(.46, .76, .88) , "NOREG|REG" = rgb(1,.84,0), "REG|NOREG" = rgb(.68,1,.18), "REG|REG" = rgb(0,.29,.51), 'Observer - not eligible to vote' = "black")) +
  scale_y_continuous(breaks = c(-2.5, -1.5, -.5,.5, 1.5,2.5), minor_breaks = c(-1 ,1)) +
  scale_x_continuous(breaks = c(-2.5, -1.5, -.5,.5, 1.5,2.5), minor_breaks = c(-1 ,1)) +
  facet_wrap(~ExpectedRoleL, scales = "fixed", nrow = 2)
#dev.off()
```


```{r EETvote, echo = F, include=F}
EET_VoteI <- aggregate(vote ~ EET + ExpectedRole, data = subset(Votes, Referendum == "Referendum 1"), FUN = function(x) length(x))
colnames(EET_VoteI)[colnames(EET_VoteI) == "vote"] <- "participants"
EET_VoteII <- aggregate(as.numeric(vote == "REG") ~ EET + ExpectedRole + Referendum, data = subset(Votes), FUN = function(x) mean(x, na.rm = T), na.action = na.pass)
colnames(EET_VoteII)[colnames(EET_VoteII) == 'as.numeric(vote == "REG")'] <- "vote"
EET_VoteIII <- aggregate(as.numeric(vote == "REG") ~ EET + ExpectedRole + Referendum, data = subset(Votes, vote == "REG"), FUN = sum)
colnames(EET_VoteIII)[colnames(EET_VoteIII) == 'as.numeric(vote == "REG")'] <- "sumREG"
EET_VoteII <- merge(EET_VoteII, EET_VoteIII, by = c("EET", "ExpectedRole", "Referendum"), all = T)

EET_VoteA <- aggregate(as.numeric(vote == "REG") ~ EET + ExpectedRole, data = subset(Votes), FUN = function(x) mean(x, na.rm = T), na.action = na.pass)
colnames(EET_VoteA)[colnames(EET_VoteA) == 'as.numeric(vote == "REG")'] <- "vote"
EET_VoteAII <- aggregate(as.numeric(vote == "REG") ~ EET + ExpectedRole, data = subset(Votes, vote == "REG"), FUN = sum)
colnames(EET_VoteAII)[colnames(EET_VoteAII) == 'as.numeric(vote == "REG")'] <- "sumREG"
EET_VoteA <- merge(EET_VoteA, EET_VoteAII, by = c("EET", "ExpectedRole"), all = T)
EET_VoteA$Referendum <- "All votes"

EET_Vote <- aggregate(as.numeric(vote == "REG") ~ EET + ExpectedRole, data = subset(Votes, Referendum != "Referendum 3"), FUN = function(x) mean(x, na.rm = T), na.action = na.pass)
colnames(EET_Vote)[colnames(EET_Vote) == 'as.numeric(vote == "REG")'] <- "vote"
EET_VoteIV <- aggregate(as.numeric(vote == "REG") ~ EET + ExpectedRole, data = subset(Votes, vote == "REG" & Referendum != "Referendum 3"), FUN = sum)
colnames(EET_VoteIV)[colnames(EET_VoteIV) == 'as.numeric(vote == "REG")'] <- "sumREG"
EET_Vote <- merge(EET_Vote, EET_VoteIV, by = c("EET", "ExpectedRole"), all = T)
EET_Vote$Referendum <- "Referenda 1 & 2"
EET_Vote <- rbind(EET_Vote, EET_VoteII)
EET_Vote <- rbind(EET_Vote, EET_VoteA)
EET_Vote <- merge(EET_Vote, EET_VoteI, by = c("EET", "ExpectedRole"), all = T)
EET_Vote$xScore <- 2
EET_Vote$xScore[EET_Vote$EET == "Equality averse" |EET_Vote$EET == "Altruistic" |EET_Vote$EET == "Kiss up"] <- 2
EET_Vote$xScore[EET_Vote$EET == "Equality averse" |EET_Vote$EET == "Altruistic" |EET_Vote$EET == "Kiss up"] <- 2
EET_Vote$xScore[EET_Vote$EET == "Kick down" |EET_Vote$EET == "Selfish" |EET_Vote$EET == "Maximin"] <- 0
EET_Vote$xScore[EET_Vote$EET == "Inequality averse" |EET_Vote$EET == "Spiteful" |EET_Vote$EET == "Envious"] <- -2
EET_Vote$yScore <- -2
EET_Vote$yScore[EET_Vote$EET == "Inequality averse" |EET_Vote$EET == "Altruistic" |EET_Vote$EET == "Maximin"] <- 2
EET_Vote$yScore[EET_Vote$EET == "Kiss up" |EET_Vote$EET == "Selfish" |EET_Vote$EET == "Envious"] <- 0
EET_Vote$yScore[EET_Vote$EET == "Equality averse" |EET_Vote$EET == "Spiteful" |EET_Vote$EET == "Kick down"] <- -2
EET_Vote$EET2 <- factor(EET_Vote$EET, levels = c("Selfish", "Altruistic", "Envious", "Inequality averse", "Kick down", "Kiss up", "Maximin", "Spiteful", "Non-monotonic"))
EET_Vote$EET <- factor(EET_Vote$EET, levels = c("Selfish", "Altruistic", "Maximin", "Inequality averse", "Kiss up","Envious","Kick down","Spiteful", "Non-monotonic"))
EET_Vote$sumREG[is.na(EET_Vote$sumREG)] <- 0
EET_Vote$rel <- format(round(EET_Vote$vote*100, digits = 2), scientific = FALSE)
EET_Vote$rel0 <- format(round(EET_Vote$vote*100, digits = 0), scientific = FALSE)
EET_Vote$label <- paste0(EET_Vote$EET, "\n", EET_Vote$participants, " indv.\n", EET_Vote$rel, "%")
EET_Vote$label2 <- paste0(EET_Vote$participants, " indv., ", EET_Vote$rel, "%")
EET_Vote$label3 <- paste0(EET_Vote$sumREG, " REG of ", EET_Vote$participants*2, " votes (", as.numeric(EET_Vote$rel0), "%)")
EET_Vote$ExpectedRoleL <- factor(EET_Vote$ExpectedRole, levels = c( "FLUCT", "Informed trader", "Uninformed trader"), labels = c( "FLUCT", "FIXED\nInformed trader", "FIXED\nUninformed trader"))

Votes$EET <- factor(Votes$EET, levels = c("Selfish", "Altruistic", "Maximin", "Inequality averse", "Kiss up","Envious","Kick down","Spiteful", "Non-monotonic"))

Votes$ExpectedRoleL <- factor(Votes$ExpectedRole, levels = c("FLUCT", "Informed trader", "Uninformed trader"), labels = c("FLUCT", "FIXED\nInformed trader", "FIXED\nUninformed trader"))

EET_VoteRole <- aggregate(subjectID ~ EET + votes2Referenda + ExpectedRole, data = subset(Votes, Referendum == "Referendum 1"), function(x) length(x))

EET_VoteRole$ExpectedRoleL <- factor(EET_VoteRole$ExpectedRole, levels = c("FLUCT", "Informed trader", "Uninformed trader"), labels = c("FLUCT", "FIXED\nInformed trader", "FIXED\nUninformed trader"))
EET_VoteRole$EET <- factor(EET_VoteRole$EET, levels = c("Selfish", "Altruistic", "Maximin", "Inequality averse", "Kiss up","Envious","Kick down","Spiteful", "Non-monotonic"))
EET_VoteRole$NumRoleMembersInExperiment <- 32
EET_VoteRole$NumRoleMembersInExperiment[EET_VoteRole$ExpectedRole == "FLUCT"] <- 16 * 9
EET_VoteRole$NumRoleMembersInExperiment[EET_VoteRole$ExpectedRole == "Informed trader"] <- 16 * 3
EET_VoteRole$NumRoleMembersInExperiment[EET_VoteRole$ExpectedRole == "Uninformed trader"] <- 16 * 6
EET_VoteRole$NumTrader <- EET_VoteRole$subjectID / EET_VoteRole$NumRoleMembersInExperiment
```

```{r graphicEETVote, echo=F, fig.cap="[Figure OA11:] Voting behavior by EET archetypes, treatment, and trader types."}
#postscript("Figures/xxx_FigureOA11_EETVote")
ggplot(data=subset(EET_VoteRole), aes(y = factor(EET, levels = rev(levels(EET))), x = NumTrader)) +
    geom_bar(aes(fill = votes2Referenda, group = votes2Referenda), stat="identity", position = position_dodge(width = 0.9, preserve = "single")) +
    geom_label(data = subset(EET_Vote, Referendum == "Referenda 1 & 2", ExpectedRole != "Observer"), mapping = aes(x = 0, y = EET, label = label3), hjust = 1, col = rgb(.25,.25,.25), label.size = NA, fill = "transparent", size = 2#, size = 4 # used in paper but not in Rmarkdown output
               ) +
    facet_grid(ExpectedRoleL ~., scales = "fixed") +
    scale_fill_manual( values = c("NOREG|NOREG" = rgb(.46, .76, .88) , "NOREG|REG" = rgb(1,.84,0), "REG|NOREG" = rgb(.68,1,.18),  "REG|REG" = rgb(0,.29,.51))) +
    scale_x_continuous(breaks = c(.1,.2,.3), labels = c("10%", "20%", "30%"), limits = c(-.1, .35)) +
    theme(#text = element_text(size=18), # used in paper but not in Rmarkdown output
          axis.title=element_blank(),legend.title = element_blank(), legend.position = "bottom", legend.direction = "horizontal", axis.ticks.y = element_blank(), panel.grid.major.x = element_line(colour = "lightgrey"), panel.background = element_rect(fill = "transparent"),  plot.background = element_rect(fill = "transparent"))
#dev.off()
```

Test rank differences of archetypes between roles reported in the Online Appendix in Section 4.1 
```{r archetypesRoles, echo=F}
kruskal.test(EET ~ ExpectedRole, data = subset(subjects, Period == 12 & Role != "Experimenter" & EET != "Non-monotonic"))
```

Test of non-monotonic preferences between roles reported in the Online Appendix in Section 4.1 
```{r nonMonotonicRoles, echo=F}
kruskal.test(EET == "Non-monotonic" ~ ExpectedRole, data = subset(subjects, Period == 12 & Role != "Experimenter"))
```

Test voting behavior between EET archetypes for informed traders in treatment FIXED reported in the Online Appendix in Section 4.1 
```{r nonMonotonicRolesInformed, echo=F}
kruskal.test(votes2Referenda ~ EET, data = subset(Votes, ExpectedRole == "Informed trader" & Referendum == "Referendum 1" & EET != "Non-monotonic"))
```

Test voting behavior between EET archetypes for uninformed traders in treatment FIXED reported in the Online Appendix in Section 4.1 
```{r nonMonotonicRolesUninformed, echo=F}
kruskal.test(votes2Referenda ~ EET, data = subset(Votes, ExpectedRole == "Uninformed trader" & Referendum == "Referendum 1" & EET != "Non-monotonic"))
```

Test voting behavior between EET archetypes for traders in treatment FLUCT reported in the Online Appendix in Section 4.1 
```{r nonMonotonicRolesFLUCT, echo=F}
kruskal.test(votes2Referenda ~ EET, data = subset(Votes, ExpectedRole == "FLUCT" & Referendum == "Referendum 1" & EET != "Non-monotonic"))
```

Test voting behavior between EET monotonicity for traders in treatment FLUCT reported in the Online Appendix in Section 4.1 
```{r monotonicityFLUCT, echo=F}
kruskal.test(votes2Referenda ~ EET != "Non-monotonic", data = subset(Votes, ExpectedRole == "FLUCT" & Referendum == "Referendum 1"))
```

********************************************************************

## Participant pool characteristics and questionnaire analyses

```{r destableTrader, echo=F, results='markup'}
table <- lapply( tradersummary[c("Volume", "LimitVolume", "TradingProfit", "ProfitPeriod")] , function(x) rbind( mean = mean(x),
                                         geoMean = exp(mean(replace(log(x), is.infinite(log(x)), 0), na.rm = T)),
                                         sd = sd(x) ,
                                         median = median(x) ,
                                         minimum = min(x) ,
                                         maximum = max(x) ,
                                         n = length(x) ) )
data.frame(table)
```

[Table OA16:] Traders’ demographics by treatment and starting phase.
```{r TableOA16, echo=F, results='markup'}
tableTr <- data.frame(t(aggregate(cbind((gender=="female"), (gender=="male"), (Faculty=="SOWI"), age, RiskGeneral, RiskFinancial, LossAversion, PunPerceived) ~ Treatment, data=subset(subjects, Period == 12 & Role != "Experimenter" & Role != "Observer"), function(x) mean(x, na.rm = T), na.action = na.pass)))

kttrfem <- kruskal.test((gender=="female") ~ Treatment, data = subset(subjects, Period == 12))$p.value
kttrmal <- kruskal.test((gender=="male") ~ Treatment, data = subset(subjects, Period == 12))$p.value
kttrsowi <- kruskal.test((Faculty=="SOWI") ~ Treatment, data = subset(subjects, Period == 12))$p.value
kttrage <- kruskal.test(age ~ Treatment, data = subset(subjects, Period == 12))$p.value
kTrRGen <- kruskal.test(RiskGeneral ~ Treatment, data = subset(subjects, Period == 12 & Role != "Experimenter" & Role != "Observer"))$p.value
kTrRFin <- kruskal.test(RiskFinancial ~ Treatment, data = subset(subjects, Period == 12 & Role != "Experimenter" & Role != "Observer"))$p.value
kTrLA <- kruskal.test(LossAversion ~ Treatment, data = subset(subjects, Period == 12 & Role != "Experimenter" & Role != "Observer"))$p.value
kTrPP <- kruskal.test(PunPerceived ~ Treatment, data = subset(subjects, Period == 12 & Role != "Experimenter" & Role != "Observer"))$p.value

tableTr$pvalue <- c("pvalue", kttrfem, kttrmal, kttrsowi, kttrage, kTrRGen,kTrRFin, kTrLA, kTrPP)
data.frame(tableTr)
```


### Final payouts

```{r allsubjects, echo=F, results='markup'}
table <- lapply( c(subset(subjects, Subject!=11 & Period==12)["TotalProfit"], subset(subjects, Role=="Observer" & Period==12)["TotalProfit"], subset(subjects, Subject!=11 & Role=="Observer" & Period==12 & subTreatment == "FIXED")["TotalProfit"], subset(subjects, Subject!=11 & Role=="Observer" & Period==12 & subTreatment == "FLUCT")["TotalProfit"], subset(subjects, Subject!=11 & Role!="Observer" & Period==12)["TotalProfit"], subset(subjects, Subject!=11 & Role!="Observer" & Period==12 & subTreatment == "FIXED")["TotalProfit"], subset(subjects, Subject!=11 & Role!="Observer" & Period==12 & subTreatment == "FLUCT")["TotalProfit"], subset(subjects, Subject!=11 & Role=="Informed trader")["ProfitPeriod"], subset(subjects, Subject!=11 & Role=="Uninformed trader")["ProfitPeriod"]) , function(x) rbind( mean = mean(x),
                                         sd = sd(x) ,
                                         median = median(x) ,
                                         minimum = min(x) ,
                                         maximum = max(x) ,
                                         n = length(x) ) )
names(table) <- c("TotProfit", "ObserverProfit",  "Observer - FIXED",  "Observer - FLUCT", "TraderProfit", "Trader - FIXED", "Trader - FLUCT", "Informed trader", "Uninformed trader")
data.frame(table)
```

********************************************************************************

## Graphical representation of trading activity

```{r overTime, echo=F}
for (s in 1:32){
  #postscript(paste0('Figures/Graph','Time',s,'.eps'), width = 12, height = 12*.34, pointsize = 8)
  print(
    ggplot(data=subset(transactions, Group==s & Period > 0), aes(y = Price, x=time)) +
          geom_line(data = subset(seconds, Group==s & Period > 0), aes(y= BestAsk, x= time), colour = rgb(0.94, 0.50, 0.18), size = .2) +
          geom_line(data = subset(seconds, Group==s & Period > 0), aes(y= BestBid, x= time), colour = rgb(0.55,  0.98, 0.45), size = .2) +  
          scale_y_continuous(
            limits = c(10, 90), breaks=c(30, 57.5 ,85)) +
          geom_line(data = subset(seconds, Group==s & Period > 0), aes(y = BBVCent + 57.5, x=time, colour = factor(IsREG)), size = 1) + 
          geom_line(data = subset(seconds, Group==s & Period > 0), aes(y = BBVCent + 57.5, x=time), colour = "black", size = .7) + 
          geom_point(aes(size = transactionVol), colour = "black") +
          scale_size_area(max_size = 3, breaks = c(5,10, 15, 20) ) +
          geom_rect(aes(xmin=-Inf, xmax=Inf, ymin=-Inf, ymax=Inf, color=as.factor(IsREG)), fill = "transparent", size = 5) +
          scale_color_manual( values = c("NOREG" = rgb(.46, .76, .88), "REG" = rgb(0,.29,.51))) +
          scale_fill_manual( values = c("NOREG" = rgb(.46, .76, .88), "REG" = rgb(0,.29,.51))) +
          facet_grid(. ~ (Period)) + 
          theme_bw() +
          scale_x_continuous(limits = c(-10,190),breaks=c(0,180), minor_breaks = c(60,120)) +
          labs( colour = "Regime", size = "Volume", title = paste0("Cohort ", s, " - time series")) + ylab('Price') + xlab('Time') +
          theme(#text = element_text(size=18), axis.text = element_text(size = 11, color = "darkgrey"), # used in paper but not in Rmarkdown output
                axis.title=element_blank(),  legend.position = "none", legend.direction = "vertical", 
                panel.grid.major = element_line(size = .5, colour = "grey"), panel.grid.minor = element_line(size = .05, colour = "lightgrey"), panel.background = element_rect(fill = "transparent"),  plot.background = element_rect(fill = "transparent"))
  )
  #dev.off()
}
```
